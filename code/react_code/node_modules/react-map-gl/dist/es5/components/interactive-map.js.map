{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["propTypes","Object","assign","StaticMap","maxZoom","PropTypes","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","onInteractionStateChange","transitionDuration","oneOfType","string","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onDblClick","onContextMenu","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onMouseEnter","onMouseLeave","onMouseOut","onWheel","touchAction","eventRecognizerOptions","clickRadius","interactiveLayerIds","array","getCursor","controller","instanceOf","MapController","getDefaultCursor","isDragging","isHovering","defaultProps","MAPBOX_LIMITS","TransitionManager","onNativeClick","event","preventDefault","normalizeEvent","lngLat","offsetCenter","x","y","Number","isFinite","pos","point","viewport","location","unproject","targetZ","meterOffset","getFeatures","map","queryParams","size","props","layers","queryRenderedFeatures","onEvent","callbackName","call","onPointerDown","pointerType","onPointerUp","onPointerMove","state","features","Boolean","length","isEntering","isExiting","setState","onPointerClick","callbacks","isDoubleClickEnabled","type","push","filter","forEach","cb","getRefHandles","staticMapRef","getMap","current","InteractiveMap","ref","parentContext","MapContext","eventManager","EventManager","recognizerOptions","eventCanvasRef","_thisRef","width","height","thisRef","newState","style","cursor","inRender","viewportUpdateRequested","stateUpdateRequested","handleViewportChange","viewState","interactionState","oldViewState","defineProperty","get","context","container","handleInteractionStateChange","updateControllerOpts","setOptions","isInteractive","onStateChange","onResize","setElement","on","pointerdown","bind","pointermove","pointerup","pointerleave","click","anyclick","dblclick","wheel","contextmenu","destroy","eventCanvasStyle","position","_child","supported"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {useContext, useRef, useMemo, useEffect, useImperativeHandle, forwardRef} from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport StaticMap, {getViewport} from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\n\nimport TransitionManager from '../utils/transition-manager';\nimport MapContext, {MapContextProvider} from './map-context';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport {getTerrainElevation} from '../utils/terrain';\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Drag to pan\n  dragPan: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Drag to rotate\n  dragRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Multitouch rotate\n  touchRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Keyboard\n  keyboard: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n\n  /** Event callbacks */\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Custom hammer.js recognizer options */\n  eventRecognizerOptions: PropTypes.object,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** List of layers that are interactive */\n  interactiveLayerIds: PropTypes.array,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controller\n  // The object must expose a method: `setOptions(opts)`\n  controller: PropTypes.instanceOf(MapController)\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) =>\n  isDragging ? 'grabbing' : isHovering ? 'pointer' : 'grab';\n\nconst defaultProps = Object.assign(\n  {},\n  StaticMap.defaultProps,\n  MAPBOX_LIMITS,\n  TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onNativeClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n    touchZoom: true,\n    touchRotate: false,\n    keyboard: true,\n\n    touchAction: 'none',\n    eventRecognizerOptions: {},\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\n/* Event handlers */\nfunction normalizeEvent(event) {\n  if (event.lngLat || !event.offsetCenter) {\n    return event;\n  }\n\n  const {\n    offsetCenter: {x, y}\n  } = event;\n  // https://github.com/visgl/react-map-gl/issues/1449\n  // TODO - fix in mjolnir.js\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    return event;\n  }\n  const pos = [x, y];\n\n  event.point = pos;\n\n  const {viewport} = this;\n  const location = viewport.unproject(pos, {targetZ: viewport.meterOffset[2]});\n  event.lngLat = [location[0], location[1]];\n\n  return event;\n}\n\nfunction getFeatures(pos) {\n  const {map} = this;\n\n  if (!map || !pos) {\n    return null;\n  }\n\n  const queryParams = {};\n  const size = this.props.clickRadius;\n\n  if (this.props.interactiveLayerIds) {\n    queryParams.layers = this.props.interactiveLayerIds;\n  }\n\n  try {\n    // This may fail if map is still loading\n    return map.queryRenderedFeatures(\n      size\n        ? // Radius enables point features, like marker symbols, to be clicked.\n          [\n            [pos[0] - size, pos[1] + size],\n            [pos[0] + size, pos[1] - size]\n          ]\n        : pos,\n      queryParams\n    );\n  } catch {\n    return null;\n  }\n}\n\nfunction onEvent(callbackName, event) {\n  const func = this.props[callbackName];\n  if (func) {\n    func(normalizeEvent.call(this, event));\n  }\n}\n\nfunction onPointerDown(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchStart' : 'onMouseDown', event);\n}\n\nfunction onPointerUp(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchEnd' : 'onMouseUp', event);\n}\n\n// eslint-disable-next-line complexity\nfunction onPointerMove(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchMove' : 'onMouseMove', event);\n\n  if (!this.state.isDragging) {\n    const {onHover, interactiveLayerIds} = this.props;\n    let features;\n    event = normalizeEvent.call(this, event);\n    if (interactiveLayerIds || onHover) {\n      features = getFeatures.call(this, event.point);\n    }\n\n    const isHovering = Boolean(interactiveLayerIds && features && features.length > 0);\n    const isEntering = isHovering && !this.state.isHovering;\n    const isExiting = !isHovering && this.state.isHovering;\n\n    if (onHover || isEntering) {\n      event.features = features;\n\n      // backward compatibility: v3 `onHover` interface\n      if (onHover) {\n        onHover(event);\n      }\n    }\n\n    if (isEntering) {\n      onEvent.call(this, 'onMouseEnter', event);\n    }\n    if (isExiting) {\n      onEvent.call(this, 'onMouseLeave', event);\n    }\n    if (isEntering || isExiting) {\n      this.setState({isHovering});\n    }\n  }\n}\n\nfunction onPointerClick(event) {\n  const {onClick, onNativeClick, onDblClick, doubleClickZoom} = this.props;\n  let callbacks = [];\n  const isDoubleClickEnabled = onDblClick || doubleClickZoom;\n\n  // `click` is only fired on single click. `anyclick` is fired twice if double clicking.\n  // `click` has a delay period after pointer up that prevents it from firing when\n  // double clicking. `anyclick` is always fired immediately after pointer up.\n  // If double click is turned off by the user, we want to immediately fire the\n  // onClick event. Otherwise, we wait to make sure it's a single click.\n  switch (event.type) {\n    case 'anyclick':\n      callbacks.push(onNativeClick);\n      if (!isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n\n    case 'click':\n      if (isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n\n    default:\n  }\n\n  callbacks = callbacks.filter(Boolean);\n\n  if (callbacks.length) {\n    event = normalizeEvent.call(this, event);\n    // backward compatibility: v3 `onClick` interface\n    event.features = getFeatures.call(this, event.point);\n    callbacks.forEach(cb => cb(event));\n  }\n}\n/* End of event handers */\n\nfunction getRefHandles(staticMapRef) {\n  return {\n    getMap: staticMapRef.current && staticMapRef.current.getMap,\n    queryRenderedFeatures: staticMapRef.current && staticMapRef.current.queryRenderedFeatures\n  };\n}\n\n/* eslint-disable max-statements */\nconst InteractiveMap = forwardRef((props, ref) => {\n  const parentContext = useContext(MapContext);\n  const controller = useMemo(() => props.controller || new MapController(), []);\n  const eventManager = useMemo(\n    () =>\n      new EventManager(null, {\n        touchAction: props.touchAction,\n        recognizerOptions: props.eventRecognizerOptions\n      }),\n    []\n  );\n  const eventCanvasRef = useRef(null);\n  const staticMapRef = useRef(null);\n\n  // Event handlers are registered once but need access to the latest props\n  // This is an anti-pattern, though it maintains a persistent reference to the latest props/state of this component\n  const _thisRef = useRef({\n    width: 0,\n    height: 0,\n    state: {\n      isHovering: false,\n      isDragging: false\n    }\n  });\n  const thisRef = _thisRef.current;\n  thisRef.props = props;\n  thisRef.map = staticMapRef.current && staticMapRef.current.getMap();\n  thisRef.setState = newState => {\n    thisRef.state = {...thisRef.state, ...newState};\n    eventCanvasRef.current.style.cursor = props.getCursor(thisRef.state);\n  };\n\n  let inRender = true;\n  let viewportUpdateRequested;\n  let stateUpdateRequested;\n\n  const handleViewportChange = (viewState, interactionState, oldViewState) => {\n    if (inRender) {\n      // Do not call the callbacks during render - may result in \"cannot update during an existing state transition\" error.\n      // Defer the update until after render\n      viewportUpdateRequested = [viewState, interactionState, oldViewState];\n      return;\n    }\n    const {onViewStateChange, onViewportChange} = thisRef.props;\n\n    /* eslint-disable accessor-pairs */\n    Object.defineProperty(viewState, 'position', {\n      get: () => [0, 0, getTerrainElevation(thisRef.map, viewState)]\n    });\n\n    if (onViewStateChange) {\n      onViewStateChange({viewState, interactionState, oldViewState});\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  };\n\n  useImperativeHandle(ref, () => getRefHandles(staticMapRef), []);\n\n  const context = useMemo(\n    () => ({\n      ...parentContext,\n      eventManager,\n      container: parentContext.container || eventCanvasRef.current\n    }),\n    [parentContext, eventCanvasRef.current]\n  );\n  context.onViewportChange = handleViewportChange;\n  context.viewport = parentContext.viewport || getViewport(thisRef);\n  thisRef.viewport = context.viewport;\n\n  const handleInteractionStateChange = interactionState => {\n    const {isDragging = false} = interactionState;\n    if (isDragging !== thisRef.state.isDragging) {\n      thisRef.setState({isDragging});\n    }\n\n    if (inRender) {\n      // Do not call the callbacks during render - may result in \"cannot update during an existing state transition\" error.\n      // Defer the update until after render\n      stateUpdateRequested = interactionState;\n      return;\n    }\n\n    const {onInteractionStateChange} = thisRef.props;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  };\n\n  const updateControllerOpts = () => {\n    if (thisRef.width && thisRef.height) {\n      controller.setOptions({\n        ...thisRef.props,\n        ...thisRef.props.viewState,\n        isInteractive: Boolean(thisRef.props.onViewStateChange || thisRef.props.onViewportChange),\n        onViewportChange: handleViewportChange,\n        onStateChange: handleInteractionStateChange,\n        eventManager,\n        width: thisRef.width,\n        height: thisRef.height\n      });\n    }\n  };\n\n  const onResize = ({width, height}) => {\n    thisRef.width = width;\n    thisRef.height = height;\n    updateControllerOpts();\n    thisRef.props.onResize({width, height});\n  };\n\n  useEffect(() => {\n    eventManager.setElement(eventCanvasRef.current);\n    // Register event handlers\n    eventManager.on({\n      pointerdown: onPointerDown.bind(thisRef),\n      pointermove: onPointerMove.bind(thisRef),\n      pointerup: onPointerUp.bind(thisRef),\n      pointerleave: onEvent.bind(thisRef, 'onMouseOut'),\n      click: onPointerClick.bind(thisRef),\n      anyclick: onPointerClick.bind(thisRef),\n      dblclick: onEvent.bind(thisRef, 'onDblClick'),\n      wheel: onEvent.bind(thisRef, 'onWheel'),\n      contextmenu: onEvent.bind(thisRef, 'onContextMenu')\n    });\n\n    // Clean up on unmount\n    return () => {\n      eventManager.destroy();\n    };\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    if (viewportUpdateRequested) {\n      // Perform deferred updates\n      handleViewportChange(...viewportUpdateRequested);\n    }\n    if (stateUpdateRequested) {\n      handleInteractionStateChange(stateUpdateRequested);\n    }\n  });\n\n  updateControllerOpts();\n\n  const {width, height, style, getCursor} = props;\n\n  const eventCanvasStyle = useMemo(\n    () => ({\n      position: 'relative',\n      ...style,\n      width,\n      height,\n      cursor: getCursor(thisRef.state)\n    }),\n    [style, width, height, getCursor, thisRef.state]\n  );\n\n  if (!viewportUpdateRequested || !thisRef._child) {\n    // Only rerender if no viewport update has been requested during render.\n    // Otherwise return the last rendered child, and invoke the callback when we're done.\n    thisRef._child = (\n      <MapContextProvider value={context}>\n        <div key=\"event-canvas\" ref={eventCanvasRef} style={eventCanvasStyle}>\n          <StaticMap\n            {...props}\n            width=\"100%\"\n            height=\"100%\"\n            style={null}\n            onResize={onResize}\n            ref={staticMapRef}\n          />\n        </div>\n      </MapContextProvider>\n    );\n  }\n\n  inRender = false;\n  return thisRef._child;\n});\n\nInteractiveMap.supported = StaticMap.supported;\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\n\nexport default InteractiveMap;\n"],"file":"interactive-map.js"}