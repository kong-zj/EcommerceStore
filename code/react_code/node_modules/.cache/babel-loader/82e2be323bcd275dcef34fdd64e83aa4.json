{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _withPropsReactive = require('../utils/withPropsReactive');\n\nvar _withPropsReactive2 = _interopRequireDefault(_withPropsReactive);\n\nvar _log = require('../utils/log');\n\nvar _log2 = _interopRequireDefault(_log);\n\nvar _common = require('../utils/common');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n/*\n * props\n * {\n *  __map__ 父级组件传过来的地图实例\n * }\n */\n\n\nvar Component = _react2.default.Component;\nvar configurableProps = ['content', 'position', 'size',\n/* 以下属性是本插件的扩展 */\n'visible',\n/* 这个 setOffset  方法高德并没有明确在文档中列出来，不确定会不会撤销 */\n'offset'];\nvar allProps = configurableProps.concat(['isCustom', 'autoMove', 'closeWhenClickMap', 'showShadow']);\n\nvar InfoWindow = function (_Component) {\n  _inherits(InfoWindow, _Component);\n\n  function InfoWindow(props) {\n    _classCallCheck(this, InfoWindow);\n\n    var _this = _possibleConstructorReturn(this, (InfoWindow.__proto__ || Object.getPrototypeOf(InfoWindow)).call(this, props));\n\n    if (typeof window !== 'undefined') {\n      if (!props.__map__) {\n        _log2.default.warning('MAP_INSTANCE_REQUIRED');\n      } else {\n        var self = _this;\n        _this.setterMap = {\n          visible: function visible(val) {\n            if (val) {\n              self.showWindow();\n              self.setClassName(self.props);\n              self.setChild(self.props);\n            } else {\n              self.closeWindow();\n            }\n          }\n        };\n        _this.converterMap = {\n          size: _common.toSize,\n          offset: _common.toPixel,\n          position: _common.toLnglat\n        };\n        _this.map = props.__map__;\n        _this.isCustom = true;\n        setTimeout(function () {\n          _this.createInfoWindow(props);\n        }, 13);\n      }\n    }\n\n    return _this;\n  }\n\n  _createClass(InfoWindow, [{\n    key: 'shouldComponentUpdate',\n    value: function shouldComponentUpdate() {\n      return false;\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.map) {\n        this.refreshWindowLayout(nextProps);\n      }\n    }\n  }, {\n    key: 'createInfoWindow',\n    value: function createInfoWindow(props) {\n      var options = this.buildCreateOptions(props);\n      this.infoWindow = new window.AMap.InfoWindow(options);\n      this.props.onInstanceCreated && this.props.onInstanceCreated();\n    }\n  }, {\n    key: 'refreshWindowLayout',\n    value: function refreshWindowLayout(nextProps) {\n      this.setChild(nextProps);\n      this.setClassName(nextProps);\n    }\n  }, {\n    key: 'checkPropChanged',\n    value: function checkPropChanged(key, nextProps) {\n      return this.props[key] !== nextProps[key];\n    }\n  }, {\n    key: 'showWindow',\n    value: function showWindow() {\n      this.infoWindow.open(this.map, this.infoWindow.getPosition());\n    }\n  }, {\n    key: 'closeWindow',\n    value: function closeWindow() {\n      this.infoWindow.close();\n    }\n  }, {\n    key: 'buildCreateOptions',\n    value: function buildCreateOptions(props) {\n      var _this2 = this;\n\n      var options = {}; // 如果开发者没有设置 isCustom 属性，默认设置为 false\n\n      if ('isCustom' in props) {\n        options.isCustom = !!props.isCustom;\n      } else {\n        options.isCustom = false;\n      }\n\n      if ('content' in props) {\n        options.content = props.content;\n      } else {\n        this.infoDOM = document.createElement('div');\n        options.content = this.infoDOM;\n      }\n\n      allProps.forEach(function (key) {\n        if (key in props) {\n          if (['visible', 'isCustom', 'content'].indexOf(key) === -1) {\n            options[key] = _this2.getSetterValue(key, props[key]);\n          }\n        }\n      });\n      return options;\n    }\n  }, {\n    key: 'getSetterValue',\n    value: function getSetterValue(key, value) {\n      if (key in this.converterMap) {\n        return this.converterMap[key](value);\n      }\n\n      return value;\n    }\n  }, {\n    key: 'setChild',\n    value: function setChild(props) {\n      var child = props.children;\n\n      if (this.infoDOM && child) {\n        (0, _reactDom.render)(_react2.default.createElement('div', null, child), this.infoDOM);\n      } else {\n        if (props.children) {\n          console.warn('因为你设置 isCustom 为 true，InfoWindow 的 Children 被忽略');\n        }\n      }\n    }\n  }, {\n    key: 'setClassName',\n    value: function setClassName(props) {\n      if (this.infoDOM) {\n        var baseClsValue = ''; // 刷新 className\n\n        if ('className' in props && props.className) {\n          baseClsValue += props.className;\n        } else if (props.isCustom === true) {\n          baseClsValue += 'amap_markers_pop_window';\n        }\n\n        this.infoDOM.className = baseClsValue;\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return null;\n    }\n  }, {\n    key: 'instance',\n    get: function get() {\n      return this.infoWindow;\n    }\n  }]);\n\n  return InfoWindow;\n}(Component);\n\nexports.default = (0, _withPropsReactive2.default)(InfoWindow);","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/node_modules/react-amap/lib/infowindow/index.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_react","require","_react2","_interopRequireDefault","_reactDom","_withPropsReactive","_withPropsReactive2","_log","_log2","_common","obj","__esModule","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","Component","configurableProps","allProps","concat","InfoWindow","_Component","_this","getPrototypeOf","window","__map__","warning","setterMap","visible","val","showWindow","setClassName","setChild","closeWindow","converterMap","size","toSize","offset","toPixel","position","toLnglat","map","isCustom","setTimeout","createInfoWindow","shouldComponentUpdate","componentWillReceiveProps","nextProps","refreshWindowLayout","options","buildCreateOptions","infoWindow","AMap","onInstanceCreated","checkPropChanged","open","getPosition","close","_this2","content","infoDOM","document","createElement","forEach","indexOf","getSetterValue","child","children","render","console","warn","baseClsValue","className","get"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _withPropsReactive = require('../utils/withPropsReactive');\n\nvar _withPropsReactive2 = _interopRequireDefault(_withPropsReactive);\n\nvar _log = require('../utils/log');\n\nvar _log2 = _interopRequireDefault(_log);\n\nvar _common = require('../utils/common');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/*\n * props\n * {\n *  __map__ 父级组件传过来的地图实例\n * }\n */\n\nvar Component = _react2.default.Component;\n\nvar configurableProps = ['content', 'position', 'size',\n/* 以下属性是本插件的扩展 */\n'visible',\n\n/* 这个 setOffset  方法高德并没有明确在文档中列出来，不确定会不会撤销 */\n'offset'];\n\nvar allProps = configurableProps.concat(['isCustom', 'autoMove', 'closeWhenClickMap', 'showShadow']);\n\nvar InfoWindow = function (_Component) {\n  _inherits(InfoWindow, _Component);\n\n  function InfoWindow(props) {\n    _classCallCheck(this, InfoWindow);\n\n    var _this = _possibleConstructorReturn(this, (InfoWindow.__proto__ || Object.getPrototypeOf(InfoWindow)).call(this, props));\n\n    if (typeof window !== 'undefined') {\n      if (!props.__map__) {\n        _log2.default.warning('MAP_INSTANCE_REQUIRED');\n      } else {\n        var self = _this;\n        _this.setterMap = {\n          visible: function visible(val) {\n            if (val) {\n              self.showWindow();\n              self.setClassName(self.props);\n              self.setChild(self.props);\n            } else {\n              self.closeWindow();\n            }\n          }\n        };\n        _this.converterMap = {\n          size: _common.toSize,\n          offset: _common.toPixel,\n          position: _common.toLnglat\n        };\n        _this.map = props.__map__;\n        _this.isCustom = true;\n        setTimeout(function () {\n          _this.createInfoWindow(props);\n        }, 13);\n      }\n    }\n    return _this;\n  }\n\n  _createClass(InfoWindow, [{\n    key: 'shouldComponentUpdate',\n    value: function shouldComponentUpdate() {\n      return false;\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.map) {\n        this.refreshWindowLayout(nextProps);\n      }\n    }\n  }, {\n    key: 'createInfoWindow',\n    value: function createInfoWindow(props) {\n      var options = this.buildCreateOptions(props);\n      this.infoWindow = new window.AMap.InfoWindow(options);\n      this.props.onInstanceCreated && this.props.onInstanceCreated();\n    }\n  }, {\n    key: 'refreshWindowLayout',\n    value: function refreshWindowLayout(nextProps) {\n      this.setChild(nextProps);\n      this.setClassName(nextProps);\n    }\n  }, {\n    key: 'checkPropChanged',\n    value: function checkPropChanged(key, nextProps) {\n      return this.props[key] !== nextProps[key];\n    }\n  }, {\n    key: 'showWindow',\n    value: function showWindow() {\n      this.infoWindow.open(this.map, this.infoWindow.getPosition());\n    }\n  }, {\n    key: 'closeWindow',\n    value: function closeWindow() {\n      this.infoWindow.close();\n    }\n  }, {\n    key: 'buildCreateOptions',\n    value: function buildCreateOptions(props) {\n      var _this2 = this;\n\n      var options = {};\n\n      // 如果开发者没有设置 isCustom 属性，默认设置为 false\n      if ('isCustom' in props) {\n        options.isCustom = !!props.isCustom;\n      } else {\n        options.isCustom = false;\n      }\n\n      if ('content' in props) {\n        options.content = props.content;\n      } else {\n        this.infoDOM = document.createElement('div');\n        options.content = this.infoDOM;\n      }\n\n      allProps.forEach(function (key) {\n        if (key in props) {\n          if (['visible', 'isCustom', 'content'].indexOf(key) === -1) {\n            options[key] = _this2.getSetterValue(key, props[key]);\n          }\n        }\n      });\n      return options;\n    }\n  }, {\n    key: 'getSetterValue',\n    value: function getSetterValue(key, value) {\n      if (key in this.converterMap) {\n        return this.converterMap[key](value);\n      }\n      return value;\n    }\n  }, {\n    key: 'setChild',\n    value: function setChild(props) {\n      var child = props.children;\n      if (this.infoDOM && child) {\n        (0, _reactDom.render)(_react2.default.createElement(\n          'div',\n          null,\n          child\n        ), this.infoDOM);\n      } else {\n        if (props.children) {\n          console.warn('因为你设置 isCustom 为 true，InfoWindow 的 Children 被忽略');\n        }\n      }\n    }\n  }, {\n    key: 'setClassName',\n    value: function setClassName(props) {\n      if (this.infoDOM) {\n        var baseClsValue = '';\n        // 刷新 className\n        if ('className' in props && props.className) {\n          baseClsValue += props.className;\n        } else if (props.isCustom === true) {\n          baseClsValue += 'amap_markers_pop_window';\n        }\n        this.infoDOM.className = baseClsValue;\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      return null;\n    }\n  }, {\n    key: 'instance',\n    get: function get() {\n      return this.infoWindow;\n    }\n  }]);\n\n  return InfoWindow;\n}(Component);\n\nexports.default = (0, _withPropsReactive2.default)(InfoWindow);"]},"metadata":{},"sourceType":"script"}