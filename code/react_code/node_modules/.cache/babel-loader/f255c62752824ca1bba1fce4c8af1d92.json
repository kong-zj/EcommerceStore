{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport \"antd/es/tag/style\";\nimport _Tag from \"antd/es/tag\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/typography/style\";\nimport _Typography from \"antd/es/typography\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Finalize/index.jsx\";\nimport React, { Component } from \"react\";\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\"; //接入web3\n\nimport openNotification from \"../../Notification\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = _Select;\n\nconst suffixSelector = /*#__PURE__*/_jsxDEV(_Form.Item, {\n  name: \"PriceUnit\",\n  noStyle: true,\n  children: /*#__PURE__*/_jsxDEV(_Select, {\n    style: {\n      width: 70\n    },\n    children: [/*#__PURE__*/_jsxDEV(Option, {\n      selected: \"selected\",\n      value: \"ETH\",\n      children: \"ETH\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 19,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Option, {\n      value: \"wei\",\n      children: \"wei\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 20,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 14,\n    columnNumber: 7\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 13,\n  columnNumber: 5\n}, this);\n\nclass Finalize extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false\n    };\n\n    this.showDrawer = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.onClose = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.onFinishFinalize = values => {\n      console.log(\"申请成为仲裁人按钮被点击，onFinishFinalize 得到的数据为 : \");\n      console.dir(values); //values 中的数据示意\n      // PriceUnit: \"ETH\"\n      // ArbiterAmount: 6\n\n      if (values.PriceUnit === undefined) {\n        _message.error(\"请指定价格单位\");\n\n        return;\n      }\n\n      if (this.props.dataArray.length === 0) {\n        _message.error(\"找不到正在竞拍的商品\");\n\n        return;\n      }\n\n      let web3 = this.props.web3; //处理价格，把单位转为 wei\n\n      let arbiterPrice = -1;\n\n      if (values.PriceUnit === \"ETH\") {\n        arbiterPrice = web3.utils.toWei(values.StartPrice.toString(), 'ether');\n      } else if (values.PriceUnit === \"wei\") {\n        arbiterPrice = parseInt(values.StartPrice);\n      } //这里用于处理仲裁人的押金\n      // //单位是 wei\n\n\n      let blockChainID = this.props.dataArray[0].ID;\n      console.log(\"竞拍商品ID : \" + blockChainID); //这里与 Bid 中的相同部位不同，Bid在这里加密，在传给区块链方法\n      //Reveal 这里不加密，将明文传递给区块链方法\n      //仲裁人信息上链\n\n      let that = this;\n      this.props.truffleContract.deployed().then(async i => {\n        console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\"); //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n        //即时获取当前地址，用该地址发交易\n\n        let currentAccount = await web3.eth.getAccounts();\n\n        _message.info(\"交易发起地址为: \" + currentAccount, 2);\n\n        console.log(\"交易发起地址为: \" + currentAccount);\n\n        try {\n          //调用合约的 finalizeAuction 方法\n          await i.finalizeAuction(parseInt(blockChainID), {\n            from: currentAccount.toString()\n          }).then(res => {\n            //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n            _message.success(\"仲裁人申请成功\");\n\n            console.log(\"成功调用合约的finalizeAuction方法，返回 : \");\n            console.dir(res); //关闭侧边栏\n\n            this.onClose();\n            openNotification(\"仲裁人申请成功\", \"当买家与卖家发生交易纠纷时, 您可介入, 进行仲裁\", 'bottomLeft');\n          }); // 新版本使用 合约调用合约的形式，避免多次使用钱包转账gas，体验更好\n          //废弃\n          // that.props.tracingContract.deployed().then(async (i) =>{\n          //     try{\n          //       await i.addOneLineToInfoLine(1, blockChainID, \"成为仲裁人\", moment(Date()).format('yy年M月D日, h:mm:ss a'), { from: currentAccount.toString() }).then(res =>{\n          //         console.log(\"成功添加成为仲裁人的溯源信息，返回 : \");\n          //         console.dir(res);\n          //       })\n          //     }catch(err){\n          //       message.error(\"添加仲裁人溯源信息失败\",2);\n          //       console.log(\"调用溯源合约的addOneLineToInfoLine方法失败 \" + err);\n          //       return;\n          //     }\n          // })\n        } catch (err) {\n          _message.error(\"申请成为仲裁人失败, 买家和卖家不能申请当仲裁人, 任意的第三者可以\", 2);\n\n          console.log(\"调用合约的finalizeAuction方法失败 \");\n          console.dir(err);\n          return;\n        } //   try{\n        //     //调用合约的 highestBidderInfo 方法\n        //     await i.highestBidderInfo(parseInt(blockChainID)).then(info => {\n        //         console.log(\"成功调用合约的highestBidderInfo方法，返回 : \");\n        //         console.dir(info);\n        //         let highestBidderString = \"\";\n        //         if (info[2].toLocaleString() == '0') {\n        //             //没有人揭示报价\n        //             highestBidderString = \"拍卖结束，没有人揭示报价\";\n        //         } else {\n        //             //有人出价\n        //             highestBidderString = \"拍卖结束，最高出价竞拍人 (\" + info[0] + \") 以次高价格 (\" + handlePrice(info[2]) + \") 赢得竞拍\";\n        //         }\n        //       // 新版本使用 合约调用合约的形式，避免多次使用钱包转账gas，体验更好\n        //       //废弃\n        //       // that.props.tracingContract.deployed().then(async (i) =>{\n        //       //     try{\n        //       //       await i.addOneLineToInfoLine(1, blockChainID, highestBidderString, moment(Date()).format('yy年M月D日, h:mm:ss a'), { from: currentAccount.toString() }).then(res =>{\n        //       //         console.log(\"成功添加最高出价者的溯源信息，返回 : \");\n        //       //         console.dir(res);\n        //       //       })\n        //       //     }catch(err){\n        //       //       message.error(\"添加仲裁人溯源信息失败\",2);\n        //       //       console.log(\"调用溯源合约的addOneLineToInfoLine方法失败 \" + err);\n        //       //       return;\n        //       //     }\n        //       // })\n        //     });\n        // }catch(err) {\n        //     message.error(\"查询最高竞价人信息失败\",2);\n        //     console.log(\"调用合约的highestBidderInfo方法失败 \" + err);\n        //     return;\n        // }  \n\n      });\n    };\n\n    this.onFinishFailedFinalize = errorInfo => {\n      _message.warning(\"请正确填写信息\", 2);\n    };\n  }\n\n  async componentDidMount() {\n    console.log(\"生成Finalize模块\");\n  }\n\n  render() {\n    const {\n      Paragraph\n    } = _Typography;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\",\n        icon: /*#__PURE__*/_jsxDEV(RocketOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 56\n        }, this),\n        size: \"large\",\n        onClick: this.showDrawer,\n        children: \"\\u7533\\u8BF7\\u6210\\u4E3A\\u4EF2\\u88C1\\u4EBA\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 27\n      }, this), /*#__PURE__*/_jsxDEV(_Drawer, {\n        title: \"\\u7533\\u8BF7\\u6210\\u4E3A\\u4EF2\\u88C1\\u4EBA\",\n        width: 400,\n        onClose: this.onClose,\n        visible: this.state.visible,\n        bodyStyle: {\n          paddingBottom: 80\n        },\n        extra: /*#__PURE__*/_jsxDEV(_Space, {\n          children: /*#__PURE__*/_jsxDEV(_Button, {\n            onClick: this.onClose,\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Form, {\n          layout: \"vertical\",\n          hideRequiredMark: true,\n          onFinish: this.onFinishFinalize,\n          onFinishFailed: this.onFinishFailedFinalize,\n          children: [/*#__PURE__*/_jsxDEV(_Form.Item, {\n            name: \"ArbiterAmount\",\n            label: \"\\u4EF2\\u88C1\\u62BC\\u91D1\",\n            rules: [{\n              required: true,\n              message: '请输入仲裁押金'\n            }],\n            children: /*#__PURE__*/_jsxDEV(_InputNumber, {\n              min: 0,\n              placeholder: \"\\u5F53\\u4E70\\u5BB6\\u4E0E\\u5356\\u5BB6\\u7684\\u4EA4\\u6613\\u5B8C\\u6210\\u540E\\u5168\\u989D\\u8FD4\\u8FD8\",\n              addonAfter: suffixSelector,\n              style: {\n                width: '100%'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              disabled: this.props.truffleContract === null || this.props.web3 === null,\n              children: \"\\u63D0\\u4EA4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n            children: /*#__PURE__*/_jsxDEV(\"blockquote\", {\n              children: [\" \", /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"\\u5F53\\u4E70\\u5BB6\\u4E0E\\u5356\\u5BB6\\u4EA4\\u6613\\u6210\\u529F\\u65F6\\uFF0C\\u60A8\\u4F1A\\u5F97\\u5230\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 26\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(_Tag, {\n                  children: \"1% \\u4E70\\u5356\\u53CC\\u65B9\\u4EA4\\u6613\\u989D\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 53\n                }, this), \"\\u4E0E\", /*#__PURE__*/_jsxDEV(_Tag, {\n                  children: \"10% \\u4EF2\\u88C1\\u62BC\\u91D1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 75\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 50\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"\\u4E2D\\u7684\", /*#__PURE__*/_jsxDEV(_Tag, {\n                  children: \"\\u8F83\\u5C0F\\u8005\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 104\n                }, this), \"\\u4F5C\\u4E3A\\u62A5\\u916C\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 99\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 11\n    }, this);\n  }\n\n}\n\nexport default Finalize;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Finalize/index.jsx"],"names":["React","Component","UserOutlined","LaptopOutlined","FileSearchOutlined","HomeOutlined","EyeTwoTone","EyeInvisibleOutlined","RocketOutlined","cookie","openNotification","Option","suffixSelector","width","Finalize","constructor","props","state","visible","showDrawer","setState","onClose","onFinishFinalize","values","console","log","dir","PriceUnit","undefined","error","dataArray","length","web3","arbiterPrice","utils","toWei","StartPrice","toString","parseInt","blockChainID","ID","that","truffleContract","deployed","then","i","currentAccount","eth","getAccounts","info","finalizeAuction","from","res","success","err","onFinishFailedFinalize","errorInfo","warning","componentDidMount","render","Paragraph","paddingBottom","required","message"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { Menu, Layout, message, Drawer, Space, Button, Divider, Typography, Form, InputNumber, Input, Select, Tag } from 'antd';\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\";\n//接入web3\n\nimport openNotification from \"../../Notification\";\n\n\nconst { Option } = Select;\n\nconst suffixSelector = (\n    <Form.Item name=\"PriceUnit\" noStyle>\n      <Select\n        style={{\n          width: 70,\n        }}\n      >\n        <Option selected=\"selected\" value=\"ETH\">ETH</Option>\n        <Option value=\"wei\">wei</Option>\n      </Select>\n    </Form.Item>\n);\n\n\nclass Finalize extends Component {\n\n    state = {\n        visible: false\n    }\n\n    constructor (props) {\n        super (props);\n    }\n\n\n    async componentDidMount () {\n        console.log(\"生成Finalize模块\");\n    }\n\n    showDrawer = () => {\n        this.setState({\n          visible: true,\n        });\n      };\n    \n    onClose = () => {\n        this.setState({\n          visible: false,\n        });\n      };\n\n    //点击提交竞拍按钮，表单可以提交时\n    onFinishFinalize = (values) => {\n        console.log(\"申请成为仲裁人按钮被点击，onFinishFinalize 得到的数据为 : \");\n        console.dir(values);\n        //values 中的数据示意\n        // PriceUnit: \"ETH\"\n        // ArbiterAmount: 6\n\n        if(values.PriceUnit === undefined){\n          message.error(\"请指定价格单位\");\n          return;\n      }\n\n        if(this.props.dataArray.length === 0){\n            message.error(\"找不到正在竞拍的商品\");\n            return;\n        }\n\n        let web3 = this.props.web3;\n        //处理价格，把单位转为 wei\n        let arbiterPrice = -1;\n        if(values.PriceUnit === \"ETH\"){\n          arbiterPrice = web3.utils.toWei(values.StartPrice.toString(), 'ether');\n        }else if(values.PriceUnit === \"wei\"){\n          arbiterPrice = parseInt(values.StartPrice);\n        }\n\n        //这里用于处理仲裁人的押金\n\n\n\n        // //单位是 wei\n        let blockChainID = this.props.dataArray[0].ID;\n        console.log(\"竞拍商品ID : \" + blockChainID);\n\n        \n        //这里与 Bid 中的相同部位不同，Bid在这里加密，在传给区块链方法\n        //Reveal 这里不加密，将明文传递给区块链方法\n\n        //仲裁人信息上链\n        let that = this;\n        this.props.truffleContract.deployed().then(async (i) => {\n            console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\");\n            //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n            //即时获取当前地址，用该地址发交易\n            let currentAccount = await web3.eth.getAccounts();\n            message.info(\"交易发起地址为: \"+currentAccount, 2);\n            console.log(\"交易发起地址为: \"+currentAccount);\n\n            try{\n\n                //调用合约的 finalizeAuction 方法\n                await i.finalizeAuction(parseInt(blockChainID), { from: currentAccount.toString() }).then(res => {\n                    //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n                    message.success(\"仲裁人申请成功\");\n                    console.log(\"成功调用合约的finalizeAuction方法，返回 : \");\n                    console.dir(res);\n\n                    \n\n                    //关闭侧边栏\n                    this.onClose();\n                    openNotification(\"仲裁人申请成功\",\n                                    \"当买家与卖家发生交易纠纷时, 您可介入, 进行仲裁\" ,\n                                    'bottomLeft');\n                });\n\n                // 新版本使用 合约调用合约的形式，避免多次使用钱包转账gas，体验更好\n                //废弃\n                // that.props.tracingContract.deployed().then(async (i) =>{\n                //     try{\n                //       await i.addOneLineToInfoLine(1, blockChainID, \"成为仲裁人\", moment(Date()).format('yy年M月D日, h:mm:ss a'), { from: currentAccount.toString() }).then(res =>{\n                //         console.log(\"成功添加成为仲裁人的溯源信息，返回 : \");\n                //         console.dir(res);\n                //       })\n                //     }catch(err){\n                //       message.error(\"添加仲裁人溯源信息失败\",2);\n                //       console.log(\"调用溯源合约的addOneLineToInfoLine方法失败 \" + err);\n                //       return;\n                //     }\n                // })\n\n            }catch(err) {\n                message.error(\"申请成为仲裁人失败, 买家和卖家不能申请当仲裁人, 任意的第三者可以\",2);\n                console.log(\"调用合约的finalizeAuction方法失败 \");\n                console.dir(err);\n                return;\n            }  \n\n          //   try{\n          //     //调用合约的 highestBidderInfo 方法\n          //     await i.highestBidderInfo(parseInt(blockChainID)).then(info => {\n          //         console.log(\"成功调用合约的highestBidderInfo方法，返回 : \");\n          //         console.dir(info);\n          //         let highestBidderString = \"\";\n          //         if (info[2].toLocaleString() == '0') {\n          //             //没有人揭示报价\n          //             highestBidderString = \"拍卖结束，没有人揭示报价\";\n          //         } else {\n          //             //有人出价\n          //             highestBidderString = \"拍卖结束，最高出价竞拍人 (\" + info[0] + \") 以次高价格 (\" + handlePrice(info[2]) + \") 赢得竞拍\";\n          //         }\n\n          //       // 新版本使用 合约调用合约的形式，避免多次使用钱包转账gas，体验更好\n          //       //废弃\n          //       // that.props.tracingContract.deployed().then(async (i) =>{\n          //       //     try{\n          //       //       await i.addOneLineToInfoLine(1, blockChainID, highestBidderString, moment(Date()).format('yy年M月D日, h:mm:ss a'), { from: currentAccount.toString() }).then(res =>{\n          //       //         console.log(\"成功添加最高出价者的溯源信息，返回 : \");\n          //       //         console.dir(res);\n          //       //       })\n          //       //     }catch(err){\n          //       //       message.error(\"添加仲裁人溯源信息失败\",2);\n          //       //       console.log(\"调用溯源合约的addOneLineToInfoLine方法失败 \" + err);\n          //       //       return;\n          //       //     }\n          //       // })\n\n\n                  \n          //     });\n          // }catch(err) {\n          //     message.error(\"查询最高竞价人信息失败\",2);\n          //     console.log(\"调用合约的highestBidderInfo方法失败 \" + err);\n          //     return;\n          // }  \n        });\n\n    }\n\n\n    //点击提交竞拍按钮，表单不能提交时\n    onFinishFailedFinalize = (errorInfo) => {\n        message.warning(\"请正确填写信息\",2);\n    }\n\n   \n\n \n    \n    render () {\n        const { Paragraph } = Typography;\n        return (\n          \n\n          <div>\n\n                          <Button type=\"primary\" icon={<RocketOutlined />} size={\"large\"} onClick={this.showDrawer}>\n                申请成为仲裁人\n            </Button>\n\n            <Drawer\n          title=\"申请成为仲裁人\"\n          width={400}\n          onClose={this.onClose}\n          visible={this.state.visible}\n          bodyStyle={{ paddingBottom: 80 }}\n          extra={\n            <Space>\n              <Button onClick={this.onClose}>取消</Button>\n            </Space>\n          }\n        >\n            <Divider />\n          <Form \n            layout=\"vertical\" hideRequiredMark\n            onFinish={this.onFinishFinalize}\n            onFinishFailed={this.onFinishFailedFinalize}\n            \n          >\n            <Form.Item\n                name=\"ArbiterAmount\"\n                label=\"仲裁押金\"\n                rules={[\n                        {\n                            required: true,\n                            message: '请输入仲裁押金',\n                        },\n                ]}\n            >\n            <InputNumber\n                min={0}\n                placeholder=\"当买家与卖家的交易完成后全额返还\"\n                addonAfter={suffixSelector}\n                style={{\n                    width: '100%',\n                }}\n            />\n            </Form.Item>\n\n            <Form.Item>\n                <Button \n                type=\"primary\" \n                htmlType=\"submit\"\n                disabled={ this.props.truffleContract === null || this.props.web3 === null } \n                >\n                提交\n              </Button>\n            </Form.Item>\n            <Paragraph >\n            <p> </p>\n            </Paragraph>\n            <Paragraph >\n            <blockquote> <p>当买家与卖家交易成功时，您会得到</p> <p><Tag>1% 买卖双方交易额</Tag>与<Tag>10% 仲裁押金</Tag></p> <p>中的<Tag>较小者</Tag>作为报酬</p></blockquote> \n            </Paragraph>\n\n          </Form>\n        </Drawer>\n\n            </div>\n\n          \n\n            \n        );\n    }\n}\n\nexport default Finalize;\n"]},"metadata":{},"sourceType":"module"}