{"ast":null,"code":"import \"antd/es/timeline/style\";\nimport _Timeline from \"antd/es/timeline\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Tracing/index.jsx\";\nimport React, { Component } from \"react\";\nimport { SmileOutlined } from '@ant-design/icons'; //接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Tracing extends Component {\n  // 父组件传入\n  // web3={this.state.web3}\n  // tracingContract={this.state.tracingContract}\n  // class={1}\n  // id={productData.ID}\n  constructor(props) {\n    super(props);\n    this.state = {\n      //存储该商品的溯源时间轴数据\n      Lines: []\n    };\n\n    this.renderTracingDetails = () => {\n      if (this.props.tracingContract === null || this.props.web3 === null) {\n        _message.error(\"连接溯源合约失败\", 2);\n\n        console.log(\"[ERROR]web3 或者 tracingContract 为 null\");\n        return;\n      }\n\n      console.log(\"用来查询的信息 : \");\n      console.log(\"class : \" + this.props.class);\n      console.log(\"id : \" + this.props.id);\n      console.log(\"合约为 : \");\n      console.dir(this.props.tracingContract); //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n\n      let that = this;\n      this.props.tracingContract.deployed().then(i => {\n        console.log(\"进入 this.state.tracingContract.deployed() 的回调函数\");\n\n        try {\n          i.getInfoLine(this.props.class, this.props.id).then(res => {\n            //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用，可能出错\n            console.log(\"getInfoLine 取到的原始数据为 : \");\n            console.dir(res); // //格式化数据，便于显示\n            // let oneProductInfo = await this.formatProductInfo(res);\n            // console.log(\"格式化之后的数据 oneProductInfo 为 \");\n            // console.dir(oneProductInfo);\n            // this.setState({\n            //     dataArray : [...this.state.dataArray, oneProductInfo]\n            // });\n            // //设置cookie，不怕刷新\n            // cookie.save('searchProductID', productId, {path:'/'});\n            // message.success(\"商品ID查询成功\",2);\n          });\n        } catch (err) {\n          _message.error(\"商品溯源失败\", 2);\n\n          console.log(\"调用合约的getInfoLine方法失败 \" + err);\n        }\n      });\n    };\n\n    this.formatProductInfo = async originInfo => {\n      //从区块链里拿到的信息是这样的 res为\n      // 0: BN {negative: 0, words: Array(2), length: 1, red: null}\n      // 1: \"1212\"\n      // 2: \"艺术品,画作\"\n      // 3: 字符串数组 //product.imageLinkHash\n      // 4: \"Qmbc2XnQMmBjCPaXqWvPii1taM6VpvaWaDCGPMEm6y57nm\" //product.descHash\n      // 5: Array(3)\n      // 0: BN 开始时间(秒)\n      // 1: BN 结束时间(秒)\n      // 2: BN 揭示报价时长(分)\n      // 6: BN  //product.startPrice\n      // 7: BN  //product.status\n      // 8: BN  //product.condition\n      let oneProductInfo = {}; //格式化数据后为\n      // ID\n      // name\n      // category\n      // imageUrlArray URL字符串数组\n      // descString\n      // productCondition 全新 or 二手\n      // price\n      // originPrice\n      // processTime\n      // auctionStartTime\n      // auctionEndTime\n      // auctionRevealTime\n      // sellStatus 正在拍卖 or 卖出 or 未卖出\n\n      oneProductInfo.ID = parseInt(originInfo[0]);\n      oneProductInfo.name = originInfo[1];\n      oneProductInfo.category = originInfo[2]; //处理图片Url数组\n\n      let imageHashArray = originInfo[3];\n      let imageLinkArray = [];\n      let arrayLength = imageHashArray.length;\n      console.log(\"在详情页中渲染 \" + arrayLength + \" 张图片\");\n\n      for (let index = 0; index < arrayLength; index++) {\n        imageLinkArray[index] = ipfsReadUrlBefore + imageHashArray[index];\n      }\n\n      oneProductInfo.imageUrlArray = imageLinkArray;\n      let descString = \"商品介绍占位\";\n      await ipfs.cat(originInfo[4]).then(file => {\n        descString = file.toString();\n      });\n      oneProductInfo.descString = descString;\n      oneProductInfo.productCondition = originInfo[8] === 0 ? \"全新\" : \"二手\";\n      oneProductInfo.price = handlePrice(originInfo[6]);\n      oneProductInfo.originPrice = originInfo[6]; //把三个时间从数组 originInfo[5] 中拿出来\n      //这三个都是 bignumber\n\n      let auctionStartTime = originInfo[5][0];\n      let auctionEndTime = originInfo[5][1];\n      let auctionRevealTime = originInfo[5][2];\n      oneProductInfo.processTime = handleTimeString(auctionEndTime, \"sell\"); //这里先写死了\n      //这个是原始数据\n\n      oneProductInfo.auctionOriginEndTime = auctionEndTime; //这三个要格式化\n\n      oneProductInfo.auctionStartTime = moment(parseInt(auctionStartTime) * 1000).format('yy年M月D日, h:mm:ss a');\n      oneProductInfo.auctionEndTime = moment(parseInt(auctionEndTime) * 1000).format('yy年M月D日, h:mm:ss a');\n      oneProductInfo.auctionRevealTime = parseInt(auctionRevealTime);\n      oneProductInfo.sellStatus = originInfo[7] === 0 ? \"正在拍卖\" : originInfo[7] === 1 ? \"已售出\" : \"未售出\";\n      return oneProductInfo;\n    };\n  }\n\n  async componentDidMount() {\n    console.log(\"生成Tracing模块\"); //从区块链拿数据\n\n    this.renderTracingDetails();\n  } //调用区块链方法，得到该商品的溯源信息\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(_Timeline, {\n        children: [/*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: [\"id = \", this.props.id, \", class = \", this.props.class]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: \"Create a services site 2015-09-01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: \"Create a services site 2015-09-01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"red\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"gray\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"gray\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"#00CCFF\",\n          dot: /*#__PURE__*/_jsxDEV(SmileOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 41\n          }, this),\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Custom color testing\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 1\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Tracing;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Tracing/index.jsx"],"names":["React","Component","SmileOutlined","Tracing","constructor","props","state","Lines","renderTracingDetails","tracingContract","web3","error","console","log","class","id","dir","that","deployed","then","i","getInfoLine","res","err","formatProductInfo","originInfo","oneProductInfo","ID","parseInt","name","category","imageHashArray","imageLinkArray","arrayLength","length","index","ipfsReadUrlBefore","imageUrlArray","descString","ipfs","cat","file","toString","productCondition","price","handlePrice","originPrice","auctionStartTime","auctionEndTime","auctionRevealTime","processTime","handleTimeString","auctionOriginEndTime","moment","format","sellStatus","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { message, Timeline } from 'antd';\nimport { SmileOutlined } from '@ant-design/icons';\n//接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nclass Tracing extends Component {\n\n    state = {\n      //存储该商品的溯源时间轴数据\n      Lines : []\n    }\n\n    // 父组件传入\n    // web3={this.state.web3}\n    // tracingContract={this.state.tracingContract}\n    // class={1}\n    // id={productData.ID}\n\n    constructor (props) {\n        super (props);\n    }\n\n\n    async componentDidMount () {\n          console.log(\"生成Tracing模块\");\n          //从区块链拿数据\n          this.renderTracingDetails();      \n    }\n\n\n      //调用区块链方法，得到该商品的溯源信息\n    renderTracingDetails = () => {\n\n      if(this.props.tracingContract === null || this.props.web3 === null){\n          message.error(\"连接溯源合约失败\",2);\n          console.log(\"[ERROR]web3 或者 tracingContract 为 null\");\n          return;\n      }\n\n      console.log(\"用来查询的信息 : \");\n      console.log(\"class : \" + this.props.class);\n      console.log(\"id : \" + this.props.id);\n\n      console.log(\"合约为 : \");\n      console.dir(this.props.tracingContract);\n      \n  \n      //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n      let that = this;\n      this.props.tracingContract.deployed().then( (i) => {\n          console.log(\"进入 this.state.tracingContract.deployed() 的回调函数\");\n          try{\n              i.getInfoLine(this.props.class, this.props.id).then(res => {\n                  //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用，可能出错\n                  console.log(\"getInfoLine 取到的原始数据为 : \");\n                  console.dir(res);\n                \n\n                  // //格式化数据，便于显示\n                  // let oneProductInfo = await this.formatProductInfo(res);\n                  // console.log(\"格式化之后的数据 oneProductInfo 为 \");\n                  // console.dir(oneProductInfo);\n\n                  // this.setState({\n                  //     dataArray : [...this.state.dataArray, oneProductInfo]\n                  // });\n\n                  // //设置cookie，不怕刷新\n                  // cookie.save('searchProductID', productId, {path:'/'});\n                  // message.success(\"商品ID查询成功\",2);\n                  \n              });  \n          }catch(err) {\n              message.error(\"商品溯源失败\",2);\n              console.log(\"调用合约的getInfoLine方法失败 \" + err);\n          }\n\n          \n      });\n  }\n\n\n  //格式化溯源信息，为渲染界面做准备\n  formatProductInfo = async(originInfo) => {\n    //从区块链里拿到的信息是这样的 res为\n    // 0: BN {negative: 0, words: Array(2), length: 1, red: null}\n    // 1: \"1212\"\n    // 2: \"艺术品,画作\"\n    // 3: 字符串数组 //product.imageLinkHash\n    // 4: \"Qmbc2XnQMmBjCPaXqWvPii1taM6VpvaWaDCGPMEm6y57nm\" //product.descHash\n    // 5: Array(3)\n        // 0: BN 开始时间(秒)\n        // 1: BN 结束时间(秒)\n        // 2: BN 揭示报价时长(分)\n    // 6: BN  //product.startPrice\n    // 7: BN  //product.status\n    // 8: BN  //product.condition\n\n    let oneProductInfo = {};\n    //格式化数据后为\n    // ID\n    // name\n    // category\n    // imageUrlArray URL字符串数组\n    // descString\n    // productCondition 全新 or 二手\n    // price\n    // originPrice\n    // processTime\n    // auctionStartTime\n    // auctionEndTime\n    // auctionRevealTime\n    // sellStatus 正在拍卖 or 卖出 or 未卖出\n\n    oneProductInfo.ID = parseInt(originInfo[0]);\n    oneProductInfo.name = originInfo[1];\n    oneProductInfo.category = originInfo[2];\n\n    //处理图片Url数组\n    let imageHashArray = originInfo[3];\n    let imageLinkArray = [];\n    let arrayLength = imageHashArray.length;\n    console.log(\"在详情页中渲染 \"+ arrayLength + \" 张图片\");\n    for(let index = 0; index < arrayLength; index++){\n        imageLinkArray[index] = ipfsReadUrlBefore + imageHashArray[index];\n    }\n    oneProductInfo.imageUrlArray = imageLinkArray;\n\n    let descString = \"商品介绍占位\";\n     await ipfs.cat(originInfo[4]).then(file => {\n         descString = file.toString();\n     })\n    oneProductInfo.descString = descString;\n    oneProductInfo.productCondition = (originInfo[8] ===0) ? \"全新\" : \"二手\";\n    oneProductInfo.price = handlePrice(originInfo[6]);\n    oneProductInfo.originPrice = originInfo[6];\n\n    //把三个时间从数组 originInfo[5] 中拿出来\n    //这三个都是 bignumber\n    let auctionStartTime = originInfo[5][0];\n    let auctionEndTime = originInfo[5][1];\n    let auctionRevealTime = originInfo[5][2];\n    oneProductInfo.processTime = handleTimeString(auctionEndTime, \"sell\"); //这里先写死了\n    //这个是原始数据\n    oneProductInfo.auctionOriginEndTime = auctionEndTime;\n    //这三个要格式化\n    oneProductInfo.auctionStartTime = moment(parseInt(auctionStartTime)*1000).format('yy年M月D日, h:mm:ss a');   \n    oneProductInfo.auctionEndTime = moment(parseInt(auctionEndTime)*1000).format('yy年M月D日, h:mm:ss a');\n    oneProductInfo.auctionRevealTime = parseInt(auctionRevealTime);\n\n    oneProductInfo.sellStatus = (originInfo[7] ===0) ? \"正在拍卖\" : ((originInfo[7] ===1) ? \"已售出\" : \"未售出\");\n    return oneProductInfo;\n}\n    \n\n\n    \n    render () {\n        return (\n\n\n            <div>\n\n<Timeline>\n    <Timeline.Item color=\"green\">id = {this.props.id}, class = {this.props.class}</Timeline.Item>\n    <Timeline.Item color=\"green\">Create a services site 2015-09-01</Timeline.Item>\n    <Timeline.Item color=\"green\">Create a services site 2015-09-01</Timeline.Item>\n    <Timeline.Item color=\"red\">\n      <p>Solve initial network problems 1</p>\n      <p>Solve initial network problems 2</p>\n      <p>Solve initial network problems 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item>\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"gray\">\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"gray\">\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"#00CCFF\" dot={<SmileOutlined />}>\n      <p>Custom color testing</p>\n    </Timeline.Item>\n  </Timeline>\n\n            </div>\n        );\n    }\n}\n\nexport default Tracing;\n"]},"metadata":{},"sourceType":"module"}