{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport \"antd/es/slider/style\";\nimport _Slider from \"antd/es/slider\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/date-picker/style\";\nimport _DatePicker from \"antd/es/date-picker\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Resell/index.jsx\";\nimport React, { Component } from \"react\";\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\"; //接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nimport openNotification from \"../../Notification\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = _Select;\nconst {\n  RangePicker\n} = _DatePicker;\n\nconst suffixSelector = /*#__PURE__*/_jsxDEV(_Form.Item, {\n  name: \"PriceUnit\",\n  noStyle: true,\n  children: /*#__PURE__*/_jsxDEV(_Select, {\n    style: {\n      width: 70\n    },\n    children: [/*#__PURE__*/_jsxDEV(Option, {\n      selected: \"selected\",\n      value: \"ETH\",\n      children: \"ETH\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 20,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Option, {\n      value: \"wei\",\n      children: \"wei\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 21,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 15,\n    columnNumber: 7\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 14,\n  columnNumber: 5\n}, this);\n\nconst rangeConfig = {\n  rules: [{\n    type: 'array',\n    required: true,\n    message: '请选择时间'\n  }]\n};\n\nclass Resell extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false\n    };\n\n    this.showDrawer = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.onClose = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.onFinishResell = values => {\n      console.log(\"竞拍提交按钮被点击，onFinishBid 得到的数据为 : \");\n      console.dir(values); //values 中的数据示意\n      // BeginAndEndTime (长度为2的Moment数组)\n      // PriceUnit: \"ETH\"\n      // ProductRevealTime: 7\n      // StartPrice: 11\n\n      if (values.PriceUnit === undefined) {\n        _message.error(\"请指定价格单位\");\n\n        return;\n      }\n\n      let web3 = this.props.web3; //处理时间成int\n\n      let auctionStartTime = Date.parse(values.BeginAndEndTime[0]) / 1000;\n      let auctionEndTime = Date.parse(values.BeginAndEndTime[1]) / 1000; //处理价格，把单位转为 wei\n\n      let startPrice = -1;\n\n      if (values.PriceUnit === \"ETH\") {\n        startPrice = web3.utils.toWei(values.StartPrice, 'ether');\n      } else if (values.PriceUnit === \"wei\") {\n        startPrice = parseInt(values.StartPrice);\n      } //处理揭示报价时间，从String变成int\n\n\n      let productRevealTime = parseInt(values.ProductRevealTime); // 处理后的值, 需要传入区块链\n      // auctionStartTime\n      // auctionEndTime\n      // startPrice\n      // productRevealTime\n      //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n\n      let that = this;\n      this.props.truffleContract.deployed().then(async i => {\n        console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\"); //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n        //即时获取当前地址，用该地址发交易\n\n        let currentAccount = await web3.eth.getAccounts();\n\n        _message.info(\"交易发起地址为: \" + currentAccount, 2);\n\n        console.log(\"交易发起地址为: \" + currentAccount);\n\n        try {\n          //调用合约的 bid 方法\n          await i.bid(parseInt(blockChainID), sealedBid, {\n            from: currentAccount.toString(),\n            value: sendPrice\n          }).then(res => {\n            //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n            _message.success(\"竞价提交成功\");\n\n            console.log(\"成功调用合约的bid方法，返回 : \");\n            console.dir(res); //关闭侧边栏\n\n            this.onClose();\n            openNotification(\"竞价提交成功\", \"您的报价: \" + values.BidAmount + values.PriceUnit + \", 您的押金: \" + values.SendAmount + values.PriceUnit + \", 距离揭示报价 \" + this.props.dataArray[0].processTime, 'bottomLeft');\n          });\n        } catch (err) {\n          _message.error(\"向链上提交竞价信息失败\", 2);\n\n          console.log(\"调用合约的bid方法失败, err = \");\n          console.dir(err);\n          return;\n        }\n      });\n    };\n\n    this.onFinishFailedBid = errorInfo => {\n      _message.warning(\"请正确填写竞拍信息\", 2);\n    };\n  }\n\n  componentDidMount() {\n    console.log(\"生成Resell模块\");\n  }\n\n  //智能合约中的方法需传入\n  // uint _productId(this.props.productId), \n  // uint _auctionStartTime, uint _auctionEndTime, uint _startPrice, uint _auctionRevealTime (这四个需要用户输入)\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\",\n        icon: /*#__PURE__*/_jsxDEV(RocketOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 46\n        }, this),\n        size: \"large\",\n        onClick: this.showDrawer,\n        children: \"\\u8F6C\\u5356\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(_Drawer, {\n        title: \"\\u8F6C\\u5356\\u5546\\u54C1\",\n        width: 400,\n        onClose: this.onClose,\n        visible: this.state.visible,\n        bodyStyle: {\n          paddingBottom: 80\n        },\n        extra: /*#__PURE__*/_jsxDEV(_Space, {\n          children: /*#__PURE__*/_jsxDEV(_Button, {\n            onClick: this.onClose,\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 13\n        }, this),\n        children: /*#__PURE__*/_jsxDEV(_Form, {\n          layout: \"vertical\",\n          hideRequiredMark: true,\n          onFinish: this.onFinishResell,\n          onFinishFailed: this.onFinishFailedBid,\n          children: [/*#__PURE__*/_jsxDEV(_Form.Item, {\n            name: \"StartPrice\",\n            label: \"\\u8D77\\u62CD\\u4EF7\\u683C\",\n            rules: [{\n              required: true,\n              message: '请输入起拍价格'\n            }],\n            children: /*#__PURE__*/_jsxDEV(_InputNumber, {\n              min: 0,\n              addonAfter: suffixSelector,\n              style: {\n                width: '100%'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 1\n          }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n            name: \"BeginAndEndTime\",\n            label: \"\\u8D77\\u6B62\\u65F6\\u95F4\",\n            ...rangeConfig,\n            children: /*#__PURE__*/_jsxDEV(RangePicker, {\n              showTime: true,\n              format: \"YYYY-MM-DD HH:mm:ss\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n            name: \"ProductRevealTime\",\n            label: \"\\u63ED\\u793A\\u62A5\\u4EF7\\u6301\\u7EED\\u65F6\\u95F4\",\n            children: /*#__PURE__*/_jsxDEV(_Slider, {\n              marks: {\n                0: '0',\n                20: '20',\n                40: '40',\n                60: '60',\n                80: '80',\n                100: '100 分钟'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              disabled: this.props.truffleContract === null || this.props.web3 === null,\n              children: \"\\u63D0\\u4EA4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Resell;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Resell/index.jsx"],"names":["React","Component","UserOutlined","LaptopOutlined","FileSearchOutlined","HomeOutlined","EyeTwoTone","EyeInvisibleOutlined","RocketOutlined","cookie","openNotification","Option","RangePicker","suffixSelector","width","rangeConfig","rules","type","required","message","Resell","constructor","props","state","visible","showDrawer","setState","onClose","onFinishResell","values","console","log","dir","PriceUnit","undefined","error","web3","auctionStartTime","Date","parse","BeginAndEndTime","auctionEndTime","startPrice","utils","toWei","StartPrice","parseInt","productRevealTime","ProductRevealTime","that","truffleContract","deployed","then","i","currentAccount","eth","getAccounts","info","bid","blockChainID","sealedBid","from","toString","value","sendPrice","res","success","BidAmount","SendAmount","dataArray","processTime","err","onFinishFailedBid","errorInfo","warning","componentDidMount","render","paddingBottom"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { Menu, Layout, message, Drawer, Space, Button, Divider, Form, InputNumber, Input, Select, Slider, DatePicker } from 'antd';\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\";\n//接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\nimport openNotification from \"../../Notification\";\n\nconst { Option } = Select;\nconst { RangePicker } = DatePicker;\n\nconst suffixSelector = (\n    <Form.Item name=\"PriceUnit\" noStyle>\n      <Select\n        style={{\n          width: 70,\n        }}\n      >\n        <Option selected=\"selected\" value=\"ETH\">ETH</Option>\n        <Option value=\"wei\">wei</Option>\n      </Select>\n    </Form.Item>\n);\n\nconst rangeConfig = {\n  rules: [\n    {\n      type: 'array',\n      required: true,\n      message: '请选择时间',\n    },\n  ],\n};\n\n\n\nclass Resell extends Component {\n\n    state = {\n        visible: false\n    }\n\n    constructor (props) {\n        super (props);\n    }\n\n    componentDidMount () {\n         console.log(\"生成Resell模块\");\n    }\n\n    showDrawer = () => {\n        this.setState({\n          visible: true,\n        });\n      };\n    \n    onClose = () => {\n        this.setState({\n          visible: false,\n        });\n      };\n      \n    //点击提交竞拍按钮，表单可以提交时\n    onFinishResell = (values) => {\n        console.log(\"竞拍提交按钮被点击，onFinishBid 得到的数据为 : \");\n        console.dir(values);\n        //values 中的数据示意\n        // BeginAndEndTime (长度为2的Moment数组)\n        // PriceUnit: \"ETH\"\n        // ProductRevealTime: 7\n        // StartPrice: 11\n\n        if(values.PriceUnit === undefined){\n            message.error(\"请指定价格单位\");\n            return;\n        }\n        let web3 = this.props.web3;\n\n        //处理时间成int\n        let auctionStartTime = Date.parse(values.BeginAndEndTime[0]) / 1000;\n        let auctionEndTime = Date.parse(values.BeginAndEndTime[1]) / 1000;\n\n        //处理价格，把单位转为 wei\n        let startPrice = -1;\n        if(values.PriceUnit === \"ETH\"){\n            startPrice = web3.utils.toWei(values.StartPrice, 'ether');\n        }else if(values.PriceUnit === \"wei\"){\n            startPrice = parseInt(values.StartPrice);\n        }\n\n        //处理揭示报价时间，从String变成int\n        let productRevealTime = parseInt(values.ProductRevealTime);\n\n        // 处理后的值, 需要传入区块链\n        // auctionStartTime\n        // auctionEndTime\n        // startPrice\n        // productRevealTime\n\n        //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n        //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n        let that = this;\n        this.props.truffleContract.deployed().then(async (i) => {\n            console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\");\n            //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n            //即时获取当前地址，用该地址发交易\n            let currentAccount = await web3.eth.getAccounts();\n            message.info(\"交易发起地址为: \"+currentAccount, 2);\n            console.log(\"交易发起地址为: \"+currentAccount);\n\n            try{\n                //调用合约的 bid 方法\n                await i.bid(parseInt(blockChainID), sealedBid, { from: currentAccount.toString(), value: sendPrice}).then(res => {\n                    //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n                    message.success(\"竞价提交成功\");\n                    console.log(\"成功调用合约的bid方法，返回 : \");\n                    console.dir(res);\n                    //关闭侧边栏\n                    this.onClose();\n                    openNotification(\"竞价提交成功\",\n                                    \"您的报价: \" + values.BidAmount + values.PriceUnit + \", 您的押金: \" + values.SendAmount + values.PriceUnit + \", 距离揭示报价 \" + this.props.dataArray[0].processTime ,\n                                    'bottomLeft');\n                });\n            }catch(err) {\n                message.error(\"向链上提交竞价信息失败\",2);\n                console.log(\"调用合约的bid方法失败, err = \");\n                console.dir(err);\n                return;\n            }  \n        });\n\n    }\n\n    //点击提交竞拍按钮，表单不能提交时\n    onFinishFailedBid = (errorInfo) => {\n        message.warning(\"请正确填写竞拍信息\",2);\n    }\n\n    //智能合约中的方法需传入\n    // uint _productId(this.props.productId), \n    // uint _auctionStartTime, uint _auctionEndTime, uint _startPrice, uint _auctionRevealTime (这四个需要用户输入)\n    \n    render () {\n        return (\n\n\n            <div>\n\n                <Button type=\"primary\" icon={<RocketOutlined />} size={\"large\"} onClick={this.showDrawer}>\n                转卖\n                </Button>\n\n            <Drawer\n          title=\"转卖商品\"\n          width={400}\n          onClose={this.onClose}\n          visible={this.state.visible}\n          bodyStyle={{ paddingBottom: 80 }}\n          extra={\n            <Space>\n              <Button onClick={this.onClose}>取消</Button>\n            </Space>\n          }\n        >\n          <Form \n            layout=\"vertical\" hideRequiredMark\n            onFinish={this.onFinishResell}\n            onFinishFailed={this.onFinishFailedBid}\n          >\n\n<Form.Item\n                        name=\"StartPrice\"\n                        label=\"起拍价格\"\n                        rules={[\n                                {\n                                    required: true,\n                                    message: '请输入起拍价格',\n                                },\n                            ]}\n                    >\n                    <InputNumber\n                        min={0}\n                        addonAfter={suffixSelector}\n                        style={{\n                            width: '100%',\n                        }}\n                    />\n                    </Form.Item>\n\n                    <Form.Item name=\"BeginAndEndTime\" label=\"起止时间\" {...rangeConfig}>\n                        <RangePicker showTime format=\"YYYY-MM-DD HH:mm:ss\" />\n                    </Form.Item>\n\n\n                    <Form.Item name=\"ProductRevealTime\" label=\"揭示报价持续时间\">\n                        <Slider\n                            marks={{\n                                0: '0',\n                                20: '20',\n                                40: '40',\n                                60: '60',\n                                80: '80',\n                                100: '100 分钟',\n                            }}\n                        />\n                    </Form.Item>\n            \n            <Form.Item>\n                <Button \n                type=\"primary\" \n                htmlType=\"submit\"\n                disabled={ this.props.truffleContract === null || this.props.web3 === null } \n                >\n                提交\n              </Button>\n            </Form.Item>\n\n          </Form>\n        </Drawer>\n\n            </div>\n        );\n    }\n}\n\nexport default Resell;\n"]},"metadata":{},"sourceType":"module"}