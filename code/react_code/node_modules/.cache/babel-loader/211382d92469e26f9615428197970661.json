{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Auction/RefundFunds/index.jsx\";\nimport React, { Component } from \"react\";\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\"; //接入web3\n\nimport getWeb3 from \"../../../utils/getWeb3\";\nimport getEcommerceStore from \"../../../utils/getEcommerceStore\";\nimport openNotification from \"../../Notification\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = _Select;\n\nclass RefundFunds extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      web3: null,\n      truffleContract: null,\n      visible: false\n    };\n\n    this.getBlockChainInfo = async () => {\n      try {\n        const web3 = await getWeb3();\n        const EcommerceStore = await getEcommerceStore(web3);\n        this.setState({\n          web3: web3,\n          truffleContract: EcommerceStore\n        });\n        console.log(\"RefundFunds 的 web3 : \");\n        console.dir(web3);\n        console.log(\"RefundFunds 的 EcommerceStore : \");\n        console.dir(this.state.truffleContract);\n        return true;\n      } catch (error) {\n        // Catch any errors for any of the above operations.\n        alert(`[ERROR]接入智能合约失败.`);\n        console.error(error);\n        return false;\n      }\n    };\n\n    this.showDrawer = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.onClose = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.onFinishRefundFunds = values => {\n      console.log(\"申请成为仲裁人按钮被点击，onFinishRefundFunds 得到的数据为 : \");\n      console.dir(values); //values 中的数据示意\n\n      if (this.props.dataArray.length === 0) {\n        _message.error(\"找不到商品\");\n\n        return;\n      }\n\n      let blockChainID = this.props.dataArray[0].ID;\n      console.log(\"竞拍商品ID : \" + blockChainID); //仲裁人信息上链\n\n      let that = this;\n      this.state.truffleContract.deployed().then(async i => {\n        console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\"); //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n        //即时获取当前地址，用该地址发交易\n\n        let currentAccount = await that.state.web3.eth.getAccounts();\n\n        _message.info(\"交易发起地址为: \" + currentAccount, 2);\n\n        console.log(\"交易发起地址为: \" + currentAccount);\n\n        try {\n          //调用合约的 refundAmountToBuyer 方法\n          await i.refundAmountToBuyer(parseInt(blockChainID), {\n            from: currentAccount.toString()\n          }).then(res => {\n            //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n            _message.success(\"提交退款申请成功\");\n\n            console.log(\"成功调用合约的refundAmountToBuyer方法，返回 : \");\n            console.dir(res); //关闭侧边栏\n\n            this.onClose();\n            openNotification(\"提交退款申请成功\", \"三个人(卖家, 买家, 仲裁人)中的两人意见达成一致时, 会触发智能合约, 进行放款或退款的操作\", 'bottomLeft'); //刷新页面\n\n            that.location.reload();\n          });\n        } catch (err) {\n          _message.error(\"提交退款申请失败, 如果你不是(卖家, 买家, 仲裁人)三者之一, 这个操作对你来说是无效的\", 2);\n\n          console.log(\"调用合约的refundAmountToBuyer方法失败 \" + err);\n          return;\n        }\n      });\n    };\n\n    this.onFinishFailedRefundFunds = errorInfo => {\n      _message.warning(\"请正确填写信息\", 2);\n    };\n  }\n\n  async componentDidMount() {\n    // componentWillMount () {\n    console.log(\"生成RefundFunds模块\");\n\n    if (await this.getBlockChainInfo()) {\n      console.log(\"获得合约信息成功\");\n    } else {\n      console.log(\"获得合约信息失败\");\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\",\n        icon: /*#__PURE__*/_jsxDEV(RocketOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 42\n        }, this),\n        size: \"large\",\n        onClick: this.showDrawer,\n        children: \"\\u9000\\u8FD8\\u8D44\\u91D1\\u7ED9\\u4E70\\u5BB6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(_Drawer, {\n        title: \"\\u9000\\u8FD8\\u8D44\\u91D1\\u7ED9\\u4E70\\u5BB6\",\n        width: 400,\n        onClose: this.onClose,\n        visible: this.state.visible,\n        bodyStyle: {\n          paddingBottom: 80\n        },\n        extra: /*#__PURE__*/_jsxDEV(_Space, {\n          children: /*#__PURE__*/_jsxDEV(_Button, {\n            onClick: this.onClose,\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u8BF7\\u786E\\u8BA4\\u60A8\\u662F (\\u5356\\u5BB6, \\u4E70\\u5BB6, \\u4EF2\\u88C1\\u4EBA) \\u4E09\\u8005\\u4E4B\\u4E00\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Form, {\n          layout: \"vertical\",\n          hideRequiredMark: true,\n          onFinish: this.onFinishRefundFunds,\n          onFinishFailed: this.onFinishFailedRefundFunds,\n          children: /*#__PURE__*/_jsxDEV(_Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              disabled: this.state.truffleContract === null || this.state.web3 === null,\n              children: \"\\u786E\\u5B9A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default RefundFunds;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Auction/RefundFunds/index.jsx"],"names":["React","Component","UserOutlined","LaptopOutlined","FileSearchOutlined","HomeOutlined","EyeTwoTone","EyeInvisibleOutlined","RocketOutlined","cookie","getWeb3","getEcommerceStore","openNotification","Option","RefundFunds","constructor","props","state","web3","truffleContract","visible","getBlockChainInfo","EcommerceStore","setState","console","log","dir","error","alert","showDrawer","onClose","onFinishRefundFunds","values","dataArray","length","blockChainID","ID","that","deployed","then","i","currentAccount","eth","getAccounts","info","refundAmountToBuyer","parseInt","from","toString","res","success","location","reload","err","onFinishFailedRefundFunds","errorInfo","warning","componentDidMount","render","paddingBottom"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { Menu, Layout, message, Drawer, Space, Button, Divider, Form, InputNumber, Input, Select } from 'antd';\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\";\n//接入web3\nimport getWeb3 from \"../../../utils/getWeb3\";\nimport getEcommerceStore from \"../../../utils/getEcommerceStore\";\nimport openNotification from \"../../Notification\";\n\nconst { Option } = Select;\n\n\nclass RefundFunds extends Component {\n\n    state = {\n        web3 : null,\n        truffleContract : null,\n        visible: false\n    }\n\n    constructor (props) {\n        super (props);\n    }\n\n    getBlockChainInfo = async() => {\n        try{\n            const web3 = await getWeb3();\n            const EcommerceStore = await getEcommerceStore(web3);\n            this.setState({\n                web3: web3,\n                truffleContract:EcommerceStore\n            });\n            console.log(\"RefundFunds 的 web3 : \");\n            console.dir(web3);\n            console.log(\"RefundFunds 的 EcommerceStore : \");\n            console.dir(this.state.truffleContract);\n            return true;\n        }catch (error) {\n            // Catch any errors for any of the above operations.\n            alert(\n              `[ERROR]接入智能合约失败.`,\n            );\n            console.error(error);\n            return false;\n          }\n        \n    }\n\n    async componentDidMount () {\n        // componentWillMount () {\n            console.log(\"生成RefundFunds模块\");\n            if(await this.getBlockChainInfo()){\n                console.log(\"获得合约信息成功\");\n            }else{\n                console.log(\"获得合约信息失败\");\n            }\n        }\n\n    showDrawer = () => {\n        this.setState({\n          visible: true,\n        });\n      };\n    \n    onClose = () => {\n        this.setState({\n          visible: false,\n        });\n      };\n\n    //点击提交竞拍按钮，表单可以提交时\n    onFinishRefundFunds = (values) => {\n        console.log(\"申请成为仲裁人按钮被点击，onFinishRefundFunds 得到的数据为 : \");\n        console.dir(values);\n        //values 中的数据示意\n\n        if(this.props.dataArray.length === 0){\n            message.error(\"找不到商品\");\n            return;\n        }\n\n        let blockChainID = this.props.dataArray[0].ID;\n        console.log(\"竞拍商品ID : \" + blockChainID);\n\n        //仲裁人信息上链\n        let that = this;\n        this.state.truffleContract.deployed().then(async (i) => {\n            console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\");\n            //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n            //即时获取当前地址，用该地址发交易\n            let currentAccount = await that.state.web3.eth.getAccounts();\n            message.info(\"交易发起地址为: \"+currentAccount, 2);\n            console.log(\"交易发起地址为: \"+currentAccount);\n\n            try{\n              //调用合约的 refundAmountToBuyer 方法\n              await i.refundAmountToBuyer(parseInt(blockChainID), { from: currentAccount.toString() }).then(res => {\n                  //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n                  message.success(\"提交退款申请成功\");\n                  console.log(\"成功调用合约的refundAmountToBuyer方法，返回 : \");\n                  console.dir(res);\n                  //关闭侧边栏\n                  this.onClose();\n                  openNotification(\"提交退款申请成功\",\n                                  \"三个人(卖家, 买家, 仲裁人)中的两人意见达成一致时, 会触发智能合约, 进行放款或退款的操作\" ,\n                                  'bottomLeft');\n                  //刷新页面\n                  that.location.reload();\n              });\n          }catch(err) {\n              message.error(\"提交退款申请失败, 如果你不是(卖家, 买家, 仲裁人)三者之一, 这个操作对你来说是无效的\",2);\n              console.log(\"调用合约的refundAmountToBuyer方法失败 \" + err);\n              return;\n          }  \n        });\n\n    }\n\n\n    //点击提交竞拍按钮，表单不能提交时\n    onFinishFailedRefundFunds = (errorInfo) => {\n        message.warning(\"请正确填写信息\",2);\n    }\n\n   \n\n \n    \n    render () {\n        return (\n\n            <div>\n\n            <Button type=\"primary\" icon={<RocketOutlined />} size={\"large\"} onClick={this.showDrawer}>\n            退还资金给买家\n            </Button>\n\n            <Drawer\n          title=\"退还资金给买家\"\n          width={400}\n          onClose={this.onClose}\n          visible={this.state.visible}\n          bodyStyle={{ paddingBottom: 80 }}\n          extra={\n            <Space>\n              <Button onClick={this.onClose}>取消</Button>\n            </Space>\n          }\n        >\n            <p>请确认您是 (卖家, 买家, 仲裁人) 三者之一</p>\n            <Divider />\n          <Form \n            layout=\"vertical\" hideRequiredMark\n            onFinish={this.onFinishRefundFunds}\n            onFinishFailed={this.onFinishFailedRefundFunds}\n            \n          >\n            <Form.Item>\n                <Button \n                type=\"primary\" \n                htmlType=\"submit\"\n                disabled={ this.state.truffleContract === null || this.state.web3 === null } \n                >\n                确定\n              </Button>\n            </Form.Item>\n\n          </Form>\n        </Drawer>\n        </div>\n        );\n    }\n}\n\nexport default RefundFunds;\n"]},"metadata":{},"sourceType":"module"}