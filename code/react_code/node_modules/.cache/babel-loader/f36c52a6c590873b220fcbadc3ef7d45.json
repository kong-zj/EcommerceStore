{"ast":null,"code":"import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/tag/style\";\nimport _Tag from \"antd/es/tag\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport \"antd/es/carousel/style\";\nimport _Carousel from \"antd/es/carousel\";\nimport \"antd/es/image/style\";\nimport _Image from \"antd/es/image\";\nimport \"antd/es/typography/style\";\nimport _Typography from \"antd/es/typography\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/pages/Market/GoodsInfo/index.jsx\";\nimport React, { Component } from 'react';\nimport cookie from 'react-cookies';\nimport ipfsAPI from 'ipfs-api'; // import EditDeviceModal from \"../../EditDeviceModal\";\n\n// import axios from \"axios\";\n// import cookie from \"react-cookies\";\nimport 'antd/dist/antd.css'; // import './index.css';\n\n//竞拍模块\nimport Buy from '../../../components/Auction/Buy'; //揭示报价模块\n\nimport Sell from '../../../components/Auction/Sell'; //溯源信息展示模块\n\nimport Tracing from '../../../components/Tracing'; //接入合约\n\nimport getWeb3 from \"../../../utils/getWeb3\";\nimport getShopping from \"../../../utils/getShopping\";\nimport getTracing from '../../../utils/getTracing'; //从IPFS读取\n\nimport ipfsReadUrlBefore from '../../../config/ipfsReadUrl';\nimport ipfsAddAndCatConfig from '../../../config/ipfsAddAndCat'; //价格格式化\n\nimport handlePrice from '../../../utils/handlePrice'; //地址解析\n\nimport handleAddress from '../../../utils/handleAddress';\nimport Meta from 'antd/lib/card/Meta';\nimport Countdown from 'antd/lib/statistic/Countdown';\nimport moment from 'moment';\nimport { CheckCircleOutlined, ClockCircleOutlined, CloseCircleOutlined, ExclamationCircleOutlined, MinusCircleOutlined, SyncOutlined } from '@ant-design/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst IconText = ({\n  icon,\n  text\n}) => /*#__PURE__*/_jsxDEV(_Space, {\n  children: [/*#__PURE__*/React.createElement(icon), text]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 60,\n  columnNumber: 5\n}, this); //ipfs实例\n\n\n_c = IconText;\nconst ipfs = ipfsAPI({\n  host: ipfsAddAndCatConfig.host,\n  port: ipfsAddAndCatConfig.port,\n  protocol: ipfsAddAndCatConfig.protocol\n}); //从区块链读出某件商品信息\n\nclass ProductInfo extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      web3: null,\n      truffleContract: null,\n      tracingContract: null,\n      dataArray: [],\n      //购买按钮\n      buyVisible: false,\n      //只有卖家可见按钮\n      sellVisible: false\n    };\n\n    this.getBlockChainInfo = async () => {\n      try {\n        const web3 = await getWeb3();\n        const Shopping = await getShopping(web3);\n        const Tracing = await getTracing(web3);\n        this.setState({\n          web3: web3,\n          truffleContract: Shopping,\n          tracingContract: Tracing\n        });\n\n        _message.success(\"接入智能合约成功\", 2);\n\n        console.log(\"ProductInfo 的 web3 : \");\n        console.dir(web3);\n        console.log(\"ProductInfo 的 Shopping : \");\n        console.dir(this.state.truffleContract);\n        return true;\n      } catch (error) {\n        // Catch any errors for any of the above operations.\n        alert(`[ERROR]接入智能合约失败.`);\n        console.error(error);\n        return false;\n      }\n    };\n\n    this.controlButtonAndInfo = async p => {\n      //从区块链里拿到的信息是这样的 res为\n      // 0: BN  ID\n      // 1: String  name\n      // 2: String  class\n      // 3: [string] imageLink\n      // 4: string descLink\n      // 5: BN price\n      // 6: BN shippingTime\n      // 7: BN inStockNum\n      // 8: (2) [BN, BN] originPlace\n      // 9: BN status\n      // 0:open, 1:sold\n      let productStatus = parseInt(p[9]); //如果该地址是卖家，显示出售按钮\n      //当时是否是卖家地址，决定是否显示转卖按钮\n\n      let currentAccount = await this.state.web3.eth.getAccounts();\n      this.state.truffleContract.deployed().then(i => {\n        console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\"); //异步执行，可能报错\n        // let productId = this.state.dataArray[0].ID;\n\n        let productId = parseInt(p[0]);\n\n        try {\n          //获取卖家地址\n          i.sellerInfo(productId).then(res => {\n            console.log(\"sellerInfo return : \");\n            console.dir(res); //当时是卖家地址\n\n            if (currentAccount == res) {\n              //显示卖家出售按钮\n              this.setState({\n                sellVisible: true\n              });\n            }\n          });\n        } catch (err) {\n          _message.error(\"id = \" + productId + \"的商品的seller信息查询失败\", 2);\n\n          console.log(\"调用合约的sellerInfo方法失败 \" + err);\n        }\n      }); //p[9] = open\n\n      if (productStatus == 0) {\n        console.log(\"商品状态为 open\");\n        this.setState({\n          //开放购买按钮\n          buyVisible: true\n        });\n      } //p[9] = sold\n      else if (productStatus == 1) {\n          console.log(\"商品状态为 sold\");\n          this.setState({\n            //关闭购买按钮\n            buyVisible: false\n          });\n        }\n    };\n\n    this.onFinish = values => {\n      console.log('onFinish 的 values : ', values);\n      let decodedParams = {};\n      Object.keys(values).forEach(key => {\n        decodedParams[key] = decodeURIComponent(decodeURI(values[key]));\n      }); // console.log('onFinish 的 values 解析为 decodedParams : ', decodedParams);\n      //decodedParams 进一步格式化\n      //参数全都变成String\n\n      _message.info(\"正在提交查询数据\", 2);\n\n      try {\n        //调用之前就隐藏\n        this.renderGoodsDetails(decodedParams);\n      } catch (err) {\n        console.log(\"在区块链中查询失败\" + err);\n        return;\n      }\n    };\n\n    this.onFinishFailed = errorInfo => {\n      _message.warning(\"请正确填写商品ID信息\", 2);\n    };\n\n    this.renderGoodsDetails = params => {\n      if (this.state.truffleContract === null || this.state.web3 === null) {\n        _message.error(\"连接合约失败\", 2);\n\n        console.log(\"[ERROR]web3 或者 truffleContract 为 null\");\n        return;\n      } //传来的数据已格式化为\n      //params.ProductID (String)\n\n\n      let productId = params.ProductID;\n      console.log(\"用来查询的信息 : \");\n      console.log(\"productId : \" + productId);\n      console.log(\"合约为 : \");\n      console.dir(this.state.truffleContract); //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n\n      let that = this;\n      this.state.truffleContract.deployed().then(async i => {\n        console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\");\n\n        try {\n          //即时获取当前地址，用该地址发交易\n          let currentAccount = await that.state.web3.eth.getAccounts();\n          i.getGoods(productId, {\n            from: currentAccount.toString()\n          }).then(async res => {\n            //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用 formatProductInfo(res)，里面的 ipfs 会报错\n            console.log(\"getGoods 取到的原始数据为 : \");\n            console.dir(res); //通过 res[1]，也就是产品的name是否为空来判断\n\n            if (res[1] === \"\") {\n              _message.error(\"该ID没有对应的商品\", 2);\n\n              return;\n            } //根据当前的 res 状况，判断显示什么信息\n\n\n            this.controlButtonAndInfo(res); //格式化数据，便于显示\n\n            let oneProductInfo = await this.formatProductInfo(res);\n            console.log(\"格式化之后的数据 oneProductInfo 为 \");\n            console.dir(oneProductInfo);\n            this.setState({\n              dataArray: [...this.state.dataArray, oneProductInfo]\n            }); //设置cookie，不怕刷新\n\n            cookie.save('searchGoodsID', productId, {\n              path: '/'\n            });\n\n            _message.success(\"商品ID查询成功\", 2);\n          });\n        } catch (err) {\n          _message.error(\"商品ID查询失败\", 2);\n\n          console.log(\"调用合约的getGoods方法失败 \" + err);\n        }\n      });\n    };\n\n    this.formatProductInfo = async originInfo => {\n      //从区块链里拿到的信息是这样的 res为\n      // 0: BN  ID\n      // 1: String  name\n      // 2: String  class\n      // 3: [string] imageLink\n      // 4: string descLink\n      // 5: BN price\n      // 6: BN shippingTime\n      // 7: BN inStockNum\n      // 8: (2) [BN, BN] originPlace\n      // 9: BN status\n      let oneProductInfo = {}; //格式化数据后为\n      // ID\n      // name\n      // category\n      // imageUrlArray URL字符串数组\n      // descString\n      // price\n      // originPrice\n      // shippingTime\n      // inStockNum\n      // originPlace int数组\n      // sellStatus 正在售卖 or 已售空 \n\n      oneProductInfo.ID = parseInt(originInfo[0]);\n      oneProductInfo.name = originInfo[1];\n      oneProductInfo.category = originInfo[2]; //处理图片Url数组\n\n      let imageHashArray = originInfo[3];\n      let imageLinkArray = [];\n      let arrayLength = imageHashArray.length;\n      console.log(\"在详情页中渲染 \" + arrayLength + \" 张图片\");\n\n      for (let index = 0; index < arrayLength; index++) {\n        imageLinkArray[index] = ipfsReadUrlBefore + imageHashArray[index];\n      }\n\n      oneProductInfo.imageUrlArray = imageLinkArray;\n      let descString = \"商品介绍占位\";\n      await ipfs.cat(originInfo[4]).then(file => {\n        descString = file.toString();\n      });\n      oneProductInfo.descString = descString;\n      oneProductInfo.price = handlePrice(originInfo[5]);\n      oneProductInfo.originPrice = originInfo[5];\n      oneProductInfo.shippingTime = parseInt(originInfo[6]);\n      oneProductInfo.inStockNum = parseInt(originInfo[7]); //把发货地址的 [int,int] 解析成 string\n\n      oneProductInfo.originPlace = handleAddress([parseInt(originInfo[8][0]), parseInt(originInfo[8][1])]); // oneProductInfo.sellStatus = (parseInt(originInfo[9]) ==0) ? \"正在售卖\" : \"已售空\";\n\n      oneProductInfo.sellStatus = parseInt(originInfo[9]);\n      return oneProductInfo;\n    };\n  } //清除cookie\n\n\n  componentWillUnmount() {\n    cookie.remove('searchGoodsID', {\n      path: '/'\n    });\n  }\n\n  //componentWillMount在render之前运行\n  //componentDidMount 在render之后运行\n  //注意先后顺序，this.getBlockChainInfo 在前，that.renderGoodDetails 在后\n  async componentDidMount() {\n    // componentWillMount () {\n    let that = this;\n    console.log(\"生成GoodInfo模块\");\n\n    if (await this.getBlockChainInfo()) {\n      console.log(\"获得合约信息成功\");\n      console.log(\"componentDidMount 中查询 cookie:searchGoodsID 为 : \" + cookie.load('searchGoodsID'));\n      console.log(\"componentDidMount 中查询 this.state.dataArray 的长度为 : \" + this.state.dataArray.length); //利用 cookie，如果 cookie 中有商品ID，但是这个商品未显示，那就将它显示出来\n      //有了这个功能，从商品列表跳转到某个商品的详情页，不需要做其他操作\n\n      if (cookie.load('searchGoodsID') !== undefined && this.state.dataArray.length === 0) {\n        console.log(\"用 cookie 中包含的商品ID信息，加载商品详情页\");\n        let arg = {};\n        arg.ProductID = cookie.load('searchGoodsID');\n        that.renderGoodsDetails(arg);\n      }\n    } else {\n      console.log(\"获得合约信息失败\");\n    }\n  } //控制显示与隐藏\n  //初始状态都为 false\n  // //购买按钮\n  // buyVisible \n  // //只有卖家可见按钮\n  // sellVisible \n\n\n  render() {\n    //如果 cookie 中记录了 ID\n    // if(cookie.load('searchGoodsID') !== undefined){\n    //用 cookie 来判断显示哪个界面，要点两次提交，才能跳转到商品详情界面，并且传入了两个商品，改为使用 this.state.dataArray 是否有数据判断就好了\n    if (this.state.dataArray.length !== 0) {\n      let productData = this.state.dataArray[0];\n      const {\n        Title,\n        Paragraph,\n        Text,\n        Link\n      } = _Typography; //倒计时结束时触发\n\n      function onFinish() {\n        console.log(\"finished!\");\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(_Typography, {\n          children: [/*#__PURE__*/_jsxDEV(_Row, {\n            align: \"middle\",\n            justify: \"center\",\n            children: /*#__PURE__*/_jsxDEV(_Col, {\n              span: 24,\n              children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n                children: /*#__PURE__*/_jsxDEV(_Carousel, {\n                  autoplay: true,\n                  afterChange: () => console.log(\"轮番播放\"),\n                  children: productData.imageUrlArray.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: /*#__PURE__*/_jsxDEV(_Image, {\n                      height: 400,\n                      src: item,\n                      fallback: \"%PUBLIC_URL%/images/nullicon.svg\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 409,\n                      columnNumber: 33\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 408,\n                    columnNumber: 29\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 402,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 401,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: /*#__PURE__*/_jsxDEV(_Image.PreviewGroup, {\n                  children: productData.imageUrlArray.map(item => /*#__PURE__*/_jsxDEV(_Image, {\n                    height: 40,\n                    width: 40,\n                    src: item,\n                    fallback: \"%PUBLIC_URL%/images/nullicon.svg\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 425,\n                    columnNumber: 33\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 422,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 421,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 400,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Row, {\n            children: [/*#__PURE__*/_jsxDEV(_Col, {\n              span: 12,\n              children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n                children: [/*#__PURE__*/_jsxDEV(Title, {\n                  level: 3,\n                  children: productData.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 441,\n                  columnNumber: 25\n                }, this), productData.sellStatus]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 440,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [/*#__PURE__*/_jsxDEV(_Tag, {\n                    icon: /*#__PURE__*/_jsxDEV(CheckCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 447,\n                      columnNumber: 36\n                    }, this),\n                    color: \"success\",\n                    children: [\"ID: \", productData.ID]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 447,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(_Tag, {\n                    icon: /*#__PURE__*/_jsxDEV(MinusCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 450,\n                      columnNumber: 36\n                    }, this),\n                    color: \"default\",\n                    children: productData.category\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 450,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(_Tag, {\n                    icon: /*#__PURE__*/_jsxDEV(SyncOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 453,\n                      columnNumber: 36\n                    }, this),\n                    color: \"default\",\n                    children: productData.originPlace\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 453,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(_Tag, {\n                    icon: /*#__PURE__*/_jsxDEV(CheckCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 456,\n                      columnNumber: 36\n                    }, this),\n                    color: \"success\",\n                    children: \"\\u533A\\u5757\\u94FE\\u5B58\\u8BC1\\u6280\\u672F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 456,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 446,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 445,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(_Col, {\n              span: 12,\n              children: /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: /*#__PURE__*/_jsxDEV(_Card, {\n                  hoverable: true,\n                  style: {\n                    width: 400\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(_Col, {\n                    span: 18,\n                    style: {\n                      marginTop: 4\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 479,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Meta, {\n                    description: \"\\u552E\\u4EF7\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 483,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\" \", /*#__PURE__*/_jsxDEV(\"b\", {\n                      children: productData.price\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 484,\n                      columnNumber: 21\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 484,\n                    columnNumber: 17\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 485,\n                    columnNumber: 17\n                  }, this), /*#__PURE__*/_jsxDEV(Meta, {\n                    description: \"\\u5E93\\u5B58\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 486,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\" \", /*#__PURE__*/_jsxDEV(\"b\", {\n                      children: productData.inStockNum\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 487,\n                      columnNumber: 21\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 487,\n                    columnNumber: 17\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 488,\n                    columnNumber: 17\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: this.state.buyVisible ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: /*#__PURE__*/_jsxDEV(Buy //web3 和 truffleContract 由父组件传递进去，不用子组件自己生成\n                      , {\n                        web3: this.state.web3,\n                        truffleContract: this.state.truffleContract,\n                        price: productData.price,\n                        dataArray: this.state.dataArray //库存数量\n                        ,\n                        sumNum: productData.inStockNum\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 497,\n                        columnNumber: 25\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 495,\n                      columnNumber: 25\n                    }, this) : null\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 490,\n                    columnNumber: 13\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: this.state.sellVisible ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: /*#__PURE__*/_jsxDEV(Sell, {\n                        web3: this.state.web3,\n                        truffleContract: this.state.truffleContract,\n                        dataArray: this.state.dataArray\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 517,\n                        columnNumber: 25\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 515,\n                      columnNumber: 25\n                    }, this) : null\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 512,\n                    columnNumber: 13\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 474,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 473,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 468,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(_Row, {\n            children: [/*#__PURE__*/_jsxDEV(_Col, {\n              span: 12,\n              children: [/*#__PURE__*/_jsxDEV(Text, {\n                strong: true,\n                children: \"\\u5546\\u54C1\\u4ECB\\u7ECD\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 551,\n                columnNumber: 5\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 552,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: productData.descString\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 553,\n                columnNumber: 5\n              }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: /*#__PURE__*/_jsxDEV(\"ul\", {\n                  children: [productData.imageUrlArray.map((item, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n                    children: /*#__PURE__*/_jsxDEV(Link, {\n                      href: item,\n                      children: [\"\\u5546\\u54C1\\u56FE\\u7247\\u94FE\\u63A5\", index + 1]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 563,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 562,\n                    columnNumber: 29\n                  }, this)), /*#__PURE__*/_jsxDEV(\"li\", {\n                    children: /*#__PURE__*/_jsxDEV(Link, {\n                      href: ipfsReadUrlBefore + productData.descLink,\n                      children: \"\\u5546\\u54C1\\u4ECB\\u7ECD\\u94FE\\u63A5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 568,\n                      columnNumber: 11\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 567,\n                    columnNumber: 9\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: \"Power by IPFS\\u661F\\u9645\\u6587\\u4EF6\\u7CFB\\u7EDF\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 570,\n                    columnNumber: 9\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 558,\n                  columnNumber: 7\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 557,\n                columnNumber: 5\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 549,\n              columnNumber: 5\n            }, this), /*#__PURE__*/_jsxDEV(_Col, {\n              span: 12,\n              children: /*#__PURE__*/_jsxDEV(Paragraph, {\n                children: [/*#__PURE__*/_jsxDEV(Text, {\n                  strong: true,\n                  children: \"\\u5546\\u54C1\\u6EAF\\u6E90\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 581,\n                  columnNumber: 5\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 582,\n                  columnNumber: 5\n                }, this), /*#__PURE__*/_jsxDEV(Tracing, {\n                  web3: this.state.web3 //读取溯源合约上的信息\n                  // tracingContract={this.state.tracingContract}\n                  //入口合约\n                  ,\n                  truffleContract: this.state.truffleContract //普通商品类\n                  ,\n                  class: 2,\n                  id: productData.ID\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 584,\n                  columnNumber: 5\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 580,\n                columnNumber: 5\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 579,\n              columnNumber: 5\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 1\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 17\n      }, this);\n    } //如果cookie 中没有记录，就询问用户要查询的信息\n    else {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'center'\n          },\n          children: /*#__PURE__*/_jsxDEV(_Card, {\n            title: \"\\u67E5\\u8BE2\\u5546\\u54C1\",\n            bordered: false,\n            style: {\n              width: '80%'\n            },\n            headStyle: {\n              display: 'flex',\n              justifyContent: 'center'\n            },\n            children: /*#__PURE__*/_jsxDEV(_Form, {\n              initialValues: {\n                remember: true\n              },\n              onFinish: this.onFinish,\n              onFinishFailed: this.onFinishFailed,\n              style: {\n                margin: \"auto\",\n                width: \"60%\",\n                marginTop: \"15px\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(_Form.Item, {\n                name: \"ProductID\",\n                rules: [{\n                  required: true,\n                  message: '请输入商品ID'\n                }],\n                children: /*#__PURE__*/_jsxDEV(_InputNumber, {\n                  placeholder: \"\\u5546\\u54C1ID\",\n                  style: {\n                    width: '100%'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 629,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 620,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n                wrapperCol: {\n                  offset: 10,\n                  span: 16\n                },\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  disabled: this.state.truffleContract === null || this.state.web3 === null,\n                  type: \"primary\",\n                  htmlType: \"submit\",\n                  children: \"\\u67E5\\u8BE2\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 643,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 637,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 612,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 611,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 610,\n          columnNumber: 17\n        }, this);\n      }\n  }\n\n}\n\nexport default ProductInfo;\n\nvar _c;\n\n$RefreshReg$(_c, \"IconText\");","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/pages/Market/GoodsInfo/index.jsx"],"names":["React","Component","cookie","ipfsAPI","Buy","Sell","Tracing","getWeb3","getShopping","getTracing","ipfsReadUrlBefore","ipfsAddAndCatConfig","handlePrice","handleAddress","Meta","Countdown","moment","CheckCircleOutlined","ClockCircleOutlined","CloseCircleOutlined","ExclamationCircleOutlined","MinusCircleOutlined","SyncOutlined","IconText","icon","text","createElement","ipfs","host","port","protocol","ProductInfo","constructor","props","state","web3","truffleContract","tracingContract","dataArray","buyVisible","sellVisible","getBlockChainInfo","Shopping","setState","success","console","log","dir","error","alert","controlButtonAndInfo","p","productStatus","parseInt","currentAccount","eth","getAccounts","deployed","then","i","productId","sellerInfo","res","err","onFinish","values","decodedParams","Object","keys","forEach","key","decodeURIComponent","decodeURI","info","renderGoodsDetails","onFinishFailed","errorInfo","warning","params","ProductID","that","getGoods","from","toString","oneProductInfo","formatProductInfo","save","path","originInfo","ID","name","category","imageHashArray","imageLinkArray","arrayLength","length","index","imageUrlArray","descString","cat","file","price","originPrice","shippingTime","inStockNum","originPlace","sellStatus","componentWillUnmount","remove","componentDidMount","load","undefined","arg","render","productData","Title","Paragraph","Text","Link","map","item","width","marginTop","descLink","display","justifyContent","remember","margin","required","message","offset","span"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,OAAOC,MAAP,MAAmB,eAAnB;AACA,OAAOC,OAAP,MAAoB,UAApB,C,CACA;;AAmBA;AACA;AAEA,OAAO,oBAAP,C,CACA;;AAGA;AACA,OAAOC,GAAP,MAAgB,iCAAhB,C,CACA;;AACA,OAAOC,IAAP,MAAiB,kCAAjB,C,CAGA;;AACA,OAAOC,OAAP,MAAoB,6BAApB,C,CAEA;;AACA,OAAOC,OAAP,MAAoB,wBAApB;AACA,OAAOC,WAAP,MAAwB,4BAAxB;AACA,OAAOC,UAAP,MAAuB,2BAAvB,C,CAEA;;AACA,OAAOC,iBAAP,MAA8B,6BAA9B;AACA,OAAOC,mBAAP,MAAgC,+BAAhC,C,CAEA;;AACA,OAAOC,WAAP,MAAwB,4BAAxB,C,CACA;;AACA,OAAOC,aAAP,MAA0B,8BAA1B;AAEA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,OAAOC,SAAP,MAAsB,8BAAtB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,mBAAT,EAA8BC,mBAA9B,EAAmDC,mBAAnD,EAAwEC,yBAAxE,EAAmGC,mBAAnG,EAAwHC,YAAxH,QAA4I,mBAA5I;;;AAGA,MAAMC,QAAQ,GAAG,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAD,kBACb;AAAA,0BACGzB,KAAK,CAAC0B,aAAN,CAAoBF,IAApB,CADH,EAEGC,IAFH;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,C,CAOA;;;KAPMF,Q;AAQN,MAAMI,IAAI,GAAGxB,OAAO,CAAC;AAAEyB,EAAAA,IAAI,EAAEjB,mBAAmB,CAACiB,IAA5B;AAAkCC,EAAAA,IAAI,EAAElB,mBAAmB,CAACkB,IAA5D;AAAkEC,EAAAA,QAAQ,EAAEnB,mBAAmB,CAACmB;AAAhG,CAAD,CAApB,C,CAGA;;AACA,MAAMC,WAAN,SAA0B9B,SAA1B,CAAoC;AAahC+B,EAAAA,WAAW,CAAEC,KAAF,EAAS;AAChB,UAAMA,KAAN;AADgB,SAXpBC,KAWoB,GAXZ;AACJC,MAAAA,IAAI,EAAG,IADH;AAEJC,MAAAA,eAAe,EAAG,IAFd;AAGJC,MAAAA,eAAe,EAAG,IAHd;AAIJC,MAAAA,SAAS,EAAG,EAJR;AAKJ;AACAC,MAAAA,UAAU,EAAG,KANT;AAOJ;AACAC,MAAAA,WAAW,EAAG;AARV,KAWY;;AAAA,SAUpBC,iBAVoB,GAUA,YAAW;AAC3B,UAAG;AACC,cAAMN,IAAI,GAAG,MAAM5B,OAAO,EAA1B;AACA,cAAMmC,QAAQ,GAAG,MAAMlC,WAAW,CAAC2B,IAAD,CAAlC;AACA,cAAM7B,OAAO,GAAG,MAAMG,UAAU,CAAC0B,IAAD,CAAhC;AACA,aAAKQ,QAAL,CAAc;AACVR,UAAAA,IAAI,EAAEA,IADI;AAEVC,UAAAA,eAAe,EAACM,QAFN;AAGVL,UAAAA,eAAe,EAAC/B;AAHN,SAAd;;AAMA,iBAAQsC,OAAR,CAAgB,UAAhB,EAA4B,CAA5B;;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACAD,QAAAA,OAAO,CAACE,GAAR,CAAYZ,IAAZ;AACAU,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;AACAD,QAAAA,OAAO,CAACE,GAAR,CAAY,KAAKb,KAAL,CAAWE,eAAvB;AACA,eAAO,IAAP;AACH,OAhBD,CAgBC,OAAOY,KAAP,EAAc;AACX;AACAC,QAAAA,KAAK,CACF,kBADE,CAAL;AAGAJ,QAAAA,OAAO,CAACG,KAAR,CAAcA,KAAd;AACA,eAAO,KAAP;AACD;AAEN,KApCmB;;AAAA,SAuEpBE,oBAvEoB,GAuEG,MAAOC,CAAP,IAAa;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,UAAIC,aAAa,GAAGC,QAAQ,CAACF,CAAC,CAAC,CAAD,CAAF,CAA5B,CAdgC,CAgBhC;AACA;;AACA,UAAIG,cAAc,GAAG,MAAM,KAAKpB,KAAL,CAAWC,IAAX,CAAgBoB,GAAhB,CAAoBC,WAApB,EAA3B;AACA,WAAKtB,KAAL,CAAWE,eAAX,CAA2BqB,QAA3B,GAAsCC,IAAtC,CAA6CC,CAAD,IAAO;AAC/Cd,QAAAA,OAAO,CAACC,GAAR,CAAY,gDAAZ,EAD+C,CAG/C;AACA;;AACA,YAAIc,SAAS,GAAGP,QAAQ,CAACF,CAAC,CAAC,CAAD,CAAF,CAAxB;;AACA,YAAG;AACC;AACAQ,UAAAA,CAAC,CAACE,UAAF,CAAaD,SAAb,EAAwBF,IAAxB,CAA6BI,GAAG,IAAI;AAChCjB,YAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAD,YAAAA,OAAO,CAACE,GAAR,CAAYe,GAAZ,EAFgC,CAGhC;;AACA,gBAAGR,cAAc,IAAIQ,GAArB,EAAyB;AACrB;AACA,mBAAKnB,QAAL,CAAc;AACVH,gBAAAA,WAAW,EAAG;AADJ,eAAd;AAGH;AAEJ,WAXD;AAYH,SAdD,CAcC,OAAMuB,GAAN,EAAW;AACR,mBAAQf,KAAR,CAAc,UAAUY,SAAV,GAAsB,kBAApC,EAAuD,CAAvD;;AACAf,UAAAA,OAAO,CAACC,GAAR,CAAY,yBAAyBiB,GAArC;AACH;AAGJ,OA1BD,EAnBgC,CAgDhC;;AACA,UAAIX,aAAa,IAAI,CAArB,EAAwB;AACpBP,QAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,aAAKH,QAAL,CAAc;AACV;AACAJ,UAAAA,UAAU,EAAG;AAFH,SAAd;AAIH,OAND,CAOA;AAPA,WAQK,IAAIa,aAAa,IAAI,CAArB,EAAwB;AACzBP,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACA,eAAKH,QAAL,CAAc;AACV;AACAJ,YAAAA,UAAU,EAAG;AAFH,WAAd;AAIH;AAEJ,KAxImB;;AAAA,SA4IpByB,QA5IoB,GA4IRC,MAAD,IAAY;AACnBpB,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCmB,MAApC;AAEA,UAAIC,aAAa,GAAG,EAApB;AACAC,MAAAA,MAAM,CAACC,IAAP,CAAYH,MAAZ,EAAoBI,OAApB,CAA4BC,GAAG,IAAI;AAC/BJ,QAAAA,aAAa,CAACI,GAAD,CAAb,GAAqBC,kBAAkB,CAACC,SAAS,CAACP,MAAM,CAACK,GAAD,CAAP,CAAV,CAAvC;AACH,OAFD,EAJmB,CAOnB;AAEA;AACA;;AACA,eAAQG,IAAR,CAAa,UAAb,EAAwB,CAAxB;;AACA,UAAG;AACC;AACA,aAAKC,kBAAL,CAAwBR,aAAxB;AACH,OAHD,CAGC,OAAMH,GAAN,EAAU;AACPlB,QAAAA,OAAO,CAACC,GAAR,CAAY,cAAciB,GAA1B;AACA;AACH;AACJ,KA/JmB;;AAAA,SAmKpBY,cAnKoB,GAmKFC,SAAD,IAAe;AAC5B,eAAQC,OAAR,CAAgB,aAAhB,EAA8B,CAA9B;AACH,KArKmB;;AAAA,SA0KpBH,kBA1KoB,GA0KEI,MAAD,IAAY;AAE7B,UAAG,KAAK5C,KAAL,CAAWE,eAAX,KAA+B,IAA/B,IAAuC,KAAKF,KAAL,CAAWC,IAAX,KAAoB,IAA9D,EAAmE;AAC/D,iBAAQa,KAAR,CAAc,QAAd,EAAuB,CAAvB;;AACAH,QAAAA,OAAO,CAACC,GAAR,CAAY,uCAAZ;AACA;AACH,OAN4B,CAQ7B;AACA;;;AACA,UAAIc,SAAS,GAAGkB,MAAM,CAACC,SAAvB;AAEAlC,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiBc,SAA7B;AAEAf,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAD,MAAAA,OAAO,CAACE,GAAR,CAAY,KAAKb,KAAL,CAAWE,eAAvB,EAhB6B,CAmB7B;AACA;;AACA,UAAI4C,IAAI,GAAG,IAAX;AACA,WAAK9C,KAAL,CAAWE,eAAX,CAA2BqB,QAA3B,GAAsCC,IAAtC,CAA4C,MAAOC,CAAP,IAAa;AACrDd,QAAAA,OAAO,CAACC,GAAR,CAAY,gDAAZ;;AACA,YAAG;AACC;AACA,cAAIQ,cAAc,GAAG,MAAM0B,IAAI,CAAC9C,KAAL,CAAWC,IAAX,CAAgBoB,GAAhB,CAAoBC,WAApB,EAA3B;AACAG,UAAAA,CAAC,CAACsB,QAAF,CAAWrB,SAAX,EAAsB;AAAEsB,YAAAA,IAAI,EAAE5B,cAAc,CAAC6B,QAAf;AAAR,WAAtB,EAA0DzB,IAA1D,CAA+D,MAAMI,GAAN,IAAa;AACxE;AACAjB,YAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACAD,YAAAA,OAAO,CAACE,GAAR,CAAYe,GAAZ,EAHwE,CAIxE;;AACA,gBAAGA,GAAG,CAAC,CAAD,CAAH,KAAS,EAAZ,EAAe;AACX,uBAAQd,KAAR,CAAc,YAAd,EAA2B,CAA3B;;AACA;AACH,aARuE,CASxE;;;AACA,iBAAKE,oBAAL,CAA0BY,GAA1B,EAVwE,CAYxE;;AACA,gBAAIsB,cAAc,GAAG,MAAM,KAAKC,iBAAL,CAAuBvB,GAAvB,CAA3B;AACAjB,YAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAD,YAAAA,OAAO,CAACE,GAAR,CAAYqC,cAAZ;AAEA,iBAAKzC,QAAL,CAAc;AACVL,cAAAA,SAAS,EAAG,CAAC,GAAG,KAAKJ,KAAL,CAAWI,SAAf,EAA0B8C,cAA1B;AADF,aAAd,EAjBwE,CAqBxE;;AACAlF,YAAAA,MAAM,CAACoF,IAAP,CAAY,eAAZ,EAA6B1B,SAA7B,EAAwC;AAAC2B,cAAAA,IAAI,EAAC;AAAN,aAAxC;;AACA,qBAAQ3C,OAAR,CAAgB,UAAhB,EAA2B,CAA3B;AAEH,WAzBD;AA0BH,SA7BD,CA6BC,OAAMmB,GAAN,EAAW;AACR,mBAAQf,KAAR,CAAc,UAAd,EAAyB,CAAzB;;AACAH,UAAAA,OAAO,CAACC,GAAR,CAAY,uBAAuBiB,GAAnC;AACH;AAGJ,OArCD;AAsCH,KAtOmB;;AAAA,SAyOpBsB,iBAzOoB,GAyOA,MAAMG,UAAN,IAAqB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,UAAIJ,cAAc,GAAG,EAArB,CAbqC,CAcrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,MAAAA,cAAc,CAACK,EAAf,GAAoBpC,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAX,CAA5B;AACAJ,MAAAA,cAAc,CAACM,IAAf,GAAsBF,UAAU,CAAC,CAAD,CAAhC;AACAJ,MAAAA,cAAc,CAACO,QAAf,GAA0BH,UAAU,CAAC,CAAD,CAApC,CA7BqC,CA+BrC;;AACA,UAAII,cAAc,GAAGJ,UAAU,CAAC,CAAD,CAA/B;AACA,UAAIK,cAAc,GAAG,EAArB;AACA,UAAIC,WAAW,GAAGF,cAAc,CAACG,MAAjC;AACAlD,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAYgD,WAAZ,GAA0B,MAAtC;;AACA,WAAI,IAAIE,KAAK,GAAG,CAAhB,EAAmBA,KAAK,GAAGF,WAA3B,EAAwCE,KAAK,EAA7C,EAAgD;AAC5CH,QAAAA,cAAc,CAACG,KAAD,CAAd,GAAwBtF,iBAAiB,GAAGkF,cAAc,CAACI,KAAD,CAA1D;AACH;;AACDZ,MAAAA,cAAc,CAACa,aAAf,GAA+BJ,cAA/B;AAEA,UAAIK,UAAU,GAAG,QAAjB;AACC,YAAMvE,IAAI,CAACwE,GAAL,CAASX,UAAU,CAAC,CAAD,CAAnB,EAAwB9B,IAAxB,CAA6B0C,IAAI,IAAI;AACvCF,QAAAA,UAAU,GAAGE,IAAI,CAACjB,QAAL,EAAb;AACH,OAFK,CAAN;AAGDC,MAAAA,cAAc,CAACc,UAAf,GAA4BA,UAA5B;AAEAd,MAAAA,cAAc,CAACiB,KAAf,GAAuBzF,WAAW,CAAC4E,UAAU,CAAC,CAAD,CAAX,CAAlC;AACAJ,MAAAA,cAAc,CAACkB,WAAf,GAA6Bd,UAAU,CAAC,CAAD,CAAvC;AACAJ,MAAAA,cAAc,CAACmB,YAAf,GAA8BlD,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAX,CAAtC;AACAJ,MAAAA,cAAc,CAACoB,UAAf,GAA4BnD,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAX,CAApC,CAlDqC,CAmDrC;;AACAJ,MAAAA,cAAc,CAACqB,WAAf,GAA6B5F,aAAa,CAAC,CAACwC,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAAD,CAAT,EAA6BnC,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAV,CAAc,CAAd,CAAD,CAArC,CAAD,CAA1C,CApDqC,CAsDrC;;AACAJ,MAAAA,cAAc,CAACsB,UAAf,GAA4BrD,QAAQ,CAACmC,UAAU,CAAC,CAAD,CAAX,CAApC;AACA,aAAOJ,cAAP;AACH,KAlSmB;AAEnB,GAf+B,CAkBhC;;;AACAuB,EAAAA,oBAAoB,GAAI;AACpBzG,IAAAA,MAAM,CAAC0G,MAAP,CAAc,eAAd,EAA+B;AAAErB,MAAAA,IAAI,EAAE;AAAR,KAA/B;AACH;;AA8BD;AACA;AACA;AACuB,QAAjBsB,iBAAiB,GAAI;AAC3B;AACI,QAAI7B,IAAI,GAAG,IAAX;AACAnC,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;;AACA,QAAG,MAAM,KAAKL,iBAAL,EAAT,EAAkC;AAC9BI,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AAEAD,MAAAA,OAAO,CAACC,GAAR,CAAY,oDAAoD5C,MAAM,CAAC4G,IAAP,CAAY,eAAZ,CAAhE;AACAjE,MAAAA,OAAO,CAACC,GAAR,CAAY,uDAAuD,KAAKZ,KAAL,CAAWI,SAAX,CAAqByD,MAAxF,EAJ8B,CAK9B;AACA;;AACA,UAAG7F,MAAM,CAAC4G,IAAP,CAAY,eAAZ,MAAgCC,SAAhC,IAA6C,KAAK7E,KAAL,CAAWI,SAAX,CAAqByD,MAArB,KAAgC,CAAhF,EAAmF;AAC/ElD,QAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACA,YAAIkE,GAAG,GAAG,EAAV;AACAA,QAAAA,GAAG,CAACjC,SAAJ,GAAgB7E,MAAM,CAAC4G,IAAP,CAAY,eAAZ,CAAhB;AACA9B,QAAAA,IAAI,CAACN,kBAAL,CAAwBsC,GAAxB;AACH;AACJ,KAbD,MAaK;AACDnE,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACH;AACJ,GA1E+B,CA6EhC;AACA;AACA;AACA;AACA;AACA;;;AAgOAmE,EAAAA,MAAM,GAAI;AACN;AACA;AACA;AACA,QAAG,KAAK/E,KAAL,CAAWI,SAAX,CAAqByD,MAArB,KAAgC,CAAnC,EAAqC;AACjC,UAAImB,WAAW,GAAG,KAAKhF,KAAL,CAAWI,SAAX,CAAqB,CAArB,CAAlB;AAEA,YAAM;AAAE6E,QAAAA,KAAF;AAASC,QAAAA,SAAT;AAAoBC,QAAAA,IAApB;AAA0BC,QAAAA;AAA1B,qBAAN,CAHiC,CAKjC;;AACA,eAAStD,QAAT,GAAoB;AAChBnB,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACD;;AAEH,0BACI;AAAA,+BAEI;AAAA,kCAEA;AACI,YAAA,KAAK,EAAC,QADV;AAEI,YAAA,OAAO,EAAC,QAFZ;AAAA,mCAII;AAAK,cAAA,IAAI,EAAE,EAAX;AAAA,sCACA,QAAC,SAAD;AAAA,uCACJ;AACI,kBAAA,QAAQ,MADZ;AAEI,kBAAA,WAAW,EAAE,MAAMD,OAAO,CAACC,GAAR,CAAY,MAAZ,CAFvB;AAAA,4BAKIoE,WAAW,CAACjB,aAAZ,CAA0BsB,GAA1B,CAA+BC,IAAI,iBAC/B;AAAA,2CACI;AACI,sBAAA,MAAM,EAAE,GADZ;AAEI,sBAAA,GAAG,EAAEA,IAFT;AAGI,sBAAA,QAAQ,EAAC;AAHb;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,0BADJ;AALJ;AAAA;AAAA;AAAA;AAAA;AADI;AAAA;AAAA;AAAA;AAAA,sBADA,eAqBJ,QAAC,SAAD;AAAA,uCACA,eAAO,YAAP;AAAA,4BAEIN,WAAW,CAACjB,aAAZ,CAA0BsB,GAA1B,CAA+BC,IAAI,iBAC3B;AAAO,oBAAA,MAAM,EAAE,EAAf;AAAmB,oBAAA,KAAK,EAAE,EAA1B;AAA8B,oBAAA,GAAG,EAAEA,IAAnC;AAAyC,oBAAA,QAAQ,EAAC;AAAlD;AAAA;AAAA;AAAA;AAAA,0BADR;AAFJ;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,sBArBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAJJ;AAAA;AAAA;AAAA;AAAA,kBAFA,eAuCA;AAAA;AAAA;AAAA;AAAA,kBAvCA,eA0CA;AAAA,oCACI;AAAK,cAAA,IAAI,EAAE,EAAX;AAAA,sCAGA,QAAC,SAAD;AAAA,wCACA,QAAC,KAAD;AAAO,kBAAA,KAAK,EAAE,CAAd;AAAA,4BAAkBN,WAAW,CAACxB;AAA9B;AAAA;AAAA;AAAA;AAAA,wBADA,EAECwB,WAAW,CAACR,UAFb;AAAA;AAAA;AAAA;AAAA;AAAA,sBAHA,eAQA,QAAC,SAAD;AAAA,uCACA;AAAA,0CACA;AAAK,oBAAA,IAAI,eAAE,QAAC,mBAAD;AAAA;AAAA;AAAA;AAAA,4BAAX;AAAoC,oBAAA,KAAK,EAAC,SAA1C;AAAA,uCACSQ,WAAW,CAACzB,EADrB;AAAA;AAAA;AAAA;AAAA;AAAA,0BADA,eAIA;AAAK,oBAAA,IAAI,eAAE,QAAC,mBAAD;AAAA;AAAA;AAAA;AAAA,4BAAX;AAAoC,oBAAA,KAAK,EAAC,SAA1C;AAAA,8BACKyB,WAAW,CAACvB;AADjB;AAAA;AAAA;AAAA;AAAA,0BAJA,eAOA;AAAK,oBAAA,IAAI,eAAE,QAAC,YAAD;AAAA;AAAA;AAAA;AAAA,4BAAX;AAA6B,oBAAA,KAAK,EAAC,SAAnC;AAAA,8BACKuB,WAAW,CAACT;AADjB;AAAA;AAAA;AAAA;AAAA,0BAPA,eAUA;AAAK,oBAAA,IAAI,eAAE,QAAC,mBAAD;AAAA;AAAA;AAAA;AAAA,4BAAX;AAAoC,oBAAA,KAAK,EAAC,SAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,sBARA,eAyBA;AAAA;AAAA;AAAA;AAAA,sBAzBA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADJ,eAgCI;AAAK,cAAA,IAAI,EAAE,EAAX;AAAA,qCAKA,QAAC,SAAD;AAAA,uCACJ;AACI,kBAAA,SAAS,MADb;AAEI,kBAAA,KAAK,EAAE;AAAEgB,oBAAAA,KAAK,EAAE;AAAT,mBAFX;AAAA,0CAKI;AAAK,oBAAA,IAAI,EAAE,EAAX;AAAe,oBAAA,KAAK,EAAE;AAAEC,sBAAAA,SAAS,EAAE;AAAb;AAAtB;AAAA;AAAA;AAAA;AAAA,0BALJ,eASI,QAAC,IAAD;AAAM,oBAAA,WAAW,EAAC;AAAlB;AAAA;AAAA;AAAA;AAAA,0BATJ,eAUJ;AAAA,iDAAI;AAAA,gCAAIR,WAAW,CAACb;AAAhB;AAAA;AAAA;AAAA;AAAA,4BAAJ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAVI,eAWJ;AAAA;AAAA;AAAA;AAAA,0BAXI,eAYI,QAAC,IAAD;AAAM,oBAAA,WAAW,EAAC;AAAlB;AAAA;AAAA;AAAA;AAAA,0BAZJ,eAaJ;AAAA,iDAAI;AAAA,gCAAIa,WAAW,CAACV;AAAhB;AAAA;AAAA;AAAA;AAAA,4BAAJ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAbI,eAcJ;AAAA;AAAA;AAAA;AAAA,0BAdI,eAgBR;AAAA,8BAIQ,KAAKtE,KAAL,CAAWK,UAAX,gBACI;AAAA,6CAEA,QAAC,GAAD,CACJ;AADI;AAEJ,wBAAA,IAAI,EAAE,KAAKL,KAAL,CAAWC,IAFb;AAGJ,wBAAA,eAAe,EAAE,KAAKD,KAAL,CAAWE,eAHxB;AAIJ,wBAAA,KAAK,EAAE8E,WAAW,CAACb,KAJf;AAKJ,wBAAA,SAAS,EAAE,KAAKnE,KAAL,CAAWI,SALlB,CAMJ;AANI;AAOJ,wBAAA,MAAM,EAAE4E,WAAW,CAACV;AAPhB;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA,4BADJ,GAcE;AAlBV;AAAA;AAAA;AAAA;AAAA,0BAhBQ,eAsCR;AAAA,8BAEQ,KAAKtE,KAAL,CAAWM,WAAX,gBACI;AAAA,6CAEA,QAAC,IAAD;AACJ,wBAAA,IAAI,EAAE,KAAKN,KAAL,CAAWC,IADb;AAEJ,wBAAA,eAAe,EAAE,KAAKD,KAAL,CAAWE,eAFxB;AAGJ,wBAAA,SAAS,EAAE,KAAKF,KAAL,CAAWI;AAHlB;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA,4BADJ,GAUE;AAZV;AAAA;AAAA;AAAA;AAAA,0BAtCQ;AAAA;AAAA;AAAA;AAAA;AAAA;AADI;AAAA;AAAA;AAAA;AAAA;AALA;AAAA;AAAA;AAAA;AAAA,oBAhCJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBA1CA,eAwJA;AAAA;AAAA;AAAA;AAAA,kBAxJA,eA0JpB;AAAA,oCACI;AAAK,cAAA,IAAI,EAAE,EAAX;AAAA,sCAEA,QAAC,IAAD;AAAM,gBAAA,MAAM,MAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFA,eAGoB;AAAA;AAAA;AAAA;AAAA,sBAHpB,eAIA,QAAC,SAAD;AAAA,0BACG4E,WAAW,CAAChB;AADf;AAAA;AAAA;AAAA;AAAA,sBAJA,eAQA,QAAC,SAAD;AAAA,uCACE;AAAA,6BAGkBgB,WAAW,CAACjB,aAAZ,CAA0BsB,GAA1B,CAA+B,CAACC,IAAD,EAAMxB,KAAN,kBAC3B;AAAA,2CACA,QAAC,IAAD;AAAM,sBAAA,IAAI,EAAEwB,IAAZ;AAAA,yEAAyBxB,KAAK,GAAC,CAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,0BADJ,CAHlB,eASE;AAAA,2CACE,QAAC,IAAD;AAAM,sBAAA,IAAI,EAAEtF,iBAAiB,GAAGwG,WAAW,CAACS,QAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BATF,eAYE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAZF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBARA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADJ,eA+BI;AAAK,cAAA,IAAI,EAAE,EAAX;AAAA,qCACA,QAAC,SAAD;AAAA,wCACA,QAAC,IAAD;AAAM,kBAAA,MAAM,MAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADA,eAEA;AAAA;AAAA;AAAA;AAAA,wBAFA,eAIA,QAAC,OAAD;AACJ,kBAAA,IAAI,EAAE,KAAKzF,KAAL,CAAWC,IADb,CAEJ;AACA;AACA;AAJI;AAKJ,kBAAA,eAAe,EAAE,KAAKD,KAAL,CAAWE,eALxB,CAMJ;AANI;AAOJ,kBAAA,KAAK,EAAE,CAPH;AAQJ,kBAAA,EAAE,EAAE8E,WAAW,CAACzB;AARZ;AAAA;AAAA;AAAA;AAAA,wBAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,oBA/BJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBA1JoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAFJ;AAAA;AAAA;AAAA;AAAA,cADJ;AAsNH,KAhOD,CAkOA;AAlOA,SAmOK;AACD,4BACI;AAAK,UAAA,KAAK,EAAE;AAACmC,YAAAA,OAAO,EAAC,MAAT;AAAiBC,YAAAA,cAAc,EAAC;AAAhC,WAAZ;AAAA,iCACA;AAAM,YAAA,KAAK,EAAC,0BAAZ;AAAmB,YAAA,QAAQ,EAAE,KAA7B;AAAoC,YAAA,KAAK,EAAE;AAAEJ,cAAAA,KAAK,EAAE;AAAT,aAA3C;AAA6D,YAAA,SAAS,EAAE;AAACG,cAAAA,OAAO,EAAC,MAAT;AAAiBC,cAAAA,cAAc,EAAC;AAAhC,aAAxE;AAAA,mCACI;AACI,cAAA,aAAa,EAAE;AACXC,gBAAAA,QAAQ,EAAE;AADC,eADnB;AAII,cAAA,QAAQ,EAAE,KAAK9D,QAJnB;AAKI,cAAA,cAAc,EAAE,KAAKW,cALzB;AAMI,cAAA,KAAK,EAAE;AAACoD,gBAAAA,MAAM,EAAC,MAAR;AAAgBN,gBAAAA,KAAK,EAAC,KAAtB;AAA6BC,gBAAAA,SAAS,EAAC;AAAvC,eANX;AAAA,sCAQI,cAAM,IAAN;AACI,gBAAA,IAAI,EAAC,WADT;AAEI,gBAAA,KAAK,EAAE,CACH;AACIM,kBAAAA,QAAQ,EAAE,IADd;AAEIC,kBAAAA,OAAO,EAAE;AAFb,iBADG,CAFX;AAAA,uCASI;AAAa,kBAAA,WAAW,EAAC,gBAAzB;AACA,kBAAA,KAAK,EAAE;AACPR,oBAAAA,KAAK,EAAE;AADA;AADP;AAAA;AAAA;AAAA;AAAA;AATJ;AAAA;AAAA;AAAA;AAAA,sBARJ,eAyBI,cAAM,IAAN;AACI,gBAAA,UAAU,EAAE;AACRS,kBAAAA,MAAM,EAAE,EADA;AAERC,kBAAAA,IAAI,EAAE;AAFE,iBADhB;AAAA,uCAMI;AAAQ,kBAAA,QAAQ,EAAG,KAAKjG,KAAL,CAAWE,eAAX,KAA+B,IAA/B,IAAuC,KAAKF,KAAL,CAAWC,IAAX,KAAoB,IAA9E;AAAqF,kBAAA,IAAI,EAAC,SAA1F;AAAoG,kBAAA,QAAQ,EAAC,QAA7G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AANJ;AAAA;AAAA;AAAA;AAAA,sBAzBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,gBADJ;AA0CH;AAEJ;;AAtkB+B;;AAykBpC,eAAeJ,WAAf","sourcesContent":["import React, {Component} from 'react';\nimport cookie from 'react-cookies';\nimport ipfsAPI from 'ipfs-api';\n// import EditDeviceModal from \"../../EditDeviceModal\";\nimport { message, Card, Carousel, Drawer, Tag, Progress} from 'antd';\nimport {\n    Form,\n    Input,\n    InputNumber,\n    Cascader,\n    Select,\n    Row,\n    Col,\n    Checkbox,\n    Button,\n    Upload,\n    AutoComplete,\n    DatePicker,\n    Slider,\n    Image\n  } from 'antd';\nimport { Typography, Divider } from 'antd';\n// import axios from \"axios\";\n// import cookie from \"react-cookies\";\n\nimport 'antd/dist/antd.css';\n// import './index.css';\nimport { List, Avatar, Space} from 'antd';\n\n//竞拍模块\nimport Buy from '../../../components/Auction/Buy';\n//揭示报价模块\nimport Sell from '../../../components/Auction/Sell';\n\n\n//溯源信息展示模块\nimport Tracing from '../../../components/Tracing'; \n\n//接入合约\nimport getWeb3 from \"../../../utils/getWeb3\";\nimport getShopping from \"../../../utils/getShopping\";\nimport getTracing from '../../../utils/getTracing';\n\n//从IPFS读取\nimport ipfsReadUrlBefore from '../../../config/ipfsReadUrl';\nimport ipfsAddAndCatConfig from '../../../config/ipfsAddAndCat';\n\n//价格格式化\nimport handlePrice from '../../../utils/handlePrice';\n//地址解析\nimport handleAddress from '../../../utils/handleAddress';\n\nimport Meta from 'antd/lib/card/Meta';\nimport Countdown from 'antd/lib/statistic/Countdown';\nimport moment from 'moment';\nimport { CheckCircleOutlined, ClockCircleOutlined, CloseCircleOutlined, ExclamationCircleOutlined, MinusCircleOutlined, SyncOutlined } from '@ant-design/icons';\n\n\nconst IconText = ({ icon, text }) => (\n    <Space>\n      {React.createElement(icon)}\n      {text}\n    </Space>\n  );\n\n//ipfs实例\nconst ipfs = ipfsAPI({ host: ipfsAddAndCatConfig.host, port: ipfsAddAndCatConfig.port, protocol: ipfsAddAndCatConfig.protocol });\n\n\n//从区块链读出某件商品信息\nclass ProductInfo extends Component {\n\n    state = {\n        web3 : null,\n        truffleContract : null,\n        tracingContract : null,\n        dataArray : [],\n        //购买按钮\n        buyVisible : false,\n        //只有卖家可见按钮\n        sellVisible : false,\n    }\n\n    constructor (props) {\n        super(props);\n    }\n\n\n    //清除cookie\n    componentWillUnmount () {\n        cookie.remove('searchGoodsID', { path: '/' });\n    }\n\n    getBlockChainInfo = async() => {\n        try{\n            const web3 = await getWeb3();\n            const Shopping = await getShopping(web3);\n            const Tracing = await getTracing(web3);\n            this.setState({\n                web3: web3,\n                truffleContract:Shopping,\n                tracingContract:Tracing\n                \n            });\n            message.success(\"接入智能合约成功\", 2);\n            console.log(\"ProductInfo 的 web3 : \");\n            console.dir(web3);\n            console.log(\"ProductInfo 的 Shopping : \");\n            console.dir(this.state.truffleContract);\n            return true;\n        }catch (error) {\n            // Catch any errors for any of the above operations.\n            alert(\n              `[ERROR]接入智能合约失败.`,\n            );\n            console.error(error);\n            return false;\n          }\n        \n    }\n\n    //componentWillMount在render之前运行\n    //componentDidMount 在render之后运行\n    //注意先后顺序，this.getBlockChainInfo 在前，that.renderGoodDetails 在后\n    async componentDidMount () {\n    // componentWillMount () {\n        let that = this;\n        console.log(\"生成GoodInfo模块\");\n        if(await this.getBlockChainInfo()){\n            console.log(\"获得合约信息成功\");\n\n            console.log(\"componentDidMount 中查询 cookie:searchGoodsID 为 : \" + cookie.load('searchGoodsID'));\n            console.log(\"componentDidMount 中查询 this.state.dataArray 的长度为 : \" + this.state.dataArray.length);\n            //利用 cookie，如果 cookie 中有商品ID，但是这个商品未显示，那就将它显示出来\n            //有了这个功能，从商品列表跳转到某个商品的详情页，不需要做其他操作\n            if(cookie.load('searchGoodsID') !==undefined && this.state.dataArray.length === 0) {\n                console.log(\"用 cookie 中包含的商品ID信息，加载商品详情页\");\n                let arg = {};\n                arg.ProductID = cookie.load('searchGoodsID');\n                that.renderGoodsDetails(arg);\n            }\n        }else{\n            console.log(\"获得合约信息失败\");\n        }\n    }\n\n\n    //控制显示与隐藏\n    //初始状态都为 false\n    // //购买按钮\n    // buyVisible \n    // //只有卖家可见按钮\n    // sellVisible \n    \n    controlButtonAndInfo = async (p) => {\n        //从区块链里拿到的信息是这样的 res为\n        // 0: BN  ID\n        // 1: String  name\n        // 2: String  class\n        // 3: [string] imageLink\n        // 4: string descLink\n        // 5: BN price\n        // 6: BN shippingTime\n        // 7: BN inStockNum\n        // 8: (2) [BN, BN] originPlace\n        // 9: BN status\n\n        // 0:open, 1:sold\n        let productStatus = parseInt(p[9]);\n\n        //如果该地址是卖家，显示出售按钮\n        //当时是否是卖家地址，决定是否显示转卖按钮\n        let currentAccount = await this.state.web3.eth.getAccounts();\n        this.state.truffleContract.deployed().then( (i) => {\n            console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\");\n\n            //异步执行，可能报错\n            // let productId = this.state.dataArray[0].ID;\n            let productId = parseInt(p[0]);\n            try{\n                //获取卖家地址\n                i.sellerInfo(productId).then(res => {\n                    console.log(\"sellerInfo return : \");\n                    console.dir(res);\n                    //当时是卖家地址\n                    if(currentAccount == res){\n                        //显示卖家出售按钮\n                        this.setState({\n                            sellVisible : true,\n                        })\n                    }\n                    \n                });  \n            }catch(err) {\n                message.error(\"id = \" + productId + \"的商品的seller信息查询失败\",2);\n                console.log(\"调用合约的sellerInfo方法失败 \" + err);\n            }\n\n            \n        });\n\n\n        //p[9] = open\n        if (productStatus == 0) {\n            console.log(\"商品状态为 open\");\n            this.setState({\n                //开放购买按钮\n                buyVisible : true,\n            })\n        }\n        //p[9] = sold\n        else if (productStatus == 1) {\n            console.log(\"商品状态为 sold\");\n            this.setState({\n                //关闭购买按钮\n                buyVisible : false,\n            })\n        }\n        \n    }    \n\n\n    //点击提交按钮，表单可以提交时\n    onFinish = (values) => {\n        console.log('onFinish 的 values : ', values);\n\n        let decodedParams = {};\n        Object.keys(values).forEach(key => {\n            decodedParams[key] = decodeURIComponent(decodeURI(values[key]));\n        });\n        // console.log('onFinish 的 values 解析为 decodedParams : ', decodedParams);\n\n        //decodedParams 进一步格式化\n        //参数全都变成String\n        message.info(\"正在提交查询数据\",2);\n        try{\n            //调用之前就隐藏\n            this.renderGoodsDetails(decodedParams);\n        }catch(err){\n            console.log(\"在区块链中查询失败\" + err);\n            return;\n        }\n    }\n\n\n    //点击提交按钮，表单不能提交时\n    onFinishFailed = (errorInfo) => {\n        message.warning(\"请正确填写商品ID信息\",2);\n    }\n\n\n\n    //调用区块链方法，得到某个具体的商品信息\n    renderGoodsDetails = (params) => {\n\n        if(this.state.truffleContract === null || this.state.web3 === null){\n            message.error(\"连接合约失败\",2);\n            console.log(\"[ERROR]web3 或者 truffleContract 为 null\");\n            return;\n        }\n\n        //传来的数据已格式化为\n        //params.ProductID (String)\n        let productId = params.ProductID;\n\n        console.log(\"用来查询的信息 : \");\n        console.log(\"productId : \" + productId);\n\n        console.log(\"合约为 : \");\n        console.dir(this.state.truffleContract);\n        \n    \n        //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n        //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n        let that = this;\n        this.state.truffleContract.deployed().then( async (i) => {\n            console.log(\"进入 this.state.truffleContract.deployed() 的回调函数\");\n            try{\n                //即时获取当前地址，用该地址发交易\n                let currentAccount = await that.state.web3.eth.getAccounts();\n                i.getGoods(productId, { from: currentAccount.toString()}).then(async res => {\n                    //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用 formatProductInfo(res)，里面的 ipfs 会报错\n                    console.log(\"getGoods 取到的原始数据为 : \");\n                    console.dir(res);\n                    //通过 res[1]，也就是产品的name是否为空来判断\n                    if(res[1]===\"\"){\n                        message.error(\"该ID没有对应的商品\",2);\n                        return;\n                    }\n                    //根据当前的 res 状况，判断显示什么信息\n                    this.controlButtonAndInfo(res);\n\n                    //格式化数据，便于显示\n                    let oneProductInfo = await this.formatProductInfo(res);\n                    console.log(\"格式化之后的数据 oneProductInfo 为 \");\n                    console.dir(oneProductInfo);\n\n                    this.setState({\n                        dataArray : [...this.state.dataArray, oneProductInfo]\n                    });\n\n                    //设置cookie，不怕刷新\n                    cookie.save('searchGoodsID', productId, {path:'/'});\n                    message.success(\"商品ID查询成功\",2);\n                    \n                });  \n            }catch(err) {\n                message.error(\"商品ID查询失败\",2);\n                console.log(\"调用合约的getGoods方法失败 \" + err);\n            }\n\n            \n        });\n    }\n\n    //格式化商品信息，为渲染界面做准备\n    formatProductInfo = async(originInfo) => {\n        //从区块链里拿到的信息是这样的 res为\n        // 0: BN  ID\n        // 1: String  name\n        // 2: String  class\n        // 3: [string] imageLink\n        // 4: string descLink\n        // 5: BN price\n        // 6: BN shippingTime\n        // 7: BN inStockNum\n        // 8: (2) [BN, BN] originPlace\n        // 9: BN status\n\n        let oneProductInfo = {};\n        //格式化数据后为\n        // ID\n        // name\n        // category\n        // imageUrlArray URL字符串数组\n        // descString\n        // price\n        // originPrice\n        // shippingTime\n        // inStockNum\n        // originPlace int数组\n        // sellStatus 正在售卖 or 已售空 \n\n        oneProductInfo.ID = parseInt(originInfo[0]);\n        oneProductInfo.name = originInfo[1];\n        oneProductInfo.category = originInfo[2];\n\n        //处理图片Url数组\n        let imageHashArray = originInfo[3];\n        let imageLinkArray = [];\n        let arrayLength = imageHashArray.length;\n        console.log(\"在详情页中渲染 \"+ arrayLength + \" 张图片\");\n        for(let index = 0; index < arrayLength; index++){\n            imageLinkArray[index] = ipfsReadUrlBefore + imageHashArray[index];\n        }\n        oneProductInfo.imageUrlArray = imageLinkArray;\n\n        let descString = \"商品介绍占位\";\n         await ipfs.cat(originInfo[4]).then(file => {\n             descString = file.toString();\n         })\n        oneProductInfo.descString = descString;\n\n        oneProductInfo.price = handlePrice(originInfo[5]);\n        oneProductInfo.originPrice = originInfo[5];\n        oneProductInfo.shippingTime = parseInt(originInfo[6]);\n        oneProductInfo.inStockNum = parseInt(originInfo[7]);\n        //把发货地址的 [int,int] 解析成 string\n        oneProductInfo.originPlace = handleAddress([parseInt(originInfo[8][0]), parseInt(originInfo[8][1])]);\n\n        // oneProductInfo.sellStatus = (parseInt(originInfo[9]) ==0) ? \"正在售卖\" : \"已售空\";\n        oneProductInfo.sellStatus = parseInt(originInfo[9]);\n        return oneProductInfo;\n    }\n\n    \n    render () {\n        //如果 cookie 中记录了 ID\n        // if(cookie.load('searchGoodsID') !== undefined){\n        //用 cookie 来判断显示哪个界面，要点两次提交，才能跳转到商品详情界面，并且传入了两个商品，改为使用 this.state.dataArray 是否有数据判断就好了\n        if(this.state.dataArray.length !== 0){\n            let productData = this.state.dataArray[0];\n\n            const { Title, Paragraph, Text, Link } = Typography;\n\n            //倒计时结束时触发\n            function onFinish() {\n                console.log(\"finished!\");\n              }\n\n            return (\n                <div>        \n        \n                    <Typography>\n\n                    <Row\n                        align=\"middle\"\n                        justify=\"center\"\n                    >\n                        <Col span={24}>\n                        <Paragraph>\n                    <Carousel \n                        autoplay \n                        afterChange={() => console.log(\"轮番播放\")}\n                    >\n                    {\n                        productData.imageUrlArray.map (item => (\n                            <div>\n                                <Image \n                                    height={400}\n                                    src={item}\n                                    fallback=\"%PUBLIC_URL%/images/nullicon.svg\"\n                                   />\n                            </div>\n                        ))\n                    }  \n                    </Carousel>\n                    </Paragraph>\n                    \n\n                    <Paragraph>\n                    <Image.PreviewGroup>\n                    {\n                        productData.imageUrlArray.map (item => (\n                                <Image height={40} width={40} src={item} fallback=\"%PUBLIC_URL%/images/nullicon.svg\"/>\n                        ))\n                    }\n                    </Image.PreviewGroup>\n                    </Paragraph>\n                        </Col>\n                    </Row>\n                    \n                    <Divider />\n\n\n                    <Row>\n                        <Col span={12}>\n                            \n\n                        <Paragraph>\n                        <Title level={3}>{productData.name}</Title>\n                        {productData.sellStatus}\n                        </Paragraph>\n\n                        <Paragraph>\n                        <span>\n                        <Tag icon={<CheckCircleOutlined />} color=\"success\">\n                            ID: {productData.ID}\n                        </Tag>\n                        <Tag icon={<MinusCircleOutlined />} color=\"default\">\n                            {productData.category}\n                        </Tag>\n                        <Tag icon={<SyncOutlined />} color=\"default\">\n                            {productData.originPlace}\n                        </Tag>\n                        <Tag icon={<CheckCircleOutlined />} color=\"success\">\n                            区块链存证技术\n                        </Tag>\n                        </span>\n                        </Paragraph>\n\n                        <div>\n\n    </div>\n\n\n                        </Col>\n                        <Col span={12}>\n\n\n\n\n                        <Paragraph>\n                    <Card\n                        hoverable\n                        style={{ width: 400 }}\n                        \n                    >\n                        <Col span={18} style={{ marginTop: 4 }}>\n\n                        </Col>\n\n                        <Meta description=\"售价\"/>\n                <p> <b>{productData.price}</b></p>\n                <p></p>\n                        <Meta description=\"库存\"/>\n                <p> <b>{productData.inStockNum}</b></p>\n                <p></p>\n\n            <div>\n\n                            \n                {\n                    this.state.buyVisible?(\n                        <div>\n                        \n                        <Buy\n                    //web3 和 truffleContract 由父组件传递进去，不用子组件自己生成\n                    web3={this.state.web3}\n                    truffleContract={this.state.truffleContract}\n                    price={productData.price}\n                    dataArray={this.state.dataArray}\n                    //库存数量\n                    sumNum={productData.inStockNum}\n                        ></Buy>\n\n                        </div>\n                    ):null\n                }\n            </div>\n\n            <div>\n                {\n                    this.state.sellVisible?(\n                        <div>\n                        \n                        <Sell \n                    web3={this.state.web3}\n                    truffleContract={this.state.truffleContract}\n                    dataArray={this.state.dataArray}\n                        ></Sell>\n\n                        </div>\n                    ):null\n                }\n            </div>\n\n\n\n                \n\n            \n                    </Card>\n                    </Paragraph>\n\n\n\n\n                    \n                        </Col>\n                    </Row>\n                    \n                                   \n     \n\n                    <Divider />\n\n<Row>\n    <Col span={12}>\n        \n    <Text strong>商品介绍</Text>\n                        <p></p>\n    <Paragraph>\n      {productData.descString}\n    </Paragraph>\n\n    <Paragraph>\n      <ul>\n\n      {\n                        productData.imageUrlArray.map ((item,index) => (\n                            <li>\n                            <Link href={item}>商品图片链接{index+1}</Link>\n                            </li>\n                        ))\n    }  \n        <li>\n          <Link href={ipfsReadUrlBefore + productData.descLink}>商品介绍链接</Link>\n        </li>\n        <p>Power by IPFS星际文件系统</p>\n      </ul>\n    </Paragraph>\n                        \n\n\n    </Col>\n\n\n    <Col span={12}>\n    <Paragraph>\n    <Text strong>商品溯源</Text>\n    <p></p>\n\n    <Tracing \nweb3={this.state.web3}\n//读取溯源合约上的信息\n// tracingContract={this.state.tracingContract}\n//入口合约\ntruffleContract={this.state.truffleContract}\n//普通商品类\nclass={2}\nid={productData.ID}\n    ></Tracing>\n    \n</Paragraph>\n</Col>\n</Row>\n\n\n  </Typography>\n  \n    \n        </div>\n            );\n        }\n\n        //如果cookie 中没有记录，就询问用户要查询的信息\n        else {\n            return (\n                <div style={{display:'flex', justifyContent:'center'}}>\n                <Card title=\"查询商品\" bordered={false} style={{ width: '80%' }} headStyle={{display:'flex', justifyContent:'center'}}>\n                    <Form\n                        initialValues={{\n                            remember: true,\n                        }}\n                        onFinish={this.onFinish}\n                        onFinishFailed={this.onFinishFailed}\n                        style={{margin:\"auto\", width:\"60%\", marginTop:\"15px\"}}\n                    >\n                        <Form.Item\n                            name=\"ProductID\"\n                            rules={[\n                                {\n                                    required: true,\n                                    message: '请输入商品ID',\n                                },\n                            ]}\n                        >\n                            <InputNumber placeholder=\"商品ID\" \n                            style={{\n                            width: '100%',\n                            }}/>\n                        </Form.Item>\n    \n\n    \n                        <Form.Item\n                            wrapperCol={{\n                                offset: 10,\n                                span: 16,\n                            }}\n                        >\n                            <Button disabled={ this.state.truffleContract === null || this.state.web3 === null } type=\"primary\" htmlType=\"submit\">\n                                查询\n                            </Button>\n                        </Form.Item>\n                    </Form>\n                </Card>\n            </div>\n            );\n        }\n        \n    }\n}\n\nexport default ProductInfo;\n\n"]},"metadata":{},"sourceType":"module"}