{"ast":null,"code":"import \"antd/es/timeline/style\";\nimport _Timeline from \"antd/es/timeline\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Tracing/index.jsx\";\nimport React, { Component } from \"react\";\nimport { SmileOutlined } from '@ant-design/icons'; //接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Tracing extends Component {\n  // 父组件传入\n  // web3={this.state.web3}\n  // tracingContract={this.state.tracingContract}\n  // class={1}\n  // id={productData.ID}\n  constructor(props) {\n    super(props);\n    this.state = {\n      //存储该商品的溯源时间轴数据\n      Lines: []\n    };\n\n    this.renderTracingDetails = () => {\n      if (this.props.tracingContract === null || this.props.web3 === null) {\n        _message.error(\"连接溯源合约失败\", 2);\n\n        console.log(\"[ERROR]web3 或者 tracingContract 为 null\");\n        return;\n      }\n\n      console.log(\"用来查询的信息 : \");\n      console.log(\"class : \" + this.props.class);\n      console.log(\"id : \" + this.props.id);\n      console.log(\"合约为 : \");\n      console.dir(this.props.tracingContract); //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n\n      let that = this;\n      this.state.truffleContract.deployed().then(i => {\n        console.log(\"进入 this.state.tracingContract.deployed() 的回调函数\");\n\n        try {\n          i.getInfoLine(this.props.class, this.props.id).then(async res => {\n            //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用，可能出错\n            console.log(\"getProduct 取到的原始数据为 : \");\n            console.dir(res); //通过 res[1]，也就是产品的name是否为空来判断\n\n            if (res[1] === \"\") {\n              _message.error(\"该ID没有对应的商品\", 2);\n\n              return;\n            } //格式化数据，便于显示\n\n\n            let oneProductInfo = await this.formatProductInfo(res);\n            console.log(\"格式化之后的数据 oneProductInfo 为 \");\n            console.dir(oneProductInfo);\n            this.setState({\n              dataArray: [...this.state.dataArray, oneProductInfo]\n            }); //设置cookie，不怕刷新\n\n            cookie.save('searchProductID', productId, {\n              path: '/'\n            });\n\n            _message.success(\"商品ID查询成功\", 2);\n          });\n        } catch (err) {\n          _message.error(\"商品ID查询失败\", 2);\n\n          console.log(\"调用合约的getProduct方法失败 \" + err);\n        }\n      });\n    };\n  }\n\n  async componentDidMount() {\n    console.log(\"生成Tracing模块\"); //从区块链拿数据\n\n    this.renderTracingDetails();\n  } //调用区块链方法，得到该商品的溯源信息\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(_Timeline, {\n        children: [/*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: [\"id = \", this.props.id, \", class = \", this.props.class]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: \"Create a services site 2015-09-01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"green\",\n          children: \"Create a services site 2015-09-01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"red\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Solve initial network problems 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"gray\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"gray\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Technical testing 3 2015-09-01\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(_Timeline.Item, {\n          color: \"#00CCFF\",\n          dot: /*#__PURE__*/_jsxDEV(SmileOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 41\n          }, this),\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Custom color testing\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 1\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Tracing;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Tracing/index.jsx"],"names":["React","Component","SmileOutlined","Tracing","constructor","props","state","Lines","renderTracingDetails","tracingContract","web3","error","console","log","class","id","dir","that","truffleContract","deployed","then","i","getInfoLine","res","oneProductInfo","formatProductInfo","setState","dataArray","cookie","save","productId","path","success","err","componentDidMount","render"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { message, Timeline } from 'antd';\nimport { SmileOutlined } from '@ant-design/icons';\n//接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nclass Tracing extends Component {\n\n    state = {\n      //存储该商品的溯源时间轴数据\n      Lines : []\n    }\n\n    // 父组件传入\n    // web3={this.state.web3}\n    // tracingContract={this.state.tracingContract}\n    // class={1}\n    // id={productData.ID}\n\n    constructor (props) {\n        super (props);\n    }\n\n\n    async componentDidMount () {\n          console.log(\"生成Tracing模块\");\n          //从区块链拿数据\n          this.renderTracingDetails();      \n    }\n\n\n      //调用区块链方法，得到该商品的溯源信息\n    renderTracingDetails = () => {\n\n      if(this.props.tracingContract === null || this.props.web3 === null){\n          message.error(\"连接溯源合约失败\",2);\n          console.log(\"[ERROR]web3 或者 tracingContract 为 null\");\n          return;\n      }\n\n      console.log(\"用来查询的信息 : \");\n      console.log(\"class : \" + this.props.class);\n      console.log(\"id : \" + this.props.id);\n\n      console.log(\"合约为 : \");\n      console.dir(this.props.tracingContract);\n      \n  \n      //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n      let that = this;\n      this.state.truffleContract.deployed().then( (i) => {\n          console.log(\"进入 this.state.tracingContract.deployed() 的回调函数\");\n          try{\n              i.getInfoLine(this.props.class, this.props.id).then(async res => {\n                  //可能返回为空，要判断是否真的取到了数据，如果不判断，直接调用，可能出错\n                  console.log(\"getProduct 取到的原始数据为 : \");\n                  console.dir(res);\n                  //通过 res[1]，也就是产品的name是否为空来判断\n                  if(res[1]===\"\"){\n                      message.error(\"该ID没有对应的商品\",2);\n                      return;\n                  }\n   \n\n                  //格式化数据，便于显示\n                  let oneProductInfo = await this.formatProductInfo(res);\n                  console.log(\"格式化之后的数据 oneProductInfo 为 \");\n                  console.dir(oneProductInfo);\n\n                  this.setState({\n                      dataArray : [...this.state.dataArray, oneProductInfo]\n                  });\n\n                  //设置cookie，不怕刷新\n                  cookie.save('searchProductID', productId, {path:'/'});\n                  message.success(\"商品ID查询成功\",2);\n                  \n              });  \n          }catch(err) {\n              message.error(\"商品ID查询失败\",2);\n              console.log(\"调用合约的getProduct方法失败 \" + err);\n          }\n\n          \n      });\n  }\n    \n\n\n    \n    render () {\n        return (\n\n\n            <div>\n\n<Timeline>\n    <Timeline.Item color=\"green\">id = {this.props.id}, class = {this.props.class}</Timeline.Item>\n    <Timeline.Item color=\"green\">Create a services site 2015-09-01</Timeline.Item>\n    <Timeline.Item color=\"green\">Create a services site 2015-09-01</Timeline.Item>\n    <Timeline.Item color=\"red\">\n      <p>Solve initial network problems 1</p>\n      <p>Solve initial network problems 2</p>\n      <p>Solve initial network problems 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item>\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"gray\">\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"gray\">\n      <p>Technical testing 1</p>\n      <p>Technical testing 2</p>\n      <p>Technical testing 3 2015-09-01</p>\n    </Timeline.Item>\n    <Timeline.Item color=\"#00CCFF\" dot={<SmileOutlined />}>\n      <p>Custom color testing</p>\n    </Timeline.Item>\n  </Timeline>\n\n            </div>\n        );\n    }\n}\n\nexport default Tracing;\n"]},"metadata":{},"sourceType":"module"}