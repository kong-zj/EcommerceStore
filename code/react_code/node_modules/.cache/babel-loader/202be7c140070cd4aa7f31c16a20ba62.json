{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { useCallback, useMemo } from 'react';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { useIntl } from '@ant-design/pro-provider';\nimport { defaultActionRender, recordKeyToString } from '../useEditableArray';\n/**\n * 使用map 来删除数据，性能一般 但是准确率比较高\n *\n * @param params\n * @param action\n */\n\nfunction editableRowByKey(_ref) {\n  var data = _ref.data,\n      row = _ref.row;\n  return _objectSpread(_objectSpread({}, data), row);\n}\n/**\n * 一个方便的hooks 用于维护编辑的状态\n *\n * @param props\n */\n\n\nfunction useEditableMap(props) {\n  var editableType = props.type || 'single';\n\n  var _useMergedState = useMergedState([], {\n    value: props.editableKeys,\n    onChange: props.onChange ? function (keys) {\n      var _props$onChange;\n\n      props === null || props === void 0 ? void 0 : (_props$onChange = props.onChange) === null || _props$onChange === void 0 ? void 0 : _props$onChange.call(props, // 计算编辑的key\n      keys, props.dataSource);\n    } : undefined\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      editableKeys = _useMergedState2[0],\n      setEditableRowKeys = _useMergedState2[1];\n  /** 一个用来标志的set 提供了方便的 api 来去重什么的 */\n\n\n  var editableKeysSet = useMemo(function () {\n    var keys = editableType === 'single' ? editableKeys === null || editableKeys === void 0 ? void 0 : editableKeys.slice(0, 1) : editableKeys;\n    return new Set(keys);\n  }, [(editableKeys || []).join(','), editableType]);\n  /** 这行是不是编辑状态 */\n\n  var isEditable = useCallback(function (recordKey) {\n    if (editableKeys === null || editableKeys === void 0 ? void 0 : editableKeys.includes(recordKeyToString(recordKey))) return true;\n    return false;\n  }, [(editableKeys || []).join(',')]);\n  /**\n   * 进入编辑状态\n   *\n   * @param recordKey\n   */\n\n  var startEditable = function startEditable(recordKey) {\n    // 如果是单行的话，不允许多行编辑\n    if (editableKeysSet.size > 0 && editableType === 'single') {\n      _message.warn(props.onlyOneLineEditorAlertMessage || '只能同时编辑一行');\n\n      return false;\n    }\n\n    editableKeysSet.add(recordKeyToString(recordKey));\n    setEditableRowKeys(Array.from(editableKeysSet));\n    return true;\n  };\n  /**\n   * 退出编辑状态\n   *\n   * @param recordKey\n   */\n\n\n  var cancelEditable = function cancelEditable(recordKey) {\n    // 防止多次渲染\n    editableKeysSet.delete(recordKeyToString(recordKey));\n    setEditableRowKeys(Array.from(editableKeysSet));\n    return true;\n  };\n\n  var onCancel = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(recordKey, editRow, originRow, newLine) {\n      var _props$onCancel;\n\n      var success;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return props === null || props === void 0 ? void 0 : (_props$onCancel = props.onCancel) === null || _props$onCancel === void 0 ? void 0 : _props$onCancel.call(props, recordKey, editRow, originRow, newLine);\n\n            case 2:\n              success = _context.sent;\n\n              if (!(success === false)) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", false);\n\n            case 5:\n              return _context.abrupt(\"return\", true);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onCancel(_x, _x2, _x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onSave = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(recordKey, editRow, originRow) {\n      var _props$onSave;\n\n      var success, actionProps;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return props === null || props === void 0 ? void 0 : (_props$onSave = props.onSave) === null || _props$onSave === void 0 ? void 0 : _props$onSave.call(props, recordKey, editRow, originRow);\n\n            case 2:\n              success = _context2.sent;\n\n              if (!(success === false)) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", false);\n\n            case 5:\n              cancelEditable(recordKey);\n              actionProps = {\n                data: props.dataSource,\n                row: editRow,\n                key: recordKey,\n                childrenColumnName: props.childrenColumnName || 'children'\n              };\n              props.setDataSource(editableRowByKey(actionProps));\n              return _context2.abrupt(\"return\", true);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onSave(_x5, _x6, _x7) {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // Internationalization\n\n\n  var intl = useIntl();\n  var saveText = intl.getMessage('editableTable.action.save', '保存');\n  var deleteText = intl.getMessage('editableTable.action.delete', '删除');\n  var cancelText = intl.getMessage('editableTable.action.cancel', '取消');\n  var actionRender = useCallback(function (key, form, config) {\n    var renderConfig = _objectSpread({\n      recordKey: key,\n      cancelEditable: cancelEditable,\n      onCancel: onCancel,\n      onSave: onSave,\n      editableKeys: editableKeys,\n      setEditableRowKeys: setEditableRowKeys,\n      form: form,\n      saveText: saveText,\n      cancelText: cancelText,\n      deleteText: deleteText,\n      deletePopconfirmMessage: '删除此行？',\n      editorType: 'Map'\n    }, config);\n\n    var defaultDoms = defaultActionRender(props.dataSource, renderConfig);\n\n    if (props.actionRender) {\n      return props.actionRender(props.dataSource, renderConfig, {\n        save: defaultDoms[0],\n        delete: defaultDoms[1],\n        cancel: defaultDoms[2]\n      });\n    }\n\n    return defaultDoms;\n  }, [editableKeys && editableKeys.join(','), props.dataSource]);\n  return {\n    editableKeys: editableKeys,\n    setEditableRowKeys: setEditableRowKeys,\n    isEditable: isEditable,\n    actionRender: actionRender,\n    startEditable: startEditable,\n    cancelEditable: cancelEditable\n  };\n}\n\nexport default useEditableMap;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/node_modules/@ant-design/pro-card/node_modules/@ant-design/pro-utils/es/useEditableMap/index.js"],"names":["_regeneratorRuntime","_asyncToGenerator","_message","_slicedToArray","_objectSpread","useCallback","useMemo","useMergedState","useIntl","defaultActionRender","recordKeyToString","editableRowByKey","_ref","data","row","useEditableMap","props","editableType","type","_useMergedState","value","editableKeys","onChange","keys","_props$onChange","call","dataSource","undefined","_useMergedState2","setEditableRowKeys","editableKeysSet","slice","Set","join","isEditable","recordKey","includes","startEditable","size","warn","onlyOneLineEditorAlertMessage","add","Array","from","cancelEditable","delete","onCancel","_ref2","mark","_callee","editRow","originRow","newLine","_props$onCancel","success","wrap","_callee$","_context","prev","next","sent","abrupt","stop","_x","_x2","_x3","_x4","apply","arguments","onSave","_ref3","_callee2","_props$onSave","actionProps","_callee2$","_context2","key","childrenColumnName","setDataSource","_x5","_x6","_x7","intl","saveText","getMessage","deleteText","cancelText","actionRender","form","config","renderConfig","deletePopconfirmMessage","editorType","defaultDoms","save","cancel"],"mappings":"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","sourcesContent":["import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { useCallback, useMemo } from 'react';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport { useIntl } from '@ant-design/pro-provider';\nimport { defaultActionRender, recordKeyToString } from '../useEditableArray';\n/**\n * 使用map 来删除数据，性能一般 但是准确率比较高\n *\n * @param params\n * @param action\n */\n\nfunction editableRowByKey(_ref) {\n  var data = _ref.data,\n      row = _ref.row;\n  return _objectSpread(_objectSpread({}, data), row);\n}\n/**\n * 一个方便的hooks 用于维护编辑的状态\n *\n * @param props\n */\n\n\nfunction useEditableMap(props) {\n  var editableType = props.type || 'single';\n\n  var _useMergedState = useMergedState([], {\n    value: props.editableKeys,\n    onChange: props.onChange ? function (keys) {\n      var _props$onChange;\n\n      props === null || props === void 0 ? void 0 : (_props$onChange = props.onChange) === null || _props$onChange === void 0 ? void 0 : _props$onChange.call(props, // 计算编辑的key\n      keys, props.dataSource);\n    } : undefined\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      editableKeys = _useMergedState2[0],\n      setEditableRowKeys = _useMergedState2[1];\n  /** 一个用来标志的set 提供了方便的 api 来去重什么的 */\n\n\n  var editableKeysSet = useMemo(function () {\n    var keys = editableType === 'single' ? editableKeys === null || editableKeys === void 0 ? void 0 : editableKeys.slice(0, 1) : editableKeys;\n    return new Set(keys);\n  }, [(editableKeys || []).join(','), editableType]);\n  /** 这行是不是编辑状态 */\n\n  var isEditable = useCallback(function (recordKey) {\n    if (editableKeys === null || editableKeys === void 0 ? void 0 : editableKeys.includes(recordKeyToString(recordKey))) return true;\n    return false;\n  }, [(editableKeys || []).join(',')]);\n  /**\n   * 进入编辑状态\n   *\n   * @param recordKey\n   */\n\n  var startEditable = function startEditable(recordKey) {\n    // 如果是单行的话，不允许多行编辑\n    if (editableKeysSet.size > 0 && editableType === 'single') {\n      _message.warn(props.onlyOneLineEditorAlertMessage || '只能同时编辑一行');\n\n      return false;\n    }\n\n    editableKeysSet.add(recordKeyToString(recordKey));\n    setEditableRowKeys(Array.from(editableKeysSet));\n    return true;\n  };\n  /**\n   * 退出编辑状态\n   *\n   * @param recordKey\n   */\n\n\n  var cancelEditable = function cancelEditable(recordKey) {\n    // 防止多次渲染\n    editableKeysSet.delete(recordKeyToString(recordKey));\n    setEditableRowKeys(Array.from(editableKeysSet));\n    return true;\n  };\n\n  var onCancel = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(recordKey, editRow, originRow, newLine) {\n      var _props$onCancel;\n\n      var success;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return props === null || props === void 0 ? void 0 : (_props$onCancel = props.onCancel) === null || _props$onCancel === void 0 ? void 0 : _props$onCancel.call(props, recordKey, editRow, originRow, newLine);\n\n            case 2:\n              success = _context.sent;\n\n              if (!(success === false)) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", false);\n\n            case 5:\n              return _context.abrupt(\"return\", true);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onCancel(_x, _x2, _x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onSave = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(recordKey, editRow, originRow) {\n      var _props$onSave;\n\n      var success, actionProps;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return props === null || props === void 0 ? void 0 : (_props$onSave = props.onSave) === null || _props$onSave === void 0 ? void 0 : _props$onSave.call(props, recordKey, editRow, originRow);\n\n            case 2:\n              success = _context2.sent;\n\n              if (!(success === false)) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", false);\n\n            case 5:\n              cancelEditable(recordKey);\n              actionProps = {\n                data: props.dataSource,\n                row: editRow,\n                key: recordKey,\n                childrenColumnName: props.childrenColumnName || 'children'\n              };\n              props.setDataSource(editableRowByKey(actionProps));\n              return _context2.abrupt(\"return\", true);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onSave(_x5, _x6, _x7) {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // Internationalization\n\n\n  var intl = useIntl();\n  var saveText = intl.getMessage('editableTable.action.save', '保存');\n  var deleteText = intl.getMessage('editableTable.action.delete', '删除');\n  var cancelText = intl.getMessage('editableTable.action.cancel', '取消');\n  var actionRender = useCallback(function (key, form, config) {\n    var renderConfig = _objectSpread({\n      recordKey: key,\n      cancelEditable: cancelEditable,\n      onCancel: onCancel,\n      onSave: onSave,\n      editableKeys: editableKeys,\n      setEditableRowKeys: setEditableRowKeys,\n      form: form,\n      saveText: saveText,\n      cancelText: cancelText,\n      deleteText: deleteText,\n      deletePopconfirmMessage: '删除此行？',\n      editorType: 'Map'\n    }, config);\n\n    var defaultDoms = defaultActionRender(props.dataSource, renderConfig);\n\n    if (props.actionRender) {\n      return props.actionRender(props.dataSource, renderConfig, {\n        save: defaultDoms[0],\n        delete: defaultDoms[1],\n        cancel: defaultDoms[2]\n      });\n    }\n\n    return defaultDoms;\n  }, [editableKeys && editableKeys.join(','), props.dataSource]);\n  return {\n    editableKeys: editableKeys,\n    setEditableRowKeys: setEditableRowKeys,\n    isEditable: isEditable,\n    actionRender: actionRender,\n    startEditable: startEditable,\n    cancelEditable: cancelEditable\n  };\n}\n\nexport default useEditableMap;"]},"metadata":{},"sourceType":"module"}