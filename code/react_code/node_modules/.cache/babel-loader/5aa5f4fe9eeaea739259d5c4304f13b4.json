{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport Geo from './Geo';\nimport * as layout from '../../util/layout';\nimport * as numberUtil from '../../util/number';\nimport geoSourceManager from './geoSourceManager';\nimport mapDataStorage from './mapDataStorage';\n/**\n * Resize method bound to the geo\n */\n\nfunction resizeGeo(geoModel, api) {\n  var boundingCoords = geoModel.get('boundingCoords');\n\n  if (boundingCoords != null) {\n    var leftTop = boundingCoords[0];\n    var rightBottom = boundingCoords[1];\n\n    if (isNaN(leftTop[0]) || isNaN(leftTop[1]) || isNaN(rightBottom[0]) || isNaN(rightBottom[1])) {\n      if (process.env.NODE_ENV !== 'production') {\n        console.error('Invalid boundingCoords');\n      }\n    } else {\n      this.setBoundingRect(leftTop[0], leftTop[1], rightBottom[0] - leftTop[0], rightBottom[1] - leftTop[1]);\n    }\n  }\n\n  var rect = this.getBoundingRect();\n  var centerOption = geoModel.get('layoutCenter');\n  var sizeOption = geoModel.get('layoutSize');\n  var viewWidth = api.getWidth();\n  var viewHeight = api.getHeight();\n  var aspect = rect.width / rect.height * this.aspectScale;\n  var useCenterAndSize = false;\n  var center;\n  var size;\n\n  if (centerOption && sizeOption) {\n    center = [numberUtil.parsePercent(centerOption[0], viewWidth), numberUtil.parsePercent(centerOption[1], viewHeight)];\n    size = numberUtil.parsePercent(sizeOption, Math.min(viewWidth, viewHeight));\n\n    if (!isNaN(center[0]) && !isNaN(center[1]) && !isNaN(size)) {\n      useCenterAndSize = true;\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        console.warn('Given layoutCenter or layoutSize data are invalid. Use left/top/width/height instead.');\n      }\n    }\n  }\n\n  var viewRect;\n\n  if (useCenterAndSize) {\n    viewRect = {};\n\n    if (aspect > 1) {\n      // Width is same with size\n      viewRect.width = size;\n      viewRect.height = size / aspect;\n    } else {\n      viewRect.height = size;\n      viewRect.width = size * aspect;\n    }\n\n    viewRect.y = center[1] - viewRect.height / 2;\n    viewRect.x = center[0] - viewRect.width / 2;\n  } else {\n    // Use left/top/width/height\n    var boxLayoutOption = geoModel.getBoxLayoutParams(); // 0.75 rate\n\n    boxLayoutOption.aspect = aspect;\n    viewRect = layout.getLayoutRect(boxLayoutOption, {\n      width: viewWidth,\n      height: viewHeight\n    });\n  }\n\n  this.setViewRect(viewRect.x, viewRect.y, viewRect.width, viewRect.height);\n  this.setCenter(geoModel.get('center'));\n  this.setZoom(geoModel.get('zoom'));\n} // Back compat for ECharts2, where the coord map is set on map series:\n// {type: 'map', geoCoord: {'cityA': [116.46,39.92], 'cityA': [119.12,24.61]}},\n\n\nfunction setGeoCoords(geo, model) {\n  zrUtil.each(model.get('geoCoord'), function (geoCoord, name) {\n    geo.addGeoCoord(name, geoCoord);\n  });\n}\n\nvar GeoCreator =\n/** @class */\nfunction () {\n  function GeoCreator() {\n    // For deciding which dimensions to use when creating list data\n    this.dimensions = Geo.prototype.dimensions;\n  }\n\n  GeoCreator.prototype.create = function (ecModel, api) {\n    var geoList = []; // FIXME Create each time may be slow\n\n    ecModel.eachComponent('geo', function (geoModel, idx) {\n      var name = geoModel.get('map');\n      var aspectScale = geoModel.get('aspectScale');\n      var invertLongitute = true;\n      var mapRecords = mapDataStorage.retrieveMap(name);\n\n      if (mapRecords && mapRecords[0] && mapRecords[0].type === 'svg') {\n        aspectScale == null && (aspectScale = 1);\n        invertLongitute = false;\n      } else {\n        aspectScale == null && (aspectScale = 0.75);\n      }\n\n      var geo = new Geo(name + idx, name, geoModel.get('nameMap'), invertLongitute);\n      geo.aspectScale = aspectScale;\n      geo.zoomLimit = geoModel.get('scaleLimit');\n      geoList.push(geo); // setGeoCoords(geo, geoModel);\n\n      geoModel.coordinateSystem = geo;\n      geo.model = geoModel; // Inject resize method\n\n      geo.resize = resizeGeo;\n      geo.resize(geoModel, api);\n    });\n    ecModel.eachSeries(function (seriesModel) {\n      var coordSys = seriesModel.get('coordinateSystem');\n\n      if (coordSys === 'geo') {\n        var geoIndex = seriesModel.get('geoIndex') || 0;\n        seriesModel.coordinateSystem = geoList[geoIndex];\n      }\n    }); // If has map series\n\n    var mapModelGroupBySeries = {};\n    ecModel.eachSeriesByType('map', function (seriesModel) {\n      if (!seriesModel.getHostGeoModel()) {\n        var mapType = seriesModel.getMapType();\n        mapModelGroupBySeries[mapType] = mapModelGroupBySeries[mapType] || [];\n        mapModelGroupBySeries[mapType].push(seriesModel);\n      }\n    });\n    zrUtil.each(mapModelGroupBySeries, function (mapSeries, mapType) {\n      var nameMapList = zrUtil.map(mapSeries, function (singleMapSeries) {\n        return singleMapSeries.get('nameMap');\n      });\n      var geo = new Geo(mapType, mapType, zrUtil.mergeAll(nameMapList));\n      geo.zoomLimit = zrUtil.retrieve.apply(null, zrUtil.map(mapSeries, function (singleMapSeries) {\n        return singleMapSeries.get('scaleLimit');\n      }));\n      geoList.push(geo); // Inject resize method\n\n      geo.resize = resizeGeo;\n      geo.aspectScale = mapSeries[0].get('aspectScale');\n      geo.resize(mapSeries[0], api);\n      zrUtil.each(mapSeries, function (singleMapSeries) {\n        singleMapSeries.coordinateSystem = geo;\n        setGeoCoords(geo, singleMapSeries);\n      });\n    });\n    return geoList;\n  };\n  /**\n   * Fill given regions array\n   */\n\n\n  GeoCreator.prototype.getFilledRegions = function (originRegionArr, mapName, nameMap) {\n    // Not use the original\n    var regionsArr = (originRegionArr || []).slice();\n    var dataNameMap = zrUtil.createHashMap();\n\n    for (var i = 0; i < regionsArr.length; i++) {\n      dataNameMap.set(regionsArr[i].name, regionsArr[i]);\n    }\n\n    var source = geoSourceManager.load(mapName, nameMap);\n    zrUtil.each(source.regions, function (region) {\n      var name = region.name;\n      !dataNameMap.get(name) && regionsArr.push({\n        name: name\n      });\n    });\n    return regionsArr;\n  };\n\n  return GeoCreator;\n}();\n\nvar geoCreator = new GeoCreator();\nexport default geoCreator;","map":{"version":3,"sources":["/home/kzj/project/finalize/B-S-/源码/前端/node_modules/echarts/lib/coord/geo/geoCreator.js"],"names":["zrUtil","Geo","layout","numberUtil","geoSourceManager","mapDataStorage","resizeGeo","geoModel","api","boundingCoords","get","leftTop","rightBottom","isNaN","process","env","NODE_ENV","console","error","setBoundingRect","rect","getBoundingRect","centerOption","sizeOption","viewWidth","getWidth","viewHeight","getHeight","aspect","width","height","aspectScale","useCenterAndSize","center","size","parsePercent","Math","min","warn","viewRect","y","x","boxLayoutOption","getBoxLayoutParams","getLayoutRect","setViewRect","setCenter","setZoom","setGeoCoords","geo","model","each","geoCoord","name","addGeoCoord","GeoCreator","dimensions","prototype","create","ecModel","geoList","eachComponent","idx","invertLongitute","mapRecords","retrieveMap","type","zoomLimit","push","coordinateSystem","resize","eachSeries","seriesModel","coordSys","geoIndex","mapModelGroupBySeries","eachSeriesByType","getHostGeoModel","mapType","getMapType","mapSeries","nameMapList","map","singleMapSeries","mergeAll","retrieve","apply","getFilledRegions","originRegionArr","mapName","nameMap","regionsArr","slice","dataNameMap","createHashMap","i","length","set","source","load","regions","region","geoCreator"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport * as zrUtil from 'zrender/lib/core/util';\nimport Geo from './Geo';\nimport * as layout from '../../util/layout';\nimport * as numberUtil from '../../util/number';\nimport geoSourceManager from './geoSourceManager';\nimport mapDataStorage from './mapDataStorage';\n/**\n * Resize method bound to the geo\n */\n\nfunction resizeGeo(geoModel, api) {\n  var boundingCoords = geoModel.get('boundingCoords');\n\n  if (boundingCoords != null) {\n    var leftTop = boundingCoords[0];\n    var rightBottom = boundingCoords[1];\n\n    if (isNaN(leftTop[0]) || isNaN(leftTop[1]) || isNaN(rightBottom[0]) || isNaN(rightBottom[1])) {\n      if (process.env.NODE_ENV !== 'production') {\n        console.error('Invalid boundingCoords');\n      }\n    } else {\n      this.setBoundingRect(leftTop[0], leftTop[1], rightBottom[0] - leftTop[0], rightBottom[1] - leftTop[1]);\n    }\n  }\n\n  var rect = this.getBoundingRect();\n  var centerOption = geoModel.get('layoutCenter');\n  var sizeOption = geoModel.get('layoutSize');\n  var viewWidth = api.getWidth();\n  var viewHeight = api.getHeight();\n  var aspect = rect.width / rect.height * this.aspectScale;\n  var useCenterAndSize = false;\n  var center;\n  var size;\n\n  if (centerOption && sizeOption) {\n    center = [numberUtil.parsePercent(centerOption[0], viewWidth), numberUtil.parsePercent(centerOption[1], viewHeight)];\n    size = numberUtil.parsePercent(sizeOption, Math.min(viewWidth, viewHeight));\n\n    if (!isNaN(center[0]) && !isNaN(center[1]) && !isNaN(size)) {\n      useCenterAndSize = true;\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        console.warn('Given layoutCenter or layoutSize data are invalid. Use left/top/width/height instead.');\n      }\n    }\n  }\n\n  var viewRect;\n\n  if (useCenterAndSize) {\n    viewRect = {};\n\n    if (aspect > 1) {\n      // Width is same with size\n      viewRect.width = size;\n      viewRect.height = size / aspect;\n    } else {\n      viewRect.height = size;\n      viewRect.width = size * aspect;\n    }\n\n    viewRect.y = center[1] - viewRect.height / 2;\n    viewRect.x = center[0] - viewRect.width / 2;\n  } else {\n    // Use left/top/width/height\n    var boxLayoutOption = geoModel.getBoxLayoutParams(); // 0.75 rate\n\n    boxLayoutOption.aspect = aspect;\n    viewRect = layout.getLayoutRect(boxLayoutOption, {\n      width: viewWidth,\n      height: viewHeight\n    });\n  }\n\n  this.setViewRect(viewRect.x, viewRect.y, viewRect.width, viewRect.height);\n  this.setCenter(geoModel.get('center'));\n  this.setZoom(geoModel.get('zoom'));\n} // Back compat for ECharts2, where the coord map is set on map series:\n// {type: 'map', geoCoord: {'cityA': [116.46,39.92], 'cityA': [119.12,24.61]}},\n\n\nfunction setGeoCoords(geo, model) {\n  zrUtil.each(model.get('geoCoord'), function (geoCoord, name) {\n    geo.addGeoCoord(name, geoCoord);\n  });\n}\n\nvar GeoCreator =\n/** @class */\nfunction () {\n  function GeoCreator() {\n    // For deciding which dimensions to use when creating list data\n    this.dimensions = Geo.prototype.dimensions;\n  }\n\n  GeoCreator.prototype.create = function (ecModel, api) {\n    var geoList = []; // FIXME Create each time may be slow\n\n    ecModel.eachComponent('geo', function (geoModel, idx) {\n      var name = geoModel.get('map');\n      var aspectScale = geoModel.get('aspectScale');\n      var invertLongitute = true;\n      var mapRecords = mapDataStorage.retrieveMap(name);\n\n      if (mapRecords && mapRecords[0] && mapRecords[0].type === 'svg') {\n        aspectScale == null && (aspectScale = 1);\n        invertLongitute = false;\n      } else {\n        aspectScale == null && (aspectScale = 0.75);\n      }\n\n      var geo = new Geo(name + idx, name, geoModel.get('nameMap'), invertLongitute);\n      geo.aspectScale = aspectScale;\n      geo.zoomLimit = geoModel.get('scaleLimit');\n      geoList.push(geo); // setGeoCoords(geo, geoModel);\n\n      geoModel.coordinateSystem = geo;\n      geo.model = geoModel; // Inject resize method\n\n      geo.resize = resizeGeo;\n      geo.resize(geoModel, api);\n    });\n    ecModel.eachSeries(function (seriesModel) {\n      var coordSys = seriesModel.get('coordinateSystem');\n\n      if (coordSys === 'geo') {\n        var geoIndex = seriesModel.get('geoIndex') || 0;\n        seriesModel.coordinateSystem = geoList[geoIndex];\n      }\n    }); // If has map series\n\n    var mapModelGroupBySeries = {};\n    ecModel.eachSeriesByType('map', function (seriesModel) {\n      if (!seriesModel.getHostGeoModel()) {\n        var mapType = seriesModel.getMapType();\n        mapModelGroupBySeries[mapType] = mapModelGroupBySeries[mapType] || [];\n        mapModelGroupBySeries[mapType].push(seriesModel);\n      }\n    });\n    zrUtil.each(mapModelGroupBySeries, function (mapSeries, mapType) {\n      var nameMapList = zrUtil.map(mapSeries, function (singleMapSeries) {\n        return singleMapSeries.get('nameMap');\n      });\n      var geo = new Geo(mapType, mapType, zrUtil.mergeAll(nameMapList));\n      geo.zoomLimit = zrUtil.retrieve.apply(null, zrUtil.map(mapSeries, function (singleMapSeries) {\n        return singleMapSeries.get('scaleLimit');\n      }));\n      geoList.push(geo); // Inject resize method\n\n      geo.resize = resizeGeo;\n      geo.aspectScale = mapSeries[0].get('aspectScale');\n      geo.resize(mapSeries[0], api);\n      zrUtil.each(mapSeries, function (singleMapSeries) {\n        singleMapSeries.coordinateSystem = geo;\n        setGeoCoords(geo, singleMapSeries);\n      });\n    });\n    return geoList;\n  };\n  /**\n   * Fill given regions array\n   */\n\n\n  GeoCreator.prototype.getFilledRegions = function (originRegionArr, mapName, nameMap) {\n    // Not use the original\n    var regionsArr = (originRegionArr || []).slice();\n    var dataNameMap = zrUtil.createHashMap();\n\n    for (var i = 0; i < regionsArr.length; i++) {\n      dataNameMap.set(regionsArr[i].name, regionsArr[i]);\n    }\n\n    var source = geoSourceManager.load(mapName, nameMap);\n    zrUtil.each(source.regions, function (region) {\n      var name = region.name;\n      !dataNameMap.get(name) && regionsArr.push({\n        name: name\n      });\n    });\n    return regionsArr;\n  };\n\n  return GeoCreator;\n}();\n\nvar geoCreator = new GeoCreator();\nexport default geoCreator;"]},"metadata":{},"sourceType":"module"}