{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { __extends } from \"tslib\";\nimport { bind, each, indexOf, curry, extend, retrieve, normalizeCssArray, isFunction } from 'zrender/lib/core/util';\nimport * as graphic from '../../util/graphic';\nimport { getECData } from '../../util/innerStore';\nimport { isHighDownDispatcher, setAsHighDownDispatcher, setDefaultStateProxy, enableHoverFocus } from '../../util/states';\nimport DataDiffer from '../../data/DataDiffer';\nimport * as helper from '../helper/treeHelper';\nimport Breadcrumb from './Breadcrumb';\nimport RoamController from '../../component/helper/RoamController';\nimport BoundingRect from 'zrender/lib/core/BoundingRect';\nimport * as matrix from 'zrender/lib/core/matrix';\nimport * as animationUtil from '../../util/animation';\nimport makeStyleMapper from '../../model/mixin/makeStyleMapper';\nimport ChartView from '../../view/Chart';\nimport Displayable from 'zrender/lib/graphic/Displayable';\nimport { makeInner, convertOptionIdName } from '../../util/model';\nimport { windowOpen } from '../../util/format';\nimport { setLabelStyle, getLabelStatesModels } from '../../label/labelStyle';\nvar Group = graphic.Group;\nvar Rect = graphic.Rect;\nvar DRAG_THRESHOLD = 3;\nvar PATH_LABEL_NOAMAL = 'label';\nvar PATH_UPPERLABEL_NORMAL = 'upperLabel';\nvar Z_BASE = 10; // Should bigger than every z.\n\nvar Z_BG = 1;\nvar Z_CONTENT = 2;\nvar getStateItemStyle = makeStyleMapper([['fill', 'color'], // `borderColor` and `borderWidth` has been occupied,\n// so use `stroke` to indicate the stroke of the rect.\n['stroke', 'strokeColor'], ['lineWidth', 'strokeWidth'], ['shadowBlur'], ['shadowOffsetX'], ['shadowOffsetY'], ['shadowColor'] // Option decal is in `DecalObject` but style.decal is in `PatternObject`.\n// So do not transfer decal directly.\n]);\n\nvar getItemStyleNormal = function (model) {\n  // Normal style props should include emphasis style props.\n  var itemStyle = getStateItemStyle(model); // Clear styles set by emphasis.\n\n  itemStyle.stroke = itemStyle.fill = itemStyle.lineWidth = null;\n  return itemStyle;\n};\n\nvar inner = makeInner();\n\nvar TreemapView =\n/** @class */\nfunction (_super) {\n  __extends(TreemapView, _super);\n\n  function TreemapView() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = TreemapView.type;\n    _this._state = 'ready';\n    _this._storage = createStorage();\n    return _this;\n  }\n  /**\n   * @override\n   */\n\n\n  TreemapView.prototype.render = function (seriesModel, ecModel, api, payload) {\n    var models = ecModel.findComponents({\n      mainType: 'series',\n      subType: 'treemap',\n      query: payload\n    });\n\n    if (indexOf(models, seriesModel) < 0) {\n      return;\n    }\n\n    this.seriesModel = seriesModel;\n    this.api = api;\n    this.ecModel = ecModel;\n    var types = ['treemapZoomToNode', 'treemapRootToNode'];\n    var targetInfo = helper.retrieveTargetInfo(payload, types, seriesModel);\n    var payloadType = payload && payload.type;\n    var layoutInfo = seriesModel.layoutInfo;\n    var isInit = !this._oldTree;\n    var thisStorage = this._storage; // Mark new root when action is treemapRootToNode.\n\n    var reRoot = payloadType === 'treemapRootToNode' && targetInfo && thisStorage ? {\n      rootNodeGroup: thisStorage.nodeGroup[targetInfo.node.getRawIndex()],\n      direction: payload.direction\n    } : null;\n\n    var containerGroup = this._giveContainerGroup(layoutInfo);\n\n    var renderResult = this._doRender(containerGroup, seriesModel, reRoot);\n\n    !isInit && (!payloadType || payloadType === 'treemapZoomToNode' || payloadType === 'treemapRootToNode') ? this._doAnimation(containerGroup, renderResult, seriesModel, reRoot) : renderResult.renderFinally();\n\n    this._resetController(api);\n\n    this._renderBreadcrumb(seriesModel, api, targetInfo);\n  };\n\n  TreemapView.prototype._giveContainerGroup = function (layoutInfo) {\n    var containerGroup = this._containerGroup;\n\n    if (!containerGroup) {\n      // FIXME\n      // 加一层containerGroup是为了clip，但是现在clip功能并没有实现。\n      containerGroup = this._containerGroup = new Group();\n\n      this._initEvents(containerGroup);\n\n      this.group.add(containerGroup);\n    }\n\n    containerGroup.x = layoutInfo.x;\n    containerGroup.y = layoutInfo.y;\n    return containerGroup;\n  };\n\n  TreemapView.prototype._doRender = function (containerGroup, seriesModel, reRoot) {\n    var thisTree = seriesModel.getData().tree;\n    var oldTree = this._oldTree; // Clear last shape records.\n\n    var lastsForAnimation = createStorage();\n    var thisStorage = createStorage();\n    var oldStorage = this._storage;\n    var willInvisibleEls = [];\n\n    function doRenderNode(thisNode, oldNode, parentGroup, depth) {\n      return renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth);\n    } // Notice: when thisTree and oldTree are the same tree (see list.cloneShallow),\n    // the oldTree is actually losted, so we can not find all of the old graphic\n    // elements from tree. So we use this stragegy: make element storage, move\n    // from old storage to new storage, clear old storage.\n\n\n    dualTravel(thisTree.root ? [thisTree.root] : [], oldTree && oldTree.root ? [oldTree.root] : [], containerGroup, thisTree === oldTree || !oldTree, 0); // Process all removing.\n\n    var willDeleteEls = clearStorage(oldStorage);\n    this._oldTree = thisTree;\n    this._storage = thisStorage;\n    return {\n      lastsForAnimation: lastsForAnimation,\n      willDeleteEls: willDeleteEls,\n      renderFinally: renderFinally\n    };\n\n    function dualTravel(thisViewChildren, oldViewChildren, parentGroup, sameTree, depth) {\n      // When 'render' is triggered by action,\n      // 'this' and 'old' may be the same tree,\n      // we use rawIndex in that case.\n      if (sameTree) {\n        oldViewChildren = thisViewChildren;\n        each(thisViewChildren, function (child, index) {\n          !child.isRemoved() && processNode(index, index);\n        });\n      } // Diff hierarchically (diff only in each subtree, but not whole).\n      // because, consistency of view is important.\n      else {\n          new DataDiffer(oldViewChildren, thisViewChildren, getKey, getKey).add(processNode).update(processNode).remove(curry(processNode, null)).execute();\n        }\n\n      function getKey(node) {\n        // Identify by name or raw index.\n        return node.getId();\n      }\n\n      function processNode(newIndex, oldIndex) {\n        var thisNode = newIndex != null ? thisViewChildren[newIndex] : null;\n        var oldNode = oldIndex != null ? oldViewChildren[oldIndex] : null;\n        var group = doRenderNode(thisNode, oldNode, parentGroup, depth);\n        group && dualTravel(thisNode && thisNode.viewChildren || [], oldNode && oldNode.viewChildren || [], group, sameTree, depth + 1);\n      }\n    }\n\n    function clearStorage(storage) {\n      var willDeleteEls = createStorage();\n      storage && each(storage, function (store, storageName) {\n        var delEls = willDeleteEls[storageName];\n        each(store, function (el) {\n          el && (delEls.push(el), inner(el).willDelete = true);\n        });\n      });\n      return willDeleteEls;\n    }\n\n    function renderFinally() {\n      each(willDeleteEls, function (els) {\n        each(els, function (el) {\n          el.parent && el.parent.remove(el);\n        });\n      });\n      each(willInvisibleEls, function (el) {\n        el.invisible = true; // Setting invisible is for optimizing, so no need to set dirty,\n        // just mark as invisible.\n\n        el.dirty();\n      });\n    }\n  };\n\n  TreemapView.prototype._doAnimation = function (containerGroup, renderResult, seriesModel, reRoot) {\n    if (!seriesModel.get('animation')) {\n      return;\n    }\n\n    var durationOption = seriesModel.get('animationDurationUpdate');\n    var easingOption = seriesModel.get('animationEasing'); // TODO: do not support function until necessary.\n\n    var duration = (isFunction(durationOption) ? 0 : durationOption) || 0;\n    var easing = (isFunction(easingOption) ? null : easingOption) || 'cubicOut';\n    var animationWrap = animationUtil.createWrap(); // Make delete animations.\n\n    each(renderResult.willDeleteEls, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        if (el.invisible) {\n          return;\n        }\n\n        var parent = el.parent; // Always has parent, and parent is nodeGroup.\n\n        var target;\n        var innerStore = inner(parent);\n\n        if (reRoot && reRoot.direction === 'drillDown') {\n          target = parent === reRoot.rootNodeGroup // This is the content element of view root.\n          // Only `content` will enter this branch, because\n          // `background` and `nodeGroup` will not be deleted.\n          ? {\n            shape: {\n              x: 0,\n              y: 0,\n              width: innerStore.nodeWidth,\n              height: innerStore.nodeHeight\n            },\n            style: {\n              opacity: 0\n            }\n          } // Others.\n          : {\n            style: {\n              opacity: 0\n            }\n          };\n        } else {\n          var targetX = 0;\n          var targetY = 0;\n\n          if (!innerStore.willDelete) {\n            // Let node animate to right-bottom corner, cooperating with fadeout,\n            // which is appropriate for user understanding.\n            // Divided by 2 for reRoot rolling up effect.\n            targetX = innerStore.nodeWidth / 2;\n            targetY = innerStore.nodeHeight / 2;\n          }\n\n          target = storageName === 'nodeGroup' ? {\n            x: targetX,\n            y: targetY,\n            style: {\n              opacity: 0\n            }\n          } : {\n            shape: {\n              x: targetX,\n              y: targetY,\n              width: 0,\n              height: 0\n            },\n            style: {\n              opacity: 0\n            }\n          };\n        } // TODO: do not support delay until necessary.\n\n\n        target && animationWrap.add(el, target, duration, 0, easing);\n      });\n    }); // Make other animations\n\n    each(this._storage, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        var last = renderResult.lastsForAnimation[storageName][rawIndex];\n        var target = {};\n\n        if (!last) {\n          return;\n        }\n\n        if (el instanceof graphic.Group) {\n          if (last.oldX != null) {\n            target.x = el.x;\n            target.y = el.y;\n            el.x = last.oldX;\n            el.y = last.oldY;\n          }\n        } else {\n          if (last.oldShape) {\n            target.shape = extend({}, el.shape);\n            el.setShape(last.oldShape);\n          }\n\n          if (last.fadein) {\n            el.setStyle('opacity', 0);\n            target.style = {\n              opacity: 1\n            };\n          } // When animation is stopped for succedent animation starting,\n          // el.style.opacity might not be 1\n          else if (el.style.opacity !== 1) {\n              target.style = {\n                opacity: 1\n              };\n            }\n        }\n\n        animationWrap.add(el, target, duration, 0, easing);\n      });\n    }, this);\n    this._state = 'animating';\n    animationWrap.finished(bind(function () {\n      this._state = 'ready';\n      renderResult.renderFinally();\n    }, this)).start();\n  };\n\n  TreemapView.prototype._resetController = function (api) {\n    var controller = this._controller; // Init controller.\n\n    if (!controller) {\n      controller = this._controller = new RoamController(api.getZr());\n      controller.enable(this.seriesModel.get('roam'));\n      controller.on('pan', bind(this._onPan, this));\n      controller.on('zoom', bind(this._onZoom, this));\n    }\n\n    var rect = new BoundingRect(0, 0, api.getWidth(), api.getHeight());\n    controller.setPointerChecker(function (e, x, y) {\n      return rect.contain(x, y);\n    });\n  };\n\n  TreemapView.prototype._clearController = function () {\n    var controller = this._controller;\n\n    if (controller) {\n      controller.dispose();\n      controller = null;\n    }\n  };\n\n  TreemapView.prototype._onPan = function (e) {\n    if (this._state !== 'animating' && (Math.abs(e.dx) > DRAG_THRESHOLD || Math.abs(e.dy) > DRAG_THRESHOLD)) {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      this.api.dispatchAction({\n        type: 'treemapMove',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rootLayout.x + e.dx,\n          y: rootLayout.y + e.dy,\n          width: rootLayout.width,\n          height: rootLayout.height\n        }\n      });\n    }\n  };\n\n  TreemapView.prototype._onZoom = function (e) {\n    var mouseX = e.originX;\n    var mouseY = e.originY;\n\n    if (this._state !== 'animating') {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      var rect = new BoundingRect(rootLayout.x, rootLayout.y, rootLayout.width, rootLayout.height);\n      var layoutInfo = this.seriesModel.layoutInfo; // Transform mouse coord from global to containerGroup.\n\n      mouseX -= layoutInfo.x;\n      mouseY -= layoutInfo.y; // Scale root bounding rect.\n\n      var m = matrix.create();\n      matrix.translate(m, m, [-mouseX, -mouseY]);\n      matrix.scale(m, m, [e.scale, e.scale]);\n      matrix.translate(m, m, [mouseX, mouseY]);\n      rect.applyTransform(m);\n      this.api.dispatchAction({\n        type: 'treemapRender',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rect.x,\n          y: rect.y,\n          width: rect.width,\n          height: rect.height\n        }\n      });\n    }\n  };\n\n  TreemapView.prototype._initEvents = function (containerGroup) {\n    var _this = this;\n\n    containerGroup.on('click', function (e) {\n      if (_this._state !== 'ready') {\n        return;\n      }\n\n      var nodeClick = _this.seriesModel.get('nodeClick', true);\n\n      if (!nodeClick) {\n        return;\n      }\n\n      var targetInfo = _this.findTarget(e.offsetX, e.offsetY);\n\n      if (!targetInfo) {\n        return;\n      }\n\n      var node = targetInfo.node;\n\n      if (node.getLayout().isLeafRoot) {\n        _this._rootToNode(targetInfo);\n      } else {\n        if (nodeClick === 'zoomToNode') {\n          _this._zoomToNode(targetInfo);\n        } else if (nodeClick === 'link') {\n          var itemModel = node.hostTree.data.getItemModel(node.dataIndex);\n          var link = itemModel.get('link', true);\n          var linkTarget = itemModel.get('target', true) || 'blank';\n          link && windowOpen(link, linkTarget);\n        }\n      }\n    }, this);\n  };\n\n  TreemapView.prototype._renderBreadcrumb = function (seriesModel, api, targetInfo) {\n    var _this = this;\n\n    if (!targetInfo) {\n      targetInfo = seriesModel.get('leafDepth', true) != null ? {\n        node: seriesModel.getViewRoot()\n      } // FIXME\n      // better way?\n      // Find breadcrumb tail on center of containerGroup.\n      : this.findTarget(api.getWidth() / 2, api.getHeight() / 2);\n\n      if (!targetInfo) {\n        targetInfo = {\n          node: seriesModel.getData().tree.root\n        };\n      }\n    }\n\n    (this._breadcrumb || (this._breadcrumb = new Breadcrumb(this.group))).render(seriesModel, api, targetInfo.node, function (node) {\n      if (_this._state !== 'animating') {\n        helper.aboveViewRoot(seriesModel.getViewRoot(), node) ? _this._rootToNode({\n          node: node\n        }) : _this._zoomToNode({\n          node: node\n        });\n      }\n    });\n  };\n  /**\n   * @override\n   */\n\n\n  TreemapView.prototype.remove = function () {\n    this._clearController();\n\n    this._containerGroup && this._containerGroup.removeAll();\n    this._storage = createStorage();\n    this._state = 'ready';\n    this._breadcrumb && this._breadcrumb.remove();\n  };\n\n  TreemapView.prototype.dispose = function () {\n    this._clearController();\n  };\n\n  TreemapView.prototype._zoomToNode = function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapZoomToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  };\n\n  TreemapView.prototype._rootToNode = function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapRootToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  };\n  /**\n   * @public\n   * @param {number} x Global coord x.\n   * @param {number} y Global coord y.\n   * @return {Object} info If not found, return undefined;\n   * @return {number} info.node Target node.\n   * @return {number} info.offsetX x refer to target node.\n   * @return {number} info.offsetY y refer to target node.\n   */\n\n\n  TreemapView.prototype.findTarget = function (x, y) {\n    var targetInfo;\n    var viewRoot = this.seriesModel.getViewRoot();\n    viewRoot.eachNode({\n      attr: 'viewChildren',\n      order: 'preorder'\n    }, function (node) {\n      var bgEl = this._storage.background[node.getRawIndex()]; // If invisible, there might be no element.\n\n\n      if (bgEl) {\n        var point = bgEl.transformCoordToLocal(x, y);\n        var shape = bgEl.shape; // For performance consideration, dont use 'getBoundingRect'.\n\n        if (shape.x <= point[0] && point[0] <= shape.x + shape.width && shape.y <= point[1] && point[1] <= shape.y + shape.height) {\n          targetInfo = {\n            node: node,\n            offsetX: point[0],\n            offsetY: point[1]\n          };\n        } else {\n          return false; // Suppress visit subtree.\n        }\n      }\n    }, this);\n    return targetInfo;\n  };\n\n  TreemapView.type = 'treemap';\n  return TreemapView;\n}(ChartView);\n/**\n * @inner\n */\n\n\nfunction createStorage() {\n  return {\n    nodeGroup: [],\n    background: [],\n    content: []\n  };\n}\n/**\n * @inner\n * @return Return undefined means do not travel further.\n */\n\n\nfunction renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth) {\n  // Whether under viewRoot.\n  if (!thisNode) {\n    // Deleting nodes will be performed finally. This method just find\n    // element from old storage, or create new element, set them to new\n    // storage, and set styles.\n    return;\n  } // -------------------------------------------------------------------\n  // Start of closure variables available in \"Procedures in renderNode\".\n\n\n  var thisLayout = thisNode.getLayout();\n  var data = seriesModel.getData();\n  var nodeModel = thisNode.getModel(); // Only for enabling highlight/downplay. Clear firstly.\n  // Because some node will not be rendered.\n\n  data.setItemGraphicEl(thisNode.dataIndex, null);\n\n  if (!thisLayout || !thisLayout.isInView) {\n    return;\n  }\n\n  var thisWidth = thisLayout.width;\n  var thisHeight = thisLayout.height;\n  var borderWidth = thisLayout.borderWidth;\n  var thisInvisible = thisLayout.invisible;\n  var thisRawIndex = thisNode.getRawIndex();\n  var oldRawIndex = oldNode && oldNode.getRawIndex();\n  var thisViewChildren = thisNode.viewChildren;\n  var upperHeight = thisLayout.upperHeight;\n  var isParent = thisViewChildren && thisViewChildren.length;\n  var itemStyleNormalModel = nodeModel.getModel('itemStyle');\n  var itemStyleEmphasisModel = nodeModel.getModel(['emphasis', 'itemStyle']);\n  var itemStyleBlurModel = nodeModel.getModel(['blur', 'itemStyle']);\n  var itemStyleSelectModel = nodeModel.getModel(['select', 'itemStyle']);\n  var borderRadius = itemStyleNormalModel.get('borderRadius') || 0; // End of closure ariables available in \"Procedures in renderNode\".\n  // -----------------------------------------------------------------\n  // Node group\n\n  var group = giveGraphic('nodeGroup', Group);\n\n  if (!group) {\n    return;\n  }\n\n  parentGroup.add(group); // x,y are not set when el is above view root.\n\n  group.x = thisLayout.x || 0;\n  group.y = thisLayout.y || 0;\n  group.markRedraw();\n  inner(group).nodeWidth = thisWidth;\n  inner(group).nodeHeight = thisHeight;\n\n  if (thisLayout.isAboveViewRoot) {\n    return group;\n  } // Background\n\n\n  var bg = giveGraphic('background', Rect, depth, Z_BG);\n  bg && renderBackground(group, bg, isParent && thisLayout.upperLabelHeight);\n  var focus = nodeModel.get(['emphasis', 'focus']);\n  var blurScope = nodeModel.get(['emphasis', 'blurScope']);\n  var focusDataIndices = focus === 'ancestor' ? thisNode.getAncestorsIndices() : focus === 'descendant' ? thisNode.getDescendantIndices() : null; // No children, render content.\n\n  if (isParent) {\n    // Because of the implementation about \"traverse\" in graphic hover style, we\n    // can not set hover listener on the \"group\" of non-leaf node. Otherwise the\n    // hover event from the descendents will be listenered.\n    if (isHighDownDispatcher(group)) {\n      setAsHighDownDispatcher(group, false);\n    }\n\n    if (bg) {\n      setAsHighDownDispatcher(bg, true); // Only for enabling highlight/downplay.\n\n      data.setItemGraphicEl(thisNode.dataIndex, bg);\n      enableHoverFocus(bg, focusDataIndices || focus, blurScope);\n    }\n  } else {\n    var content = giveGraphic('content', Rect, depth, Z_CONTENT);\n    content && renderContent(group, content);\n\n    if (bg && isHighDownDispatcher(bg)) {\n      setAsHighDownDispatcher(bg, false);\n    }\n\n    setAsHighDownDispatcher(group, true); // Only for enabling highlight/downplay.\n\n    data.setItemGraphicEl(thisNode.dataIndex, group);\n    enableHoverFocus(group, focusDataIndices || focus, blurScope);\n  }\n\n  return group; // ----------------------------\n  // | Procedures in renderNode |\n  // ----------------------------\n\n  function renderBackground(group, bg, useUpperLabel) {\n    var ecData = getECData(bg); // For tooltip.\n\n    ecData.dataIndex = thisNode.dataIndex;\n    ecData.seriesIndex = seriesModel.seriesIndex;\n    bg.setShape({\n      x: 0,\n      y: 0,\n      width: thisWidth,\n      height: thisHeight,\n      r: borderRadius\n    });\n\n    if (thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      processInvisible(bg);\n    } else {\n      bg.invisible = false;\n      var style = thisNode.getVisual('style');\n      var visualBorderColor = style.stroke;\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualBorderColor;\n      var emphasisStyle = getStateItemStyle(itemStyleEmphasisModel);\n      emphasisStyle.fill = itemStyleEmphasisModel.get('borderColor');\n      var blurStyle = getStateItemStyle(itemStyleBlurModel);\n      blurStyle.fill = itemStyleBlurModel.get('borderColor');\n      var selectStyle = getStateItemStyle(itemStyleSelectModel);\n      selectStyle.fill = itemStyleSelectModel.get('borderColor');\n\n      if (useUpperLabel) {\n        var upperLabelWidth = thisWidth - 2 * borderWidth;\n        prepareText(bg, visualBorderColor, upperLabelWidth, upperHeight, style.opacity, {\n          x: borderWidth,\n          y: 0,\n          width: upperLabelWidth,\n          height: upperHeight\n        });\n      } // For old bg.\n      else {\n          bg.removeTextContent();\n        }\n\n      bg.setStyle(normalStyle);\n      bg.ensureState('emphasis').style = emphasisStyle;\n      bg.ensureState('blur').style = blurStyle;\n      bg.ensureState('select').style = selectStyle;\n      setDefaultStateProxy(bg);\n    }\n\n    group.add(bg);\n  }\n\n  function renderContent(group, content) {\n    var ecData = getECData(content); // For tooltip.\n\n    ecData.dataIndex = thisNode.dataIndex;\n    ecData.seriesIndex = seriesModel.seriesIndex;\n    var contentWidth = Math.max(thisWidth - 2 * borderWidth, 0);\n    var contentHeight = Math.max(thisHeight - 2 * borderWidth, 0);\n    content.culling = true;\n    content.setShape({\n      x: borderWidth,\n      y: borderWidth,\n      width: contentWidth,\n      height: contentHeight,\n      r: borderRadius\n    });\n\n    if (thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      processInvisible(content);\n    } else {\n      content.invisible = false;\n      var nodeStyle = thisNode.getVisual('style');\n      var visualColor = nodeStyle.fill;\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualColor;\n      normalStyle.decal = nodeStyle.decal;\n      var emphasisStyle = getStateItemStyle(itemStyleEmphasisModel);\n      var blurStyle = getStateItemStyle(itemStyleBlurModel);\n      var selectStyle = getStateItemStyle(itemStyleSelectModel);\n      prepareText(content, visualColor, contentWidth, nodeStyle.opacity, contentHeight);\n      content.setStyle(normalStyle);\n      content.ensureState('emphasis').style = emphasisStyle;\n      content.ensureState('blur').style = blurStyle;\n      content.ensureState('select').style = selectStyle;\n      setDefaultStateProxy(content);\n    }\n\n    group.add(content);\n  }\n\n  function processInvisible(element) {\n    // Delay invisible setting utill animation finished,\n    // avoid element vanish suddenly before animation.\n    !element.invisible && willInvisibleEls.push(element);\n  }\n\n  function prepareText(rectEl, visualColor, visualOpacity, width, height, upperLabelRect) {\n    var normalLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL);\n    var text = retrieve(seriesModel.getFormattedLabel(thisNode.dataIndex, 'normal', null, null, normalLabelModel.get('formatter')), convertOptionIdName(nodeModel.get('name'), null));\n\n    if (!upperLabelRect && thisLayout.isLeafRoot) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      text = iconChar ? iconChar + ' ' + text : text;\n    }\n\n    var isShow = normalLabelModel.getShallow('show');\n    setLabelStyle(rectEl, getLabelStatesModels(nodeModel, upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL), {\n      defaultText: isShow ? text : null,\n      inheritColor: visualColor,\n      defaultOpacity: visualOpacity,\n      labelFetcher: seriesModel,\n      labelDataIndex: thisNode.dataIndex\n    });\n    var textEl = rectEl.getTextContent();\n    var textStyle = textEl.style;\n    var textPadding = normalizeCssArray(textStyle.padding || 0);\n\n    if (upperLabelRect) {\n      rectEl.setTextConfig({\n        layoutRect: upperLabelRect\n      });\n      textEl.disableLabelLayout = true;\n    }\n\n    textEl.beforeUpdate = function () {\n      var width = Math.max((upperLabelRect ? upperLabelRect.width : rectEl.shape.width) - textPadding[1] - textPadding[3], 0);\n      var height = Math.max((upperLabelRect ? upperLabelRect.height : rectEl.shape.height) - textPadding[0] - textPadding[2], 0);\n\n      if (textStyle.width !== width || textStyle.height !== height) {\n        textEl.setStyle({\n          width: width,\n          height: height\n        });\n      }\n    };\n\n    textStyle.truncateMinChar = 2;\n    textStyle.lineOverflow = 'truncate';\n    addDrillDownIcon(textStyle, upperLabelRect, thisLayout);\n    var textEmphasisState = textEl.getState('emphasis');\n    addDrillDownIcon(textEmphasisState ? textEmphasisState.style : null, upperLabelRect, thisLayout);\n  }\n\n  function addDrillDownIcon(style, upperLabelRect, thisLayout) {\n    var text = style ? style.text : null;\n\n    if (!upperLabelRect && thisLayout.isLeafRoot && text != null) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      style.text = iconChar ? iconChar + ' ' + text : text;\n    }\n  }\n\n  function giveGraphic(storageName, Ctor, depth, z) {\n    var element = oldRawIndex != null && oldStorage[storageName][oldRawIndex];\n    var lasts = lastsForAnimation[storageName];\n\n    if (element) {\n      // Remove from oldStorage\n      oldStorage[storageName][oldRawIndex] = null;\n      prepareAnimationWhenHasOld(lasts, element);\n    } // If invisible and no old element, do not create new element (for optimizing).\n    else if (!thisInvisible) {\n        element = new Ctor();\n\n        if (element instanceof Displayable) {\n          element.z = calculateZ(depth, z);\n        }\n\n        prepareAnimationWhenNoOld(lasts, element);\n      } // Set to thisStorage\n\n\n    return thisStorage[storageName][thisRawIndex] = element;\n  }\n\n  function prepareAnimationWhenHasOld(lasts, element) {\n    var lastCfg = lasts[thisRawIndex] = {};\n\n    if (element instanceof Group) {\n      lastCfg.oldX = element.x;\n      lastCfg.oldY = element.y;\n    } else {\n      lastCfg.oldShape = extend({}, element.shape);\n    }\n  } // If a element is new, we need to find the animation start point carefully,\n  // otherwise it will looks strange when 'zoomToNode'.\n\n\n  function prepareAnimationWhenNoOld(lasts, element) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    var parentNode = thisNode.parentNode;\n    var isGroup = element instanceof graphic.Group;\n\n    if (parentNode && (!reRoot || reRoot.direction === 'drillDown')) {\n      var parentOldX = 0;\n      var parentOldY = 0; // New nodes appear from right-bottom corner in 'zoomToNode' animation.\n      // For convenience, get old bounding rect from background.\n\n      var parentOldBg = lastsForAnimation.background[parentNode.getRawIndex()];\n\n      if (!reRoot && parentOldBg && parentOldBg.oldShape) {\n        parentOldX = parentOldBg.oldShape.width;\n        parentOldY = parentOldBg.oldShape.height;\n      } // When no parent old shape found, its parent is new too,\n      // so we can just use {x:0, y:0}.\n\n\n      if (isGroup) {\n        lastCfg.oldX = 0;\n        lastCfg.oldY = parentOldY;\n      } else {\n        lastCfg.oldShape = {\n          x: parentOldX,\n          y: parentOldY,\n          width: 0,\n          height: 0\n        };\n      }\n    } // Fade in, user can be aware that these nodes are new.\n\n\n    lastCfg.fadein = !isGroup;\n  }\n} // We can not set all backgroud with the same z, Because the behaviour of\n// drill down and roll up differ background creation sequence from tree\n// hierarchy sequence, which cause that lowser background element overlap\n// upper ones. So we calculate z based on depth.\n// Moreover, we try to shrink down z interval to [0, 1] to avoid that\n// treemap with large z overlaps other components.\n\n\nfunction calculateZ(depth, zInLevel) {\n  var zb = depth * Z_BASE + zInLevel;\n  return (zb - 1) / zb;\n}\n\nexport default TreemapView;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/node_modules/echarts/lib/chart/treemap/TreemapView.js"],"names":["__extends","bind","each","indexOf","curry","extend","retrieve","normalizeCssArray","isFunction","graphic","getECData","isHighDownDispatcher","setAsHighDownDispatcher","setDefaultStateProxy","enableHoverFocus","DataDiffer","helper","Breadcrumb","RoamController","BoundingRect","matrix","animationUtil","makeStyleMapper","ChartView","Displayable","makeInner","convertOptionIdName","windowOpen","setLabelStyle","getLabelStatesModels","Group","Rect","DRAG_THRESHOLD","PATH_LABEL_NOAMAL","PATH_UPPERLABEL_NORMAL","Z_BASE","Z_BG","Z_CONTENT","getStateItemStyle","getItemStyleNormal","model","itemStyle","stroke","fill","lineWidth","inner","TreemapView","_super","_this","apply","arguments","type","_state","_storage","createStorage","prototype","render","seriesModel","ecModel","api","payload","models","findComponents","mainType","subType","query","types","targetInfo","retrieveTargetInfo","payloadType","layoutInfo","isInit","_oldTree","thisStorage","reRoot","rootNodeGroup","nodeGroup","node","getRawIndex","direction","containerGroup","_giveContainerGroup","renderResult","_doRender","_doAnimation","renderFinally","_resetController","_renderBreadcrumb","_containerGroup","_initEvents","group","add","x","y","thisTree","getData","tree","oldTree","lastsForAnimation","oldStorage","willInvisibleEls","doRenderNode","thisNode","oldNode","parentGroup","depth","renderNode","dualTravel","root","willDeleteEls","clearStorage","thisViewChildren","oldViewChildren","sameTree","child","index","isRemoved","processNode","getKey","update","remove","execute","getId","newIndex","oldIndex","viewChildren","storage","store","storageName","delEls","el","push","willDelete","els","parent","invisible","dirty","get","durationOption","easingOption","duration","easing","animationWrap","createWrap","rawIndex","target","innerStore","shape","width","nodeWidth","height","nodeHeight","style","opacity","targetX","targetY","last","oldX","oldY","oldShape","setShape","fadein","setStyle","finished","start","controller","_controller","getZr","enable","on","_onPan","_onZoom","rect","getWidth","getHeight","setPointerChecker","e","contain","_clearController","dispose","Math","abs","dx","dy","rootLayout","getLayout","dispatchAction","from","uid","seriesId","id","rootRect","mouseX","originX","mouseY","originY","m","create","translate","scale","applyTransform","nodeClick","findTarget","offsetX","offsetY","isLeafRoot","_rootToNode","_zoomToNode","itemModel","hostTree","data","getItemModel","dataIndex","link","linkTarget","getViewRoot","_breadcrumb","aboveViewRoot","removeAll","targetNode","viewRoot","eachNode","attr","order","bgEl","background","point","transformCoordToLocal","content","thisLayout","nodeModel","getModel","setItemGraphicEl","isInView","thisWidth","thisHeight","borderWidth","thisInvisible","thisRawIndex","oldRawIndex","upperHeight","isParent","length","itemStyleNormalModel","itemStyleEmphasisModel","itemStyleBlurModel","itemStyleSelectModel","borderRadius","giveGraphic","markRedraw","isAboveViewRoot","bg","renderBackground","upperLabelHeight","focus","blurScope","focusDataIndices","getAncestorsIndices","getDescendantIndices","renderContent","useUpperLabel","ecData","seriesIndex","r","processInvisible","getVisual","visualBorderColor","normalStyle","emphasisStyle","blurStyle","selectStyle","upperLabelWidth","prepareText","removeTextContent","ensureState","contentWidth","max","contentHeight","culling","nodeStyle","visualColor","decal","element","rectEl","visualOpacity","upperLabelRect","normalLabelModel","text","getFormattedLabel","iconChar","isShow","getShallow","defaultText","inheritColor","defaultOpacity","labelFetcher","labelDataIndex","textEl","getTextContent","textStyle","textPadding","padding","setTextConfig","layoutRect","disableLabelLayout","beforeUpdate","truncateMinChar","lineOverflow","addDrillDownIcon","textEmphasisState","getState","Ctor","z","lasts","prepareAnimationWhenHasOld","calculateZ","prepareAnimationWhenNoOld","lastCfg","parentNode","isGroup","parentOldX","parentOldY","parentOldBg","zInLevel","zb"],"mappings":"AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,SAAT,QAA0B,OAA1B;AACA,SAASC,IAAT,EAAeC,IAAf,EAAqBC,OAArB,EAA8BC,KAA9B,EAAqCC,MAArC,EAA6CC,QAA7C,EAAuDC,iBAAvD,EAA0EC,UAA1E,QAA4F,uBAA5F;AACA,OAAO,KAAKC,OAAZ,MAAyB,oBAAzB;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,SAASC,oBAAT,EAA+BC,uBAA/B,EAAwDC,oBAAxD,EAA8EC,gBAA9E,QAAsG,mBAAtG;AACA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAO,KAAKC,MAAZ,MAAwB,sBAAxB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,cAAP,MAA2B,uCAA3B;AACA,OAAOC,YAAP,MAAyB,+BAAzB;AACA,OAAO,KAAKC,MAAZ,MAAwB,yBAAxB;AACA,OAAO,KAAKC,aAAZ,MAA+B,sBAA/B;AACA,OAAOC,eAAP,MAA4B,mCAA5B;AACA,OAAOC,SAAP,MAAsB,kBAAtB;AACA,OAAOC,WAAP,MAAwB,iCAAxB;AACA,SAASC,SAAT,EAAoBC,mBAApB,QAA+C,kBAA/C;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,SAASC,aAAT,EAAwBC,oBAAxB,QAAoD,wBAApD;AACA,IAAIC,KAAK,GAAGrB,OAAO,CAACqB,KAApB;AACA,IAAIC,IAAI,GAAGtB,OAAO,CAACsB,IAAnB;AACA,IAAIC,cAAc,GAAG,CAArB;AACA,IAAIC,iBAAiB,GAAG,OAAxB;AACA,IAAIC,sBAAsB,GAAG,YAA7B;AACA,IAAIC,MAAM,GAAG,EAAb,C,CAAiB;;AAEjB,IAAIC,IAAI,GAAG,CAAX;AACA,IAAIC,SAAS,GAAG,CAAhB;AACA,IAAIC,iBAAiB,GAAGhB,eAAe,CAAC,CAAC,CAAC,MAAD,EAAS,OAAT,CAAD,EAAoB;AAC5D;AACA,CAAC,QAAD,EAAW,aAAX,CAFwC,EAEb,CAAC,WAAD,EAAc,aAAd,CAFa,EAEiB,CAAC,YAAD,CAFjB,EAEiC,CAAC,eAAD,CAFjC,EAEoD,CAAC,eAAD,CAFpD,EAEuE,CAAC,aAAD,CAFvE,CAEuF;AAC/H;AAHwC,CAAD,CAAvC;;AAMA,IAAIiB,kBAAkB,GAAG,UAAUC,KAAV,EAAiB;AACxC;AACA,MAAIC,SAAS,GAAGH,iBAAiB,CAACE,KAAD,CAAjC,CAFwC,CAEE;;AAE1CC,EAAAA,SAAS,CAACC,MAAV,GAAmBD,SAAS,CAACE,IAAV,GAAiBF,SAAS,CAACG,SAAV,GAAsB,IAA1D;AACA,SAAOH,SAAP;AACD,CAND;;AAQA,IAAII,KAAK,GAAGpB,SAAS,EAArB;;AAEA,IAAIqB,WAAW;AACf;AACA,UAAUC,MAAV,EAAkB;AAChB/C,EAAAA,SAAS,CAAC8C,WAAD,EAAcC,MAAd,CAAT;;AAEA,WAASD,WAAT,GAAuB;AACrB,QAAIE,KAAK,GAAGD,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACE,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAAhE;;AAEAF,IAAAA,KAAK,CAACG,IAAN,GAAaL,WAAW,CAACK,IAAzB;AACAH,IAAAA,KAAK,CAACI,MAAN,GAAe,OAAf;AACAJ,IAAAA,KAAK,CAACK,QAAN,GAAiBC,aAAa,EAA9B;AACA,WAAON,KAAP;AACD;AACD;AACF;AACA;;;AAGEF,EAAAA,WAAW,CAACS,SAAZ,CAAsBC,MAAtB,GAA+B,UAAUC,WAAV,EAAuBC,OAAvB,EAAgCC,GAAhC,EAAqCC,OAArC,EAA8C;AAC3E,QAAIC,MAAM,GAAGH,OAAO,CAACI,cAAR,CAAuB;AAClCC,MAAAA,QAAQ,EAAE,QADwB;AAElCC,MAAAA,OAAO,EAAE,SAFyB;AAGlCC,MAAAA,KAAK,EAAEL;AAH2B,KAAvB,CAAb;;AAMA,QAAIzD,OAAO,CAAC0D,MAAD,EAASJ,WAAT,CAAP,GAA+B,CAAnC,EAAsC;AACpC;AACD;;AAED,SAAKA,WAAL,GAAmBA,WAAnB;AACA,SAAKE,GAAL,GAAWA,GAAX;AACA,SAAKD,OAAL,GAAeA,OAAf;AACA,QAAIQ,KAAK,GAAG,CAAC,mBAAD,EAAsB,mBAAtB,CAAZ;AACA,QAAIC,UAAU,GAAGnD,MAAM,CAACoD,kBAAP,CAA0BR,OAA1B,EAAmCM,KAAnC,EAA0CT,WAA1C,CAAjB;AACA,QAAIY,WAAW,GAAGT,OAAO,IAAIA,OAAO,CAACT,IAArC;AACA,QAAImB,UAAU,GAAGb,WAAW,CAACa,UAA7B;AACA,QAAIC,MAAM,GAAG,CAAC,KAAKC,QAAnB;AACA,QAAIC,WAAW,GAAG,KAAKpB,QAAvB,CAnB2E,CAmB1C;;AAEjC,QAAIqB,MAAM,GAAGL,WAAW,KAAK,mBAAhB,IAAuCF,UAAvC,IAAqDM,WAArD,GAAmE;AAC9EE,MAAAA,aAAa,EAAEF,WAAW,CAACG,SAAZ,CAAsBT,UAAU,CAACU,IAAX,CAAgBC,WAAhB,EAAtB,CAD+D;AAE9EC,MAAAA,SAAS,EAAEnB,OAAO,CAACmB;AAF2D,KAAnE,GAGT,IAHJ;;AAKA,QAAIC,cAAc,GAAG,KAAKC,mBAAL,CAAyBX,UAAzB,CAArB;;AAEA,QAAIY,YAAY,GAAG,KAAKC,SAAL,CAAeH,cAAf,EAA+BvB,WAA/B,EAA4CiB,MAA5C,CAAnB;;AAEA,KAACH,MAAD,KAAY,CAACF,WAAD,IAAgBA,WAAW,KAAK,mBAAhC,IAAuDA,WAAW,KAAK,mBAAnF,IAA0G,KAAKe,YAAL,CAAkBJ,cAAlB,EAAkCE,YAAlC,EAAgDzB,WAAhD,EAA6DiB,MAA7D,CAA1G,GAAiLQ,YAAY,CAACG,aAAb,EAAjL;;AAEA,SAAKC,gBAAL,CAAsB3B,GAAtB;;AAEA,SAAK4B,iBAAL,CAAuB9B,WAAvB,EAAoCE,GAApC,EAAyCQ,UAAzC;AACD,GAnCD;;AAqCArB,EAAAA,WAAW,CAACS,SAAZ,CAAsB0B,mBAAtB,GAA4C,UAAUX,UAAV,EAAsB;AAChE,QAAIU,cAAc,GAAG,KAAKQ,eAA1B;;AAEA,QAAI,CAACR,cAAL,EAAqB;AACnB;AACA;AACAA,MAAAA,cAAc,GAAG,KAAKQ,eAAL,GAAuB,IAAI1D,KAAJ,EAAxC;;AAEA,WAAK2D,WAAL,CAAiBT,cAAjB;;AAEA,WAAKU,KAAL,CAAWC,GAAX,CAAeX,cAAf;AACD;;AAEDA,IAAAA,cAAc,CAACY,CAAf,GAAmBtB,UAAU,CAACsB,CAA9B;AACAZ,IAAAA,cAAc,CAACa,CAAf,GAAmBvB,UAAU,CAACuB,CAA9B;AACA,WAAOb,cAAP;AACD,GAhBD;;AAkBAlC,EAAAA,WAAW,CAACS,SAAZ,CAAsB4B,SAAtB,GAAkC,UAAUH,cAAV,EAA0BvB,WAA1B,EAAuCiB,MAAvC,EAA+C;AAC/E,QAAIoB,QAAQ,GAAGrC,WAAW,CAACsC,OAAZ,GAAsBC,IAArC;AACA,QAAIC,OAAO,GAAG,KAAKzB,QAAnB,CAF+E,CAElD;;AAE7B,QAAI0B,iBAAiB,GAAG5C,aAAa,EAArC;AACA,QAAImB,WAAW,GAAGnB,aAAa,EAA/B;AACA,QAAI6C,UAAU,GAAG,KAAK9C,QAAtB;AACA,QAAI+C,gBAAgB,GAAG,EAAvB;;AAEA,aAASC,YAAT,CAAsBC,QAAtB,EAAgCC,OAAhC,EAAyCC,WAAzC,EAAsDC,KAAtD,EAA6D;AAC3D,aAAOC,UAAU,CAACjD,WAAD,EAAcgB,WAAd,EAA2B0B,UAA3B,EAAuCzB,MAAvC,EAA+CwB,iBAA/C,EAAkEE,gBAAlE,EAAoFE,QAApF,EAA8FC,OAA9F,EAAuGC,WAAvG,EAAoHC,KAApH,CAAjB;AACD,KAX8E,CAW7E;AACF;AACA;AACA;;;AAGAE,IAAAA,UAAU,CAACb,QAAQ,CAACc,IAAT,GAAgB,CAACd,QAAQ,CAACc,IAAV,CAAhB,GAAkC,EAAnC,EAAuCX,OAAO,IAAIA,OAAO,CAACW,IAAnB,GAA0B,CAACX,OAAO,CAACW,IAAT,CAA1B,GAA2C,EAAlF,EAAsF5B,cAAtF,EAAsGc,QAAQ,KAAKG,OAAb,IAAwB,CAACA,OAA/H,EAAwI,CAAxI,CAAV,CAjB+E,CAiBuE;;AAEtJ,QAAIY,aAAa,GAAGC,YAAY,CAACX,UAAD,CAAhC;AACA,SAAK3B,QAAL,GAAgBsB,QAAhB;AACA,SAAKzC,QAAL,GAAgBoB,WAAhB;AACA,WAAO;AACLyB,MAAAA,iBAAiB,EAAEA,iBADd;AAELW,MAAAA,aAAa,EAAEA,aAFV;AAGLxB,MAAAA,aAAa,EAAEA;AAHV,KAAP;;AAMA,aAASsB,UAAT,CAAoBI,gBAApB,EAAsCC,eAAtC,EAAuDR,WAAvD,EAAoES,QAApE,EAA8ER,KAA9E,EAAqF;AACnF;AACA;AACA;AACA,UAAIQ,QAAJ,EAAc;AACZD,QAAAA,eAAe,GAAGD,gBAAlB;AACA7G,QAAAA,IAAI,CAAC6G,gBAAD,EAAmB,UAAUG,KAAV,EAAiBC,KAAjB,EAAwB;AAC7C,WAACD,KAAK,CAACE,SAAN,EAAD,IAAsBC,WAAW,CAACF,KAAD,EAAQA,KAAR,CAAjC;AACD,SAFG,CAAJ;AAGD,OALD,CAKE;AACF;AANA,WAOK;AACD,cAAIpG,UAAJ,CAAeiG,eAAf,EAAgCD,gBAAhC,EAAkDO,MAAlD,EAA0DA,MAA1D,EAAkE3B,GAAlE,CAAsE0B,WAAtE,EAAmFE,MAAnF,CAA0FF,WAA1F,EAAuGG,MAAvG,CAA8GpH,KAAK,CAACiH,WAAD,EAAc,IAAd,CAAnH,EAAwII,OAAxI;AACD;;AAEH,eAASH,MAAT,CAAgBzC,IAAhB,EAAsB;AACpB;AACA,eAAOA,IAAI,CAAC6C,KAAL,EAAP;AACD;;AAED,eAASL,WAAT,CAAqBM,QAArB,EAA+BC,QAA/B,EAAyC;AACvC,YAAItB,QAAQ,GAAGqB,QAAQ,IAAI,IAAZ,GAAmBZ,gBAAgB,CAACY,QAAD,CAAnC,GAAgD,IAA/D;AACA,YAAIpB,OAAO,GAAGqB,QAAQ,IAAI,IAAZ,GAAmBZ,eAAe,CAACY,QAAD,CAAlC,GAA+C,IAA7D;AACA,YAAIlC,KAAK,GAAGW,YAAY,CAACC,QAAD,EAAWC,OAAX,EAAoBC,WAApB,EAAiCC,KAAjC,CAAxB;AACAf,QAAAA,KAAK,IAAIiB,UAAU,CAACL,QAAQ,IAAIA,QAAQ,CAACuB,YAArB,IAAqC,EAAtC,EAA0CtB,OAAO,IAAIA,OAAO,CAACsB,YAAnB,IAAmC,EAA7E,EAAiFnC,KAAjF,EAAwFuB,QAAxF,EAAkGR,KAAK,GAAG,CAA1G,CAAnB;AACD;AACF;;AAED,aAASK,YAAT,CAAsBgB,OAAtB,EAA+B;AAC7B,UAAIjB,aAAa,GAAGvD,aAAa,EAAjC;AACAwE,MAAAA,OAAO,IAAI5H,IAAI,CAAC4H,OAAD,EAAU,UAAUC,KAAV,EAAiBC,WAAjB,EAA8B;AACrD,YAAIC,MAAM,GAAGpB,aAAa,CAACmB,WAAD,CAA1B;AACA9H,QAAAA,IAAI,CAAC6H,KAAD,EAAQ,UAAUG,EAAV,EAAc;AACxBA,UAAAA,EAAE,KAAKD,MAAM,CAACE,IAAP,CAAYD,EAAZ,GAAiBrF,KAAK,CAACqF,EAAD,CAAL,CAAUE,UAAV,GAAuB,IAA7C,CAAF;AACD,SAFG,CAAJ;AAGD,OALc,CAAf;AAMA,aAAOvB,aAAP;AACD;;AAED,aAASxB,aAAT,GAAyB;AACvBnF,MAAAA,IAAI,CAAC2G,aAAD,EAAgB,UAAUwB,GAAV,EAAe;AACjCnI,QAAAA,IAAI,CAACmI,GAAD,EAAM,UAAUH,EAAV,EAAc;AACtBA,UAAAA,EAAE,CAACI,MAAH,IAAaJ,EAAE,CAACI,MAAH,CAAUd,MAAV,CAAiBU,EAAjB,CAAb;AACD,SAFG,CAAJ;AAGD,OAJG,CAAJ;AAKAhI,MAAAA,IAAI,CAACkG,gBAAD,EAAmB,UAAU8B,EAAV,EAAc;AACnCA,QAAAA,EAAE,CAACK,SAAH,GAAe,IAAf,CADmC,CACd;AACrB;;AAEAL,QAAAA,EAAE,CAACM,KAAH;AACD,OALG,CAAJ;AAMD;AACF,GAhFD;;AAkFA1F,EAAAA,WAAW,CAACS,SAAZ,CAAsB6B,YAAtB,GAAqC,UAAUJ,cAAV,EAA0BE,YAA1B,EAAwCzB,WAAxC,EAAqDiB,MAArD,EAA6D;AAChG,QAAI,CAACjB,WAAW,CAACgF,GAAZ,CAAgB,WAAhB,CAAL,EAAmC;AACjC;AACD;;AAED,QAAIC,cAAc,GAAGjF,WAAW,CAACgF,GAAZ,CAAgB,yBAAhB,CAArB;AACA,QAAIE,YAAY,GAAGlF,WAAW,CAACgF,GAAZ,CAAgB,iBAAhB,CAAnB,CANgG,CAMzC;;AAEvD,QAAIG,QAAQ,GAAG,CAACpI,UAAU,CAACkI,cAAD,CAAV,GAA6B,CAA7B,GAAiCA,cAAlC,KAAqD,CAApE;AACA,QAAIG,MAAM,GAAG,CAACrI,UAAU,CAACmI,YAAD,CAAV,GAA2B,IAA3B,GAAkCA,YAAnC,KAAoD,UAAjE;AACA,QAAIG,aAAa,GAAGzH,aAAa,CAAC0H,UAAd,EAApB,CAVgG,CAUhD;;AAEhD7I,IAAAA,IAAI,CAACgF,YAAY,CAAC2B,aAAd,EAA6B,UAAUkB,KAAV,EAAiBC,WAAjB,EAA8B;AAC7D9H,MAAAA,IAAI,CAAC6H,KAAD,EAAQ,UAAUG,EAAV,EAAcc,QAAd,EAAwB;AAClC,YAAId,EAAE,CAACK,SAAP,EAAkB;AAChB;AACD;;AAED,YAAID,MAAM,GAAGJ,EAAE,CAACI,MAAhB,CALkC,CAKV;;AAExB,YAAIW,MAAJ;AACA,YAAIC,UAAU,GAAGrG,KAAK,CAACyF,MAAD,CAAtB;;AAEA,YAAI5D,MAAM,IAAIA,MAAM,CAACK,SAAP,KAAqB,WAAnC,EAAgD;AAC9CkE,UAAAA,MAAM,GAAGX,MAAM,KAAK5D,MAAM,CAACC,aAAlB,CAAgC;AACzC;AACA;AAFS,YAGP;AACAwE,YAAAA,KAAK,EAAE;AACLvD,cAAAA,CAAC,EAAE,CADE;AAELC,cAAAA,CAAC,EAAE,CAFE;AAGLuD,cAAAA,KAAK,EAAEF,UAAU,CAACG,SAHb;AAILC,cAAAA,MAAM,EAAEJ,UAAU,CAACK;AAJd,aADP;AAOAC,YAAAA,KAAK,EAAE;AACLC,cAAAA,OAAO,EAAE;AADJ;AAPP,WAHO,CAaP;AAbO,YAcP;AACAD,YAAAA,KAAK,EAAE;AACLC,cAAAA,OAAO,EAAE;AADJ;AADP,WAdF;AAmBD,SApBD,MAoBO;AACL,cAAIC,OAAO,GAAG,CAAd;AACA,cAAIC,OAAO,GAAG,CAAd;;AAEA,cAAI,CAACT,UAAU,CAACd,UAAhB,EAA4B;AAC1B;AACA;AACA;AACAsB,YAAAA,OAAO,GAAGR,UAAU,CAACG,SAAX,GAAuB,CAAjC;AACAM,YAAAA,OAAO,GAAGT,UAAU,CAACK,UAAX,GAAwB,CAAlC;AACD;;AAEDN,UAAAA,MAAM,GAAGjB,WAAW,KAAK,WAAhB,GAA8B;AACrCpC,YAAAA,CAAC,EAAE8D,OADkC;AAErC7D,YAAAA,CAAC,EAAE8D,OAFkC;AAGrCH,YAAAA,KAAK,EAAE;AACLC,cAAAA,OAAO,EAAE;AADJ;AAH8B,WAA9B,GAML;AACFN,YAAAA,KAAK,EAAE;AACLvD,cAAAA,CAAC,EAAE8D,OADE;AAEL7D,cAAAA,CAAC,EAAE8D,OAFE;AAGLP,cAAAA,KAAK,EAAE,CAHF;AAILE,cAAAA,MAAM,EAAE;AAJH,aADL;AAOFE,YAAAA,KAAK,EAAE;AACLC,cAAAA,OAAO,EAAE;AADJ;AAPL,WANJ;AAiBD,SA3DiC,CA2DhC;;;AAGFR,QAAAA,MAAM,IAAIH,aAAa,CAACnD,GAAd,CAAkBuC,EAAlB,EAAsBe,MAAtB,EAA8BL,QAA9B,EAAwC,CAAxC,EAA2CC,MAA3C,CAAV;AACD,OA/DG,CAAJ;AAgED,KAjEG,CAAJ,CAZgG,CA6E5F;;AAEJ3I,IAAAA,IAAI,CAAC,KAAKmD,QAAN,EAAgB,UAAU0E,KAAV,EAAiBC,WAAjB,EAA8B;AAChD9H,MAAAA,IAAI,CAAC6H,KAAD,EAAQ,UAAUG,EAAV,EAAcc,QAAd,EAAwB;AAClC,YAAIY,IAAI,GAAG1E,YAAY,CAACgB,iBAAb,CAA+B8B,WAA/B,EAA4CgB,QAA5C,CAAX;AACA,YAAIC,MAAM,GAAG,EAAb;;AAEA,YAAI,CAACW,IAAL,EAAW;AACT;AACD;;AAED,YAAI1B,EAAE,YAAYzH,OAAO,CAACqB,KAA1B,EAAiC;AAC/B,cAAI8H,IAAI,CAACC,IAAL,IAAa,IAAjB,EAAuB;AACrBZ,YAAAA,MAAM,CAACrD,CAAP,GAAWsC,EAAE,CAACtC,CAAd;AACAqD,YAAAA,MAAM,CAACpD,CAAP,GAAWqC,EAAE,CAACrC,CAAd;AACAqC,YAAAA,EAAE,CAACtC,CAAH,GAAOgE,IAAI,CAACC,IAAZ;AACA3B,YAAAA,EAAE,CAACrC,CAAH,GAAO+D,IAAI,CAACE,IAAZ;AACD;AACF,SAPD,MAOO;AACL,cAAIF,IAAI,CAACG,QAAT,EAAmB;AACjBd,YAAAA,MAAM,CAACE,KAAP,GAAe9I,MAAM,CAAC,EAAD,EAAK6H,EAAE,CAACiB,KAAR,CAArB;AACAjB,YAAAA,EAAE,CAAC8B,QAAH,CAAYJ,IAAI,CAACG,QAAjB;AACD;;AAED,cAAIH,IAAI,CAACK,MAAT,EAAiB;AACf/B,YAAAA,EAAE,CAACgC,QAAH,CAAY,SAAZ,EAAuB,CAAvB;AACAjB,YAAAA,MAAM,CAACO,KAAP,GAAe;AACbC,cAAAA,OAAO,EAAE;AADI,aAAf;AAGD,WALD,CAKE;AACF;AANA,eAOK,IAAIvB,EAAE,CAACsB,KAAH,CAASC,OAAT,KAAqB,CAAzB,EAA4B;AAC7BR,cAAAA,MAAM,CAACO,KAAP,GAAe;AACbC,gBAAAA,OAAO,EAAE;AADI,eAAf;AAGD;AACJ;;AAEDX,QAAAA,aAAa,CAACnD,GAAd,CAAkBuC,EAAlB,EAAsBe,MAAtB,EAA8BL,QAA9B,EAAwC,CAAxC,EAA2CC,MAA3C;AACD,OApCG,CAAJ;AAqCD,KAtCG,EAsCD,IAtCC,CAAJ;AAuCA,SAAKzF,MAAL,GAAc,WAAd;AACA0F,IAAAA,aAAa,CAACqB,QAAd,CAAuBlK,IAAI,CAAC,YAAY;AACtC,WAAKmD,MAAL,GAAc,OAAd;AACA8B,MAAAA,YAAY,CAACG,aAAb;AACD,KAH0B,EAGxB,IAHwB,CAA3B,EAGU+E,KAHV;AAID,GA3HD;;AA6HAtH,EAAAA,WAAW,CAACS,SAAZ,CAAsB+B,gBAAtB,GAAyC,UAAU3B,GAAV,EAAe;AACtD,QAAI0G,UAAU,GAAG,KAAKC,WAAtB,CADsD,CACnB;;AAEnC,QAAI,CAACD,UAAL,EAAiB;AACfA,MAAAA,UAAU,GAAG,KAAKC,WAAL,GAAmB,IAAIpJ,cAAJ,CAAmByC,GAAG,CAAC4G,KAAJ,EAAnB,CAAhC;AACAF,MAAAA,UAAU,CAACG,MAAX,CAAkB,KAAK/G,WAAL,CAAiBgF,GAAjB,CAAqB,MAArB,CAAlB;AACA4B,MAAAA,UAAU,CAACI,EAAX,CAAc,KAAd,EAAqBxK,IAAI,CAAC,KAAKyK,MAAN,EAAc,IAAd,CAAzB;AACAL,MAAAA,UAAU,CAACI,EAAX,CAAc,MAAd,EAAsBxK,IAAI,CAAC,KAAK0K,OAAN,EAAe,IAAf,CAA1B;AACD;;AAED,QAAIC,IAAI,GAAG,IAAIzJ,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBwC,GAAG,CAACkH,QAAJ,EAAvB,EAAuClH,GAAG,CAACmH,SAAJ,EAAvC,CAAX;AACAT,IAAAA,UAAU,CAACU,iBAAX,CAA6B,UAAUC,CAAV,EAAapF,CAAb,EAAgBC,CAAhB,EAAmB;AAC9C,aAAO+E,IAAI,CAACK,OAAL,CAAarF,CAAb,EAAgBC,CAAhB,CAAP;AACD,KAFD;AAGD,GAdD;;AAgBA/C,EAAAA,WAAW,CAACS,SAAZ,CAAsB2H,gBAAtB,GAAyC,YAAY;AACnD,QAAIb,UAAU,GAAG,KAAKC,WAAtB;;AAEA,QAAID,UAAJ,EAAgB;AACdA,MAAAA,UAAU,CAACc,OAAX;AACAd,MAAAA,UAAU,GAAG,IAAb;AACD;AACF,GAPD;;AASAvH,EAAAA,WAAW,CAACS,SAAZ,CAAsBmH,MAAtB,GAA+B,UAAUM,CAAV,EAAa;AAC1C,QAAI,KAAK5H,MAAL,KAAgB,WAAhB,KAAgCgI,IAAI,CAACC,GAAL,CAASL,CAAC,CAACM,EAAX,IAAiBtJ,cAAjB,IAAmCoJ,IAAI,CAACC,GAAL,CAASL,CAAC,CAACO,EAAX,IAAiBvJ,cAApF,CAAJ,EAAyG;AACvG;AACA,UAAI4E,IAAI,GAAG,KAAKnD,WAAL,CAAiBsC,OAAjB,GAA2BC,IAA3B,CAAgCY,IAA3C;;AAEA,UAAI,CAACA,IAAL,EAAW;AACT;AACD;;AAED,UAAI4E,UAAU,GAAG5E,IAAI,CAAC6E,SAAL,EAAjB;;AAEA,UAAI,CAACD,UAAL,EAAiB;AACf;AACD;;AAED,WAAK7H,GAAL,CAAS+H,cAAT,CAAwB;AACtBvI,QAAAA,IAAI,EAAE,aADgB;AAEtBwI,QAAAA,IAAI,EAAE,KAAKC,GAFW;AAGtBC,QAAAA,QAAQ,EAAE,KAAKpI,WAAL,CAAiBqI,EAHL;AAItBC,QAAAA,QAAQ,EAAE;AACRnG,UAAAA,CAAC,EAAE4F,UAAU,CAAC5F,CAAX,GAAeoF,CAAC,CAACM,EADZ;AAERzF,UAAAA,CAAC,EAAE2F,UAAU,CAAC3F,CAAX,GAAemF,CAAC,CAACO,EAFZ;AAGRnC,UAAAA,KAAK,EAAEoC,UAAU,CAACpC,KAHV;AAIRE,UAAAA,MAAM,EAAEkC,UAAU,CAAClC;AAJX;AAJY,OAAxB;AAWD;AACF,GA3BD;;AA6BAxG,EAAAA,WAAW,CAACS,SAAZ,CAAsBoH,OAAtB,GAAgC,UAAUK,CAAV,EAAa;AAC3C,QAAIgB,MAAM,GAAGhB,CAAC,CAACiB,OAAf;AACA,QAAIC,MAAM,GAAGlB,CAAC,CAACmB,OAAf;;AAEA,QAAI,KAAK/I,MAAL,KAAgB,WAApB,EAAiC;AAC/B;AACA,UAAIwD,IAAI,GAAG,KAAKnD,WAAL,CAAiBsC,OAAjB,GAA2BC,IAA3B,CAAgCY,IAA3C;;AAEA,UAAI,CAACA,IAAL,EAAW;AACT;AACD;;AAED,UAAI4E,UAAU,GAAG5E,IAAI,CAAC6E,SAAL,EAAjB;;AAEA,UAAI,CAACD,UAAL,EAAiB;AACf;AACD;;AAED,UAAIZ,IAAI,GAAG,IAAIzJ,YAAJ,CAAiBqK,UAAU,CAAC5F,CAA5B,EAA+B4F,UAAU,CAAC3F,CAA1C,EAA6C2F,UAAU,CAACpC,KAAxD,EAA+DoC,UAAU,CAAClC,MAA1E,CAAX;AACA,UAAIhF,UAAU,GAAG,KAAKb,WAAL,CAAiBa,UAAlC,CAf+B,CAee;;AAE9C0H,MAAAA,MAAM,IAAI1H,UAAU,CAACsB,CAArB;AACAsG,MAAAA,MAAM,IAAI5H,UAAU,CAACuB,CAArB,CAlB+B,CAkBP;;AAExB,UAAIuG,CAAC,GAAGhL,MAAM,CAACiL,MAAP,EAAR;AACAjL,MAAAA,MAAM,CAACkL,SAAP,CAAiBF,CAAjB,EAAoBA,CAApB,EAAuB,CAAC,CAACJ,MAAF,EAAU,CAACE,MAAX,CAAvB;AACA9K,MAAAA,MAAM,CAACmL,KAAP,CAAaH,CAAb,EAAgBA,CAAhB,EAAmB,CAACpB,CAAC,CAACuB,KAAH,EAAUvB,CAAC,CAACuB,KAAZ,CAAnB;AACAnL,MAAAA,MAAM,CAACkL,SAAP,CAAiBF,CAAjB,EAAoBA,CAApB,EAAuB,CAACJ,MAAD,EAASE,MAAT,CAAvB;AACAtB,MAAAA,IAAI,CAAC4B,cAAL,CAAoBJ,CAApB;AACA,WAAKzI,GAAL,CAAS+H,cAAT,CAAwB;AACtBvI,QAAAA,IAAI,EAAE,eADgB;AAEtBwI,QAAAA,IAAI,EAAE,KAAKC,GAFW;AAGtBC,QAAAA,QAAQ,EAAE,KAAKpI,WAAL,CAAiBqI,EAHL;AAItBC,QAAAA,QAAQ,EAAE;AACRnG,UAAAA,CAAC,EAAEgF,IAAI,CAAChF,CADA;AAERC,UAAAA,CAAC,EAAE+E,IAAI,CAAC/E,CAFA;AAGRuD,UAAAA,KAAK,EAAEwB,IAAI,CAACxB,KAHJ;AAIRE,UAAAA,MAAM,EAAEsB,IAAI,CAACtB;AAJL;AAJY,OAAxB;AAWD;AACF,GAzCD;;AA2CAxG,EAAAA,WAAW,CAACS,SAAZ,CAAsBkC,WAAtB,GAAoC,UAAUT,cAAV,EAA0B;AAC5D,QAAIhC,KAAK,GAAG,IAAZ;;AAEAgC,IAAAA,cAAc,CAACyF,EAAf,CAAkB,OAAlB,EAA2B,UAAUO,CAAV,EAAa;AACtC,UAAIhI,KAAK,CAACI,MAAN,KAAiB,OAArB,EAA8B;AAC5B;AACD;;AAED,UAAIqJ,SAAS,GAAGzJ,KAAK,CAACS,WAAN,CAAkBgF,GAAlB,CAAsB,WAAtB,EAAmC,IAAnC,CAAhB;;AAEA,UAAI,CAACgE,SAAL,EAAgB;AACd;AACD;;AAED,UAAItI,UAAU,GAAGnB,KAAK,CAAC0J,UAAN,CAAiB1B,CAAC,CAAC2B,OAAnB,EAA4B3B,CAAC,CAAC4B,OAA9B,CAAjB;;AAEA,UAAI,CAACzI,UAAL,EAAiB;AACf;AACD;;AAED,UAAIU,IAAI,GAAGV,UAAU,CAACU,IAAtB;;AAEA,UAAIA,IAAI,CAAC4G,SAAL,GAAiBoB,UAArB,EAAiC;AAC/B7J,QAAAA,KAAK,CAAC8J,WAAN,CAAkB3I,UAAlB;AACD,OAFD,MAEO;AACL,YAAIsI,SAAS,KAAK,YAAlB,EAAgC;AAC9BzJ,UAAAA,KAAK,CAAC+J,WAAN,CAAkB5I,UAAlB;AACD,SAFD,MAEO,IAAIsI,SAAS,KAAK,MAAlB,EAA0B;AAC/B,cAAIO,SAAS,GAAGnI,IAAI,CAACoI,QAAL,CAAcC,IAAd,CAAmBC,YAAnB,CAAgCtI,IAAI,CAACuI,SAArC,CAAhB;AACA,cAAIC,IAAI,GAAGL,SAAS,CAACvE,GAAV,CAAc,MAAd,EAAsB,IAAtB,CAAX;AACA,cAAI6E,UAAU,GAAGN,SAAS,CAACvE,GAAV,CAAc,QAAd,EAAwB,IAAxB,KAAiC,OAAlD;AACA4E,UAAAA,IAAI,IAAI1L,UAAU,CAAC0L,IAAD,EAAOC,UAAP,CAAlB;AACD;AACF;AACF,KA/BD,EA+BG,IA/BH;AAgCD,GAnCD;;AAqCAxK,EAAAA,WAAW,CAACS,SAAZ,CAAsBgC,iBAAtB,GAA0C,UAAU9B,WAAV,EAAuBE,GAAvB,EAA4BQ,UAA5B,EAAwC;AAChF,QAAInB,KAAK,GAAG,IAAZ;;AAEA,QAAI,CAACmB,UAAL,EAAiB;AACfA,MAAAA,UAAU,GAAGV,WAAW,CAACgF,GAAZ,CAAgB,WAAhB,EAA6B,IAA7B,KAAsC,IAAtC,GAA6C;AACxD5D,QAAAA,IAAI,EAAEpB,WAAW,CAAC8J,WAAZ;AADkD,OAA7C,CAEX;AACF;AACA;AAJa,QAKX,KAAKb,UAAL,CAAgB/I,GAAG,CAACkH,QAAJ,KAAiB,CAAjC,EAAoClH,GAAG,CAACmH,SAAJ,KAAkB,CAAtD,CALF;;AAOA,UAAI,CAAC3G,UAAL,EAAiB;AACfA,QAAAA,UAAU,GAAG;AACXU,UAAAA,IAAI,EAAEpB,WAAW,CAACsC,OAAZ,GAAsBC,IAAtB,CAA2BY;AADtB,SAAb;AAGD;AACF;;AAED,KAAC,KAAK4G,WAAL,KAAqB,KAAKA,WAAL,GAAmB,IAAIvM,UAAJ,CAAe,KAAKyE,KAApB,CAAxC,CAAD,EAAsElC,MAAtE,CAA6EC,WAA7E,EAA0FE,GAA1F,EAA+FQ,UAAU,CAACU,IAA1G,EAAgH,UAAUA,IAAV,EAAgB;AAC9H,UAAI7B,KAAK,CAACI,MAAN,KAAiB,WAArB,EAAkC;AAChCpC,QAAAA,MAAM,CAACyM,aAAP,CAAqBhK,WAAW,CAAC8J,WAAZ,EAArB,EAAgD1I,IAAhD,IAAwD7B,KAAK,CAAC8J,WAAN,CAAkB;AACxEjI,UAAAA,IAAI,EAAEA;AADkE,SAAlB,CAAxD,GAEK7B,KAAK,CAAC+J,WAAN,CAAkB;AACrBlI,UAAAA,IAAI,EAAEA;AADe,SAAlB,CAFL;AAKD;AACF,KARD;AASD,GA3BD;AA4BA;AACF;AACA;;;AAGE/B,EAAAA,WAAW,CAACS,SAAZ,CAAsBiE,MAAtB,GAA+B,YAAY;AACzC,SAAK0D,gBAAL;;AAEA,SAAK1F,eAAL,IAAwB,KAAKA,eAAL,CAAqBkI,SAArB,EAAxB;AACA,SAAKrK,QAAL,GAAgBC,aAAa,EAA7B;AACA,SAAKF,MAAL,GAAc,OAAd;AACA,SAAKoK,WAAL,IAAoB,KAAKA,WAAL,CAAiBhG,MAAjB,EAApB;AACD,GAPD;;AASA1E,EAAAA,WAAW,CAACS,SAAZ,CAAsB4H,OAAtB,GAAgC,YAAY;AAC1C,SAAKD,gBAAL;AACD,GAFD;;AAIApI,EAAAA,WAAW,CAACS,SAAZ,CAAsBwJ,WAAtB,GAAoC,UAAU5I,UAAV,EAAsB;AACxD,SAAKR,GAAL,CAAS+H,cAAT,CAAwB;AACtBvI,MAAAA,IAAI,EAAE,mBADgB;AAEtBwI,MAAAA,IAAI,EAAE,KAAKC,GAFW;AAGtBC,MAAAA,QAAQ,EAAE,KAAKpI,WAAL,CAAiBqI,EAHL;AAItB6B,MAAAA,UAAU,EAAExJ,UAAU,CAACU;AAJD,KAAxB;AAMD,GAPD;;AASA/B,EAAAA,WAAW,CAACS,SAAZ,CAAsBuJ,WAAtB,GAAoC,UAAU3I,UAAV,EAAsB;AACxD,SAAKR,GAAL,CAAS+H,cAAT,CAAwB;AACtBvI,MAAAA,IAAI,EAAE,mBADgB;AAEtBwI,MAAAA,IAAI,EAAE,KAAKC,GAFW;AAGtBC,MAAAA,QAAQ,EAAE,KAAKpI,WAAL,CAAiBqI,EAHL;AAItB6B,MAAAA,UAAU,EAAExJ,UAAU,CAACU;AAJD,KAAxB;AAMD,GAPD;AAQA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGE/B,EAAAA,WAAW,CAACS,SAAZ,CAAsBmJ,UAAtB,GAAmC,UAAU9G,CAAV,EAAaC,CAAb,EAAgB;AACjD,QAAI1B,UAAJ;AACA,QAAIyJ,QAAQ,GAAG,KAAKnK,WAAL,CAAiB8J,WAAjB,EAAf;AACAK,IAAAA,QAAQ,CAACC,QAAT,CAAkB;AAChBC,MAAAA,IAAI,EAAE,cADU;AAEhBC,MAAAA,KAAK,EAAE;AAFS,KAAlB,EAGG,UAAUlJ,IAAV,EAAgB;AACjB,UAAImJ,IAAI,GAAG,KAAK3K,QAAL,CAAc4K,UAAd,CAAyBpJ,IAAI,CAACC,WAAL,EAAzB,CAAX,CADiB,CACwC;;;AAGzD,UAAIkJ,IAAJ,EAAU;AACR,YAAIE,KAAK,GAAGF,IAAI,CAACG,qBAAL,CAA2BvI,CAA3B,EAA8BC,CAA9B,CAAZ;AACA,YAAIsD,KAAK,GAAG6E,IAAI,CAAC7E,KAAjB,CAFQ,CAEgB;;AAExB,YAAIA,KAAK,CAACvD,CAAN,IAAWsI,KAAK,CAAC,CAAD,CAAhB,IAAuBA,KAAK,CAAC,CAAD,CAAL,IAAY/E,KAAK,CAACvD,CAAN,GAAUuD,KAAK,CAACC,KAAnD,IAA4DD,KAAK,CAACtD,CAAN,IAAWqI,KAAK,CAAC,CAAD,CAA5E,IAAmFA,KAAK,CAAC,CAAD,CAAL,IAAY/E,KAAK,CAACtD,CAAN,GAAUsD,KAAK,CAACG,MAAnH,EAA2H;AACzHnF,UAAAA,UAAU,GAAG;AACXU,YAAAA,IAAI,EAAEA,IADK;AAEX8H,YAAAA,OAAO,EAAEuB,KAAK,CAAC,CAAD,CAFH;AAGXtB,YAAAA,OAAO,EAAEsB,KAAK,CAAC,CAAD;AAHH,WAAb;AAKD,SAND,MAMO;AACL,iBAAO,KAAP,CADK,CACS;AACf;AACF;AACF,KArBD,EAqBG,IArBH;AAsBA,WAAO/J,UAAP;AACD,GA1BD;;AA4BArB,EAAAA,WAAW,CAACK,IAAZ,GAAmB,SAAnB;AACA,SAAOL,WAAP;AACD,CApgBD,CAogBEvB,SApgBF,CAFA;AAugBA;AACA;AACA;;;AAGA,SAAS+B,aAAT,GAAyB;AACvB,SAAO;AACLsB,IAAAA,SAAS,EAAE,EADN;AAELqJ,IAAAA,UAAU,EAAE,EAFP;AAGLG,IAAAA,OAAO,EAAE;AAHJ,GAAP;AAKD;AACD;AACA;AACA;AACA;;;AAGA,SAAS1H,UAAT,CAAoBjD,WAApB,EAAiCgB,WAAjC,EAA8C0B,UAA9C,EAA0DzB,MAA1D,EAAkEwB,iBAAlE,EAAqFE,gBAArF,EAAuGE,QAAvG,EAAiHC,OAAjH,EAA0HC,WAA1H,EAAuIC,KAAvI,EAA8I;AAC5I;AACA,MAAI,CAACH,QAAL,EAAe;AACb;AACA;AACA;AACA;AACD,GAP2I,CAO1I;AACF;;;AAGA,MAAI+H,UAAU,GAAG/H,QAAQ,CAACmF,SAAT,EAAjB;AACA,MAAIyB,IAAI,GAAGzJ,WAAW,CAACsC,OAAZ,EAAX;AACA,MAAIuI,SAAS,GAAGhI,QAAQ,CAACiI,QAAT,EAAhB,CAb4I,CAavG;AACrC;;AAEArB,EAAAA,IAAI,CAACsB,gBAAL,CAAsBlI,QAAQ,CAAC8G,SAA/B,EAA0C,IAA1C;;AAEA,MAAI,CAACiB,UAAD,IAAe,CAACA,UAAU,CAACI,QAA/B,EAAyC;AACvC;AACD;;AAED,MAAIC,SAAS,GAAGL,UAAU,CAACjF,KAA3B;AACA,MAAIuF,UAAU,GAAGN,UAAU,CAAC/E,MAA5B;AACA,MAAIsF,WAAW,GAAGP,UAAU,CAACO,WAA7B;AACA,MAAIC,aAAa,GAAGR,UAAU,CAAC9F,SAA/B;AACA,MAAIuG,YAAY,GAAGxI,QAAQ,CAACxB,WAAT,EAAnB;AACA,MAAIiK,WAAW,GAAGxI,OAAO,IAAIA,OAAO,CAACzB,WAAR,EAA7B;AACA,MAAIiC,gBAAgB,GAAGT,QAAQ,CAACuB,YAAhC;AACA,MAAImH,WAAW,GAAGX,UAAU,CAACW,WAA7B;AACA,MAAIC,QAAQ,GAAGlI,gBAAgB,IAAIA,gBAAgB,CAACmI,MAApD;AACA,MAAIC,oBAAoB,GAAGb,SAAS,CAACC,QAAV,CAAmB,WAAnB,CAA3B;AACA,MAAIa,sBAAsB,GAAGd,SAAS,CAACC,QAAV,CAAmB,CAAC,UAAD,EAAa,WAAb,CAAnB,CAA7B;AACA,MAAIc,kBAAkB,GAAGf,SAAS,CAACC,QAAV,CAAmB,CAAC,MAAD,EAAS,WAAT,CAAnB,CAAzB;AACA,MAAIe,oBAAoB,GAAGhB,SAAS,CAACC,QAAV,CAAmB,CAAC,QAAD,EAAW,WAAX,CAAnB,CAA3B;AACA,MAAIgB,YAAY,GAAGJ,oBAAoB,CAAC1G,GAArB,CAAyB,cAAzB,KAA4C,CAA/D,CAnC4I,CAmC1E;AAClE;AACA;;AAEA,MAAI/C,KAAK,GAAG8J,WAAW,CAAC,WAAD,EAAc1N,KAAd,CAAvB;;AAEA,MAAI,CAAC4D,KAAL,EAAY;AACV;AACD;;AAEDc,EAAAA,WAAW,CAACb,GAAZ,CAAgBD,KAAhB,EA7C4I,CA6CpH;;AAExBA,EAAAA,KAAK,CAACE,CAAN,GAAUyI,UAAU,CAACzI,CAAX,IAAgB,CAA1B;AACAF,EAAAA,KAAK,CAACG,CAAN,GAAUwI,UAAU,CAACxI,CAAX,IAAgB,CAA1B;AACAH,EAAAA,KAAK,CAAC+J,UAAN;AACA5M,EAAAA,KAAK,CAAC6C,KAAD,CAAL,CAAa2D,SAAb,GAAyBqF,SAAzB;AACA7L,EAAAA,KAAK,CAAC6C,KAAD,CAAL,CAAa6D,UAAb,GAA0BoF,UAA1B;;AAEA,MAAIN,UAAU,CAACqB,eAAf,EAAgC;AAC9B,WAAOhK,KAAP;AACD,GAvD2I,CAuD1I;;;AAGF,MAAIiK,EAAE,GAAGH,WAAW,CAAC,YAAD,EAAezN,IAAf,EAAqB0E,KAArB,EAA4BrE,IAA5B,CAApB;AACAuN,EAAAA,EAAE,IAAIC,gBAAgB,CAAClK,KAAD,EAAQiK,EAAR,EAAYV,QAAQ,IAAIZ,UAAU,CAACwB,gBAAnC,CAAtB;AACA,MAAIC,KAAK,GAAGxB,SAAS,CAAC7F,GAAV,CAAc,CAAC,UAAD,EAAa,OAAb,CAAd,CAAZ;AACA,MAAIsH,SAAS,GAAGzB,SAAS,CAAC7F,GAAV,CAAc,CAAC,UAAD,EAAa,WAAb,CAAd,CAAhB;AACA,MAAIuH,gBAAgB,GAAGF,KAAK,KAAK,UAAV,GAAuBxJ,QAAQ,CAAC2J,mBAAT,EAAvB,GAAwDH,KAAK,KAAK,YAAV,GAAyBxJ,QAAQ,CAAC4J,oBAAT,EAAzB,GAA2D,IAA1I,CA9D4I,CA8DI;;AAEhJ,MAAIjB,QAAJ,EAAc;AACZ;AACA;AACA;AACA,QAAItO,oBAAoB,CAAC+E,KAAD,CAAxB,EAAiC;AAC/B9E,MAAAA,uBAAuB,CAAC8E,KAAD,EAAQ,KAAR,CAAvB;AACD;;AAED,QAAIiK,EAAJ,EAAQ;AACN/O,MAAAA,uBAAuB,CAAC+O,EAAD,EAAK,IAAL,CAAvB,CADM,CAC6B;;AAEnCzC,MAAAA,IAAI,CAACsB,gBAAL,CAAsBlI,QAAQ,CAAC8G,SAA/B,EAA0CuC,EAA1C;AACA7O,MAAAA,gBAAgB,CAAC6O,EAAD,EAAKK,gBAAgB,IAAIF,KAAzB,EAAgCC,SAAhC,CAAhB;AACD;AACF,GAdD,MAcO;AACL,QAAI3B,OAAO,GAAGoB,WAAW,CAAC,SAAD,EAAYzN,IAAZ,EAAkB0E,KAAlB,EAAyBpE,SAAzB,CAAzB;AACA+L,IAAAA,OAAO,IAAI+B,aAAa,CAACzK,KAAD,EAAQ0I,OAAR,CAAxB;;AAEA,QAAIuB,EAAE,IAAIhP,oBAAoB,CAACgP,EAAD,CAA9B,EAAoC;AAClC/O,MAAAA,uBAAuB,CAAC+O,EAAD,EAAK,KAAL,CAAvB;AACD;;AAED/O,IAAAA,uBAAuB,CAAC8E,KAAD,EAAQ,IAAR,CAAvB,CARK,CAQiC;;AAEtCwH,IAAAA,IAAI,CAACsB,gBAAL,CAAsBlI,QAAQ,CAAC8G,SAA/B,EAA0C1H,KAA1C;AACA5E,IAAAA,gBAAgB,CAAC4E,KAAD,EAAQsK,gBAAgB,IAAIF,KAA5B,EAAmCC,SAAnC,CAAhB;AACD;;AAED,SAAOrK,KAAP,CA5F4I,CA4F9H;AACd;AACA;;AAEA,WAASkK,gBAAT,CAA0BlK,KAA1B,EAAiCiK,EAAjC,EAAqCS,aAArC,EAAoD;AAClD,QAAIC,MAAM,GAAG3P,SAAS,CAACiP,EAAD,CAAtB,CADkD,CACtB;;AAE5BU,IAAAA,MAAM,CAACjD,SAAP,GAAmB9G,QAAQ,CAAC8G,SAA5B;AACAiD,IAAAA,MAAM,CAACC,WAAP,GAAqB7M,WAAW,CAAC6M,WAAjC;AACAX,IAAAA,EAAE,CAAC3F,QAAH,CAAY;AACVpE,MAAAA,CAAC,EAAE,CADO;AAEVC,MAAAA,CAAC,EAAE,CAFO;AAGVuD,MAAAA,KAAK,EAAEsF,SAHG;AAIVpF,MAAAA,MAAM,EAAEqF,UAJE;AAKV4B,MAAAA,CAAC,EAAEhB;AALO,KAAZ;;AAQA,QAAIV,aAAJ,EAAmB;AACjB;AACA;AACA;AACA2B,MAAAA,gBAAgB,CAACb,EAAD,CAAhB;AACD,KALD,MAKO;AACLA,MAAAA,EAAE,CAACpH,SAAH,GAAe,KAAf;AACA,UAAIiB,KAAK,GAAGlD,QAAQ,CAACmK,SAAT,CAAmB,OAAnB,CAAZ;AACA,UAAIC,iBAAiB,GAAGlH,KAAK,CAAC9G,MAA9B;AACA,UAAIiO,WAAW,GAAGpO,kBAAkB,CAAC4M,oBAAD,CAApC;AACAwB,MAAAA,WAAW,CAAChO,IAAZ,GAAmB+N,iBAAnB;AACA,UAAIE,aAAa,GAAGtO,iBAAiB,CAAC8M,sBAAD,CAArC;AACAwB,MAAAA,aAAa,CAACjO,IAAd,GAAqByM,sBAAsB,CAAC3G,GAAvB,CAA2B,aAA3B,CAArB;AACA,UAAIoI,SAAS,GAAGvO,iBAAiB,CAAC+M,kBAAD,CAAjC;AACAwB,MAAAA,SAAS,CAAClO,IAAV,GAAiB0M,kBAAkB,CAAC5G,GAAnB,CAAuB,aAAvB,CAAjB;AACA,UAAIqI,WAAW,GAAGxO,iBAAiB,CAACgN,oBAAD,CAAnC;AACAwB,MAAAA,WAAW,CAACnO,IAAZ,GAAmB2M,oBAAoB,CAAC7G,GAArB,CAAyB,aAAzB,CAAnB;;AAEA,UAAI2H,aAAJ,EAAmB;AACjB,YAAIW,eAAe,GAAGrC,SAAS,GAAG,IAAIE,WAAtC;AACAoC,QAAAA,WAAW,CAACrB,EAAD,EAAKe,iBAAL,EAAwBK,eAAxB,EAAyC/B,WAAzC,EAAsDxF,KAAK,CAACC,OAA5D,EAAqE;AAC9E7D,UAAAA,CAAC,EAAEgJ,WAD2E;AAE9E/I,UAAAA,CAAC,EAAE,CAF2E;AAG9EuD,UAAAA,KAAK,EAAE2H,eAHuE;AAI9EzH,UAAAA,MAAM,EAAE0F;AAJsE,SAArE,CAAX;AAMD,OARD,CAQE;AARF,WASK;AACDW,UAAAA,EAAE,CAACsB,iBAAH;AACD;;AAEHtB,MAAAA,EAAE,CAACzF,QAAH,CAAYyG,WAAZ;AACAhB,MAAAA,EAAE,CAACuB,WAAH,CAAe,UAAf,EAA2B1H,KAA3B,GAAmCoH,aAAnC;AACAjB,MAAAA,EAAE,CAACuB,WAAH,CAAe,MAAf,EAAuB1H,KAAvB,GAA+BqH,SAA/B;AACAlB,MAAAA,EAAE,CAACuB,WAAH,CAAe,QAAf,EAAyB1H,KAAzB,GAAiCsH,WAAjC;AACAjQ,MAAAA,oBAAoB,CAAC8O,EAAD,CAApB;AACD;;AAEDjK,IAAAA,KAAK,CAACC,GAAN,CAAUgK,EAAV;AACD;;AAED,WAASQ,aAAT,CAAuBzK,KAAvB,EAA8B0I,OAA9B,EAAuC;AACrC,QAAIiC,MAAM,GAAG3P,SAAS,CAAC0N,OAAD,CAAtB,CADqC,CACJ;;AAEjCiC,IAAAA,MAAM,CAACjD,SAAP,GAAmB9G,QAAQ,CAAC8G,SAA5B;AACAiD,IAAAA,MAAM,CAACC,WAAP,GAAqB7M,WAAW,CAAC6M,WAAjC;AACA,QAAIa,YAAY,GAAG/F,IAAI,CAACgG,GAAL,CAAS1C,SAAS,GAAG,IAAIE,WAAzB,EAAsC,CAAtC,CAAnB;AACA,QAAIyC,aAAa,GAAGjG,IAAI,CAACgG,GAAL,CAASzC,UAAU,GAAG,IAAIC,WAA1B,EAAuC,CAAvC,CAApB;AACAR,IAAAA,OAAO,CAACkD,OAAR,GAAkB,IAAlB;AACAlD,IAAAA,OAAO,CAACpE,QAAR,CAAiB;AACfpE,MAAAA,CAAC,EAAEgJ,WADY;AAEf/I,MAAAA,CAAC,EAAE+I,WAFY;AAGfxF,MAAAA,KAAK,EAAE+H,YAHQ;AAIf7H,MAAAA,MAAM,EAAE+H,aAJO;AAKfd,MAAAA,CAAC,EAAEhB;AALY,KAAjB;;AAQA,QAAIV,aAAJ,EAAmB;AACjB;AACA;AACA;AACA2B,MAAAA,gBAAgB,CAACpC,OAAD,CAAhB;AACD,KALD,MAKO;AACLA,MAAAA,OAAO,CAAC7F,SAAR,GAAoB,KAApB;AACA,UAAIgJ,SAAS,GAAGjL,QAAQ,CAACmK,SAAT,CAAmB,OAAnB,CAAhB;AACA,UAAIe,WAAW,GAAGD,SAAS,CAAC5O,IAA5B;AACA,UAAIgO,WAAW,GAAGpO,kBAAkB,CAAC4M,oBAAD,CAApC;AACAwB,MAAAA,WAAW,CAAChO,IAAZ,GAAmB6O,WAAnB;AACAb,MAAAA,WAAW,CAACc,KAAZ,GAAoBF,SAAS,CAACE,KAA9B;AACA,UAAIb,aAAa,GAAGtO,iBAAiB,CAAC8M,sBAAD,CAArC;AACA,UAAIyB,SAAS,GAAGvO,iBAAiB,CAAC+M,kBAAD,CAAjC;AACA,UAAIyB,WAAW,GAAGxO,iBAAiB,CAACgN,oBAAD,CAAnC;AACA0B,MAAAA,WAAW,CAAC5C,OAAD,EAAUoD,WAAV,EAAuBL,YAAvB,EAAqCI,SAAS,CAAC9H,OAA/C,EAAwD4H,aAAxD,CAAX;AACAjD,MAAAA,OAAO,CAAClE,QAAR,CAAiByG,WAAjB;AACAvC,MAAAA,OAAO,CAAC8C,WAAR,CAAoB,UAApB,EAAgC1H,KAAhC,GAAwCoH,aAAxC;AACAxC,MAAAA,OAAO,CAAC8C,WAAR,CAAoB,MAApB,EAA4B1H,KAA5B,GAAoCqH,SAApC;AACAzC,MAAAA,OAAO,CAAC8C,WAAR,CAAoB,QAApB,EAA8B1H,KAA9B,GAAsCsH,WAAtC;AACAjQ,MAAAA,oBAAoB,CAACuN,OAAD,CAApB;AACD;;AAED1I,IAAAA,KAAK,CAACC,GAAN,CAAUyI,OAAV;AACD;;AAED,WAASoC,gBAAT,CAA0BkB,OAA1B,EAAmC;AACjC;AACA;AACA,KAACA,OAAO,CAACnJ,SAAT,IAAsBnC,gBAAgB,CAAC+B,IAAjB,CAAsBuJ,OAAtB,CAAtB;AACD;;AAED,WAASV,WAAT,CAAqBW,MAArB,EAA6BH,WAA7B,EAA0CI,aAA1C,EAAyDxI,KAAzD,EAAgEE,MAAhE,EAAwEuI,cAAxE,EAAwF;AACtF,QAAIC,gBAAgB,GAAGxD,SAAS,CAACC,QAAV,CAAmBsD,cAAc,GAAG3P,sBAAH,GAA4BD,iBAA7D,CAAvB;AACA,QAAI8P,IAAI,GAAGzR,QAAQ,CAACmD,WAAW,CAACuO,iBAAZ,CAA8B1L,QAAQ,CAAC8G,SAAvC,EAAkD,QAAlD,EAA4D,IAA5D,EAAkE,IAAlE,EAAwE0E,gBAAgB,CAACrJ,GAAjB,CAAqB,WAArB,CAAxE,CAAD,EAA6G/G,mBAAmB,CAAC4M,SAAS,CAAC7F,GAAV,CAAc,MAAd,CAAD,EAAwB,IAAxB,CAAhI,CAAnB;;AAEA,QAAI,CAACoJ,cAAD,IAAmBxD,UAAU,CAACxB,UAAlC,EAA8C;AAC5C,UAAIoF,QAAQ,GAAGxO,WAAW,CAACgF,GAAZ,CAAgB,eAAhB,EAAiC,IAAjC,CAAf;AACAsJ,MAAAA,IAAI,GAAGE,QAAQ,GAAGA,QAAQ,GAAG,GAAX,GAAiBF,IAApB,GAA2BA,IAA1C;AACD;;AAED,QAAIG,MAAM,GAAGJ,gBAAgB,CAACK,UAAjB,CAA4B,MAA5B,CAAb;AACAvQ,IAAAA,aAAa,CAAC+P,MAAD,EAAS9P,oBAAoB,CAACyM,SAAD,EAAYuD,cAAc,GAAG3P,sBAAH,GAA4BD,iBAAtD,CAA7B,EAAuG;AAClHmQ,MAAAA,WAAW,EAAEF,MAAM,GAAGH,IAAH,GAAU,IADqF;AAElHM,MAAAA,YAAY,EAAEb,WAFoG;AAGlHc,MAAAA,cAAc,EAAEV,aAHkG;AAIlHW,MAAAA,YAAY,EAAE9O,WAJoG;AAKlH+O,MAAAA,cAAc,EAAElM,QAAQ,CAAC8G;AALyF,KAAvG,CAAb;AAOA,QAAIqF,MAAM,GAAGd,MAAM,CAACe,cAAP,EAAb;AACA,QAAIC,SAAS,GAAGF,MAAM,CAACjJ,KAAvB;AACA,QAAIoJ,WAAW,GAAGrS,iBAAiB,CAACoS,SAAS,CAACE,OAAV,IAAqB,CAAtB,CAAnC;;AAEA,QAAIhB,cAAJ,EAAoB;AAClBF,MAAAA,MAAM,CAACmB,aAAP,CAAqB;AACnBC,QAAAA,UAAU,EAAElB;AADO,OAArB;AAGAY,MAAAA,MAAM,CAACO,kBAAP,GAA4B,IAA5B;AACD;;AAEDP,IAAAA,MAAM,CAACQ,YAAP,GAAsB,YAAY;AAChC,UAAI7J,KAAK,GAAGgC,IAAI,CAACgG,GAAL,CAAS,CAACS,cAAc,GAAGA,cAAc,CAACzI,KAAlB,GAA0BuI,MAAM,CAACxI,KAAP,CAAaC,KAAtD,IAA+DwJ,WAAW,CAAC,CAAD,CAA1E,GAAgFA,WAAW,CAAC,CAAD,CAApG,EAAyG,CAAzG,CAAZ;AACA,UAAItJ,MAAM,GAAG8B,IAAI,CAACgG,GAAL,CAAS,CAACS,cAAc,GAAGA,cAAc,CAACvI,MAAlB,GAA2BqI,MAAM,CAACxI,KAAP,CAAaG,MAAvD,IAAiEsJ,WAAW,CAAC,CAAD,CAA5E,GAAkFA,WAAW,CAAC,CAAD,CAAtG,EAA2G,CAA3G,CAAb;;AAEA,UAAID,SAAS,CAACvJ,KAAV,KAAoBA,KAApB,IAA6BuJ,SAAS,CAACrJ,MAAV,KAAqBA,MAAtD,EAA8D;AAC5DmJ,QAAAA,MAAM,CAACvI,QAAP,CAAgB;AACdd,UAAAA,KAAK,EAAEA,KADO;AAEdE,UAAAA,MAAM,EAAEA;AAFM,SAAhB;AAID;AACF,KAVD;;AAYAqJ,IAAAA,SAAS,CAACO,eAAV,GAA4B,CAA5B;AACAP,IAAAA,SAAS,CAACQ,YAAV,GAAyB,UAAzB;AACAC,IAAAA,gBAAgB,CAACT,SAAD,EAAYd,cAAZ,EAA4BxD,UAA5B,CAAhB;AACA,QAAIgF,iBAAiB,GAAGZ,MAAM,CAACa,QAAP,CAAgB,UAAhB,CAAxB;AACAF,IAAAA,gBAAgB,CAACC,iBAAiB,GAAGA,iBAAiB,CAAC7J,KAArB,GAA6B,IAA/C,EAAqDqI,cAArD,EAAqExD,UAArE,CAAhB;AACD;;AAED,WAAS+E,gBAAT,CAA0B5J,KAA1B,EAAiCqI,cAAjC,EAAiDxD,UAAjD,EAA6D;AAC3D,QAAI0D,IAAI,GAAGvI,KAAK,GAAGA,KAAK,CAACuI,IAAT,GAAgB,IAAhC;;AAEA,QAAI,CAACF,cAAD,IAAmBxD,UAAU,CAACxB,UAA9B,IAA4CkF,IAAI,IAAI,IAAxD,EAA8D;AAC5D,UAAIE,QAAQ,GAAGxO,WAAW,CAACgF,GAAZ,CAAgB,eAAhB,EAAiC,IAAjC,CAAf;AACAe,MAAAA,KAAK,CAACuI,IAAN,GAAaE,QAAQ,GAAGA,QAAQ,GAAG,GAAX,GAAiBF,IAApB,GAA2BA,IAAhD;AACD;AACF;;AAED,WAASvC,WAAT,CAAqBxH,WAArB,EAAkCuL,IAAlC,EAAwC9M,KAAxC,EAA+C+M,CAA/C,EAAkD;AAChD,QAAI9B,OAAO,GAAG3C,WAAW,IAAI,IAAf,IAAuB5I,UAAU,CAAC6B,WAAD,CAAV,CAAwB+G,WAAxB,CAArC;AACA,QAAI0E,KAAK,GAAGvN,iBAAiB,CAAC8B,WAAD,CAA7B;;AAEA,QAAI0J,OAAJ,EAAa;AACX;AACAvL,MAAAA,UAAU,CAAC6B,WAAD,CAAV,CAAwB+G,WAAxB,IAAuC,IAAvC;AACA2E,MAAAA,0BAA0B,CAACD,KAAD,EAAQ/B,OAAR,CAA1B;AACD,KAJD,CAIE;AAJF,SAKK,IAAI,CAAC7C,aAAL,EAAoB;AACrB6C,QAAAA,OAAO,GAAG,IAAI6B,IAAJ,EAAV;;AAEA,YAAI7B,OAAO,YAAYlQ,WAAvB,EAAoC;AAClCkQ,UAAAA,OAAO,CAAC8B,CAAR,GAAYG,UAAU,CAAClN,KAAD,EAAQ+M,CAAR,CAAtB;AACD;;AAEDI,QAAAA,yBAAyB,CAACH,KAAD,EAAQ/B,OAAR,CAAzB;AACD,OAjB6C,CAiB5C;;;AAGJ,WAAOjN,WAAW,CAACuD,WAAD,CAAX,CAAyB8G,YAAzB,IAAyC4C,OAAhD;AACD;;AAED,WAASgC,0BAAT,CAAoCD,KAApC,EAA2C/B,OAA3C,EAAoD;AAClD,QAAImC,OAAO,GAAGJ,KAAK,CAAC3E,YAAD,CAAL,GAAsB,EAApC;;AAEA,QAAI4C,OAAO,YAAY5P,KAAvB,EAA8B;AAC5B+R,MAAAA,OAAO,CAAChK,IAAR,GAAe6H,OAAO,CAAC9L,CAAvB;AACAiO,MAAAA,OAAO,CAAC/J,IAAR,GAAe4H,OAAO,CAAC7L,CAAvB;AACD,KAHD,MAGO;AACLgO,MAAAA,OAAO,CAAC9J,QAAR,GAAmB1J,MAAM,CAAC,EAAD,EAAKqR,OAAO,CAACvI,KAAb,CAAzB;AACD;AACF,GA9R2I,CA8R1I;AACF;;;AAGA,WAASyK,yBAAT,CAAmCH,KAAnC,EAA0C/B,OAA1C,EAAmD;AACjD,QAAImC,OAAO,GAAGJ,KAAK,CAAC3E,YAAD,CAAL,GAAsB,EAApC;AACA,QAAIgF,UAAU,GAAGxN,QAAQ,CAACwN,UAA1B;AACA,QAAIC,OAAO,GAAGrC,OAAO,YAAYjR,OAAO,CAACqB,KAAzC;;AAEA,QAAIgS,UAAU,KAAK,CAACpP,MAAD,IAAWA,MAAM,CAACK,SAAP,KAAqB,WAArC,CAAd,EAAiE;AAC/D,UAAIiP,UAAU,GAAG,CAAjB;AACA,UAAIC,UAAU,GAAG,CAAjB,CAF+D,CAE3C;AACpB;;AAEA,UAAIC,WAAW,GAAGhO,iBAAiB,CAAC+H,UAAlB,CAA6B6F,UAAU,CAAChP,WAAX,EAA7B,CAAlB;;AAEA,UAAI,CAACJ,MAAD,IAAWwP,WAAX,IAA0BA,WAAW,CAACnK,QAA1C,EAAoD;AAClDiK,QAAAA,UAAU,GAAGE,WAAW,CAACnK,QAAZ,CAAqBX,KAAlC;AACA6K,QAAAA,UAAU,GAAGC,WAAW,CAACnK,QAAZ,CAAqBT,MAAlC;AACD,OAV8D,CAU7D;AACF;;;AAGA,UAAIyK,OAAJ,EAAa;AACXF,QAAAA,OAAO,CAAChK,IAAR,GAAe,CAAf;AACAgK,QAAAA,OAAO,CAAC/J,IAAR,GAAemK,UAAf;AACD,OAHD,MAGO;AACLJ,QAAAA,OAAO,CAAC9J,QAAR,GAAmB;AACjBnE,UAAAA,CAAC,EAAEoO,UADc;AAEjBnO,UAAAA,CAAC,EAAEoO,UAFc;AAGjB7K,UAAAA,KAAK,EAAE,CAHU;AAIjBE,UAAAA,MAAM,EAAE;AAJS,SAAnB;AAMD;AACF,KA9BgD,CA8B/C;;;AAGFuK,IAAAA,OAAO,CAAC5J,MAAR,GAAiB,CAAC8J,OAAlB;AACD;AACF,C,CAAC;AACF;AACA;AACA;AACA;AACA;;;AAGA,SAASJ,UAAT,CAAoBlN,KAApB,EAA2B0N,QAA3B,EAAqC;AACnC,MAAIC,EAAE,GAAG3N,KAAK,GAAGtE,MAAR,GAAiBgS,QAA1B;AACA,SAAO,CAACC,EAAE,GAAG,CAAN,IAAWA,EAAlB;AACD;;AAED,eAAetR,WAAf","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { __extends } from \"tslib\";\nimport { bind, each, indexOf, curry, extend, retrieve, normalizeCssArray, isFunction } from 'zrender/lib/core/util';\nimport * as graphic from '../../util/graphic';\nimport { getECData } from '../../util/innerStore';\nimport { isHighDownDispatcher, setAsHighDownDispatcher, setDefaultStateProxy, enableHoverFocus } from '../../util/states';\nimport DataDiffer from '../../data/DataDiffer';\nimport * as helper from '../helper/treeHelper';\nimport Breadcrumb from './Breadcrumb';\nimport RoamController from '../../component/helper/RoamController';\nimport BoundingRect from 'zrender/lib/core/BoundingRect';\nimport * as matrix from 'zrender/lib/core/matrix';\nimport * as animationUtil from '../../util/animation';\nimport makeStyleMapper from '../../model/mixin/makeStyleMapper';\nimport ChartView from '../../view/Chart';\nimport Displayable from 'zrender/lib/graphic/Displayable';\nimport { makeInner, convertOptionIdName } from '../../util/model';\nimport { windowOpen } from '../../util/format';\nimport { setLabelStyle, getLabelStatesModels } from '../../label/labelStyle';\nvar Group = graphic.Group;\nvar Rect = graphic.Rect;\nvar DRAG_THRESHOLD = 3;\nvar PATH_LABEL_NOAMAL = 'label';\nvar PATH_UPPERLABEL_NORMAL = 'upperLabel';\nvar Z_BASE = 10; // Should bigger than every z.\n\nvar Z_BG = 1;\nvar Z_CONTENT = 2;\nvar getStateItemStyle = makeStyleMapper([['fill', 'color'], // `borderColor` and `borderWidth` has been occupied,\n// so use `stroke` to indicate the stroke of the rect.\n['stroke', 'strokeColor'], ['lineWidth', 'strokeWidth'], ['shadowBlur'], ['shadowOffsetX'], ['shadowOffsetY'], ['shadowColor'] // Option decal is in `DecalObject` but style.decal is in `PatternObject`.\n// So do not transfer decal directly.\n]);\n\nvar getItemStyleNormal = function (model) {\n  // Normal style props should include emphasis style props.\n  var itemStyle = getStateItemStyle(model); // Clear styles set by emphasis.\n\n  itemStyle.stroke = itemStyle.fill = itemStyle.lineWidth = null;\n  return itemStyle;\n};\n\nvar inner = makeInner();\n\nvar TreemapView =\n/** @class */\nfunction (_super) {\n  __extends(TreemapView, _super);\n\n  function TreemapView() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = TreemapView.type;\n    _this._state = 'ready';\n    _this._storage = createStorage();\n    return _this;\n  }\n  /**\n   * @override\n   */\n\n\n  TreemapView.prototype.render = function (seriesModel, ecModel, api, payload) {\n    var models = ecModel.findComponents({\n      mainType: 'series',\n      subType: 'treemap',\n      query: payload\n    });\n\n    if (indexOf(models, seriesModel) < 0) {\n      return;\n    }\n\n    this.seriesModel = seriesModel;\n    this.api = api;\n    this.ecModel = ecModel;\n    var types = ['treemapZoomToNode', 'treemapRootToNode'];\n    var targetInfo = helper.retrieveTargetInfo(payload, types, seriesModel);\n    var payloadType = payload && payload.type;\n    var layoutInfo = seriesModel.layoutInfo;\n    var isInit = !this._oldTree;\n    var thisStorage = this._storage; // Mark new root when action is treemapRootToNode.\n\n    var reRoot = payloadType === 'treemapRootToNode' && targetInfo && thisStorage ? {\n      rootNodeGroup: thisStorage.nodeGroup[targetInfo.node.getRawIndex()],\n      direction: payload.direction\n    } : null;\n\n    var containerGroup = this._giveContainerGroup(layoutInfo);\n\n    var renderResult = this._doRender(containerGroup, seriesModel, reRoot);\n\n    !isInit && (!payloadType || payloadType === 'treemapZoomToNode' || payloadType === 'treemapRootToNode') ? this._doAnimation(containerGroup, renderResult, seriesModel, reRoot) : renderResult.renderFinally();\n\n    this._resetController(api);\n\n    this._renderBreadcrumb(seriesModel, api, targetInfo);\n  };\n\n  TreemapView.prototype._giveContainerGroup = function (layoutInfo) {\n    var containerGroup = this._containerGroup;\n\n    if (!containerGroup) {\n      // FIXME\n      // 加一层containerGroup是为了clip，但是现在clip功能并没有实现。\n      containerGroup = this._containerGroup = new Group();\n\n      this._initEvents(containerGroup);\n\n      this.group.add(containerGroup);\n    }\n\n    containerGroup.x = layoutInfo.x;\n    containerGroup.y = layoutInfo.y;\n    return containerGroup;\n  };\n\n  TreemapView.prototype._doRender = function (containerGroup, seriesModel, reRoot) {\n    var thisTree = seriesModel.getData().tree;\n    var oldTree = this._oldTree; // Clear last shape records.\n\n    var lastsForAnimation = createStorage();\n    var thisStorage = createStorage();\n    var oldStorage = this._storage;\n    var willInvisibleEls = [];\n\n    function doRenderNode(thisNode, oldNode, parentGroup, depth) {\n      return renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth);\n    } // Notice: when thisTree and oldTree are the same tree (see list.cloneShallow),\n    // the oldTree is actually losted, so we can not find all of the old graphic\n    // elements from tree. So we use this stragegy: make element storage, move\n    // from old storage to new storage, clear old storage.\n\n\n    dualTravel(thisTree.root ? [thisTree.root] : [], oldTree && oldTree.root ? [oldTree.root] : [], containerGroup, thisTree === oldTree || !oldTree, 0); // Process all removing.\n\n    var willDeleteEls = clearStorage(oldStorage);\n    this._oldTree = thisTree;\n    this._storage = thisStorage;\n    return {\n      lastsForAnimation: lastsForAnimation,\n      willDeleteEls: willDeleteEls,\n      renderFinally: renderFinally\n    };\n\n    function dualTravel(thisViewChildren, oldViewChildren, parentGroup, sameTree, depth) {\n      // When 'render' is triggered by action,\n      // 'this' and 'old' may be the same tree,\n      // we use rawIndex in that case.\n      if (sameTree) {\n        oldViewChildren = thisViewChildren;\n        each(thisViewChildren, function (child, index) {\n          !child.isRemoved() && processNode(index, index);\n        });\n      } // Diff hierarchically (diff only in each subtree, but not whole).\n      // because, consistency of view is important.\n      else {\n          new DataDiffer(oldViewChildren, thisViewChildren, getKey, getKey).add(processNode).update(processNode).remove(curry(processNode, null)).execute();\n        }\n\n      function getKey(node) {\n        // Identify by name or raw index.\n        return node.getId();\n      }\n\n      function processNode(newIndex, oldIndex) {\n        var thisNode = newIndex != null ? thisViewChildren[newIndex] : null;\n        var oldNode = oldIndex != null ? oldViewChildren[oldIndex] : null;\n        var group = doRenderNode(thisNode, oldNode, parentGroup, depth);\n        group && dualTravel(thisNode && thisNode.viewChildren || [], oldNode && oldNode.viewChildren || [], group, sameTree, depth + 1);\n      }\n    }\n\n    function clearStorage(storage) {\n      var willDeleteEls = createStorage();\n      storage && each(storage, function (store, storageName) {\n        var delEls = willDeleteEls[storageName];\n        each(store, function (el) {\n          el && (delEls.push(el), inner(el).willDelete = true);\n        });\n      });\n      return willDeleteEls;\n    }\n\n    function renderFinally() {\n      each(willDeleteEls, function (els) {\n        each(els, function (el) {\n          el.parent && el.parent.remove(el);\n        });\n      });\n      each(willInvisibleEls, function (el) {\n        el.invisible = true; // Setting invisible is for optimizing, so no need to set dirty,\n        // just mark as invisible.\n\n        el.dirty();\n      });\n    }\n  };\n\n  TreemapView.prototype._doAnimation = function (containerGroup, renderResult, seriesModel, reRoot) {\n    if (!seriesModel.get('animation')) {\n      return;\n    }\n\n    var durationOption = seriesModel.get('animationDurationUpdate');\n    var easingOption = seriesModel.get('animationEasing'); // TODO: do not support function until necessary.\n\n    var duration = (isFunction(durationOption) ? 0 : durationOption) || 0;\n    var easing = (isFunction(easingOption) ? null : easingOption) || 'cubicOut';\n    var animationWrap = animationUtil.createWrap(); // Make delete animations.\n\n    each(renderResult.willDeleteEls, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        if (el.invisible) {\n          return;\n        }\n\n        var parent = el.parent; // Always has parent, and parent is nodeGroup.\n\n        var target;\n        var innerStore = inner(parent);\n\n        if (reRoot && reRoot.direction === 'drillDown') {\n          target = parent === reRoot.rootNodeGroup // This is the content element of view root.\n          // Only `content` will enter this branch, because\n          // `background` and `nodeGroup` will not be deleted.\n          ? {\n            shape: {\n              x: 0,\n              y: 0,\n              width: innerStore.nodeWidth,\n              height: innerStore.nodeHeight\n            },\n            style: {\n              opacity: 0\n            }\n          } // Others.\n          : {\n            style: {\n              opacity: 0\n            }\n          };\n        } else {\n          var targetX = 0;\n          var targetY = 0;\n\n          if (!innerStore.willDelete) {\n            // Let node animate to right-bottom corner, cooperating with fadeout,\n            // which is appropriate for user understanding.\n            // Divided by 2 for reRoot rolling up effect.\n            targetX = innerStore.nodeWidth / 2;\n            targetY = innerStore.nodeHeight / 2;\n          }\n\n          target = storageName === 'nodeGroup' ? {\n            x: targetX,\n            y: targetY,\n            style: {\n              opacity: 0\n            }\n          } : {\n            shape: {\n              x: targetX,\n              y: targetY,\n              width: 0,\n              height: 0\n            },\n            style: {\n              opacity: 0\n            }\n          };\n        } // TODO: do not support delay until necessary.\n\n\n        target && animationWrap.add(el, target, duration, 0, easing);\n      });\n    }); // Make other animations\n\n    each(this._storage, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        var last = renderResult.lastsForAnimation[storageName][rawIndex];\n        var target = {};\n\n        if (!last) {\n          return;\n        }\n\n        if (el instanceof graphic.Group) {\n          if (last.oldX != null) {\n            target.x = el.x;\n            target.y = el.y;\n            el.x = last.oldX;\n            el.y = last.oldY;\n          }\n        } else {\n          if (last.oldShape) {\n            target.shape = extend({}, el.shape);\n            el.setShape(last.oldShape);\n          }\n\n          if (last.fadein) {\n            el.setStyle('opacity', 0);\n            target.style = {\n              opacity: 1\n            };\n          } // When animation is stopped for succedent animation starting,\n          // el.style.opacity might not be 1\n          else if (el.style.opacity !== 1) {\n              target.style = {\n                opacity: 1\n              };\n            }\n        }\n\n        animationWrap.add(el, target, duration, 0, easing);\n      });\n    }, this);\n    this._state = 'animating';\n    animationWrap.finished(bind(function () {\n      this._state = 'ready';\n      renderResult.renderFinally();\n    }, this)).start();\n  };\n\n  TreemapView.prototype._resetController = function (api) {\n    var controller = this._controller; // Init controller.\n\n    if (!controller) {\n      controller = this._controller = new RoamController(api.getZr());\n      controller.enable(this.seriesModel.get('roam'));\n      controller.on('pan', bind(this._onPan, this));\n      controller.on('zoom', bind(this._onZoom, this));\n    }\n\n    var rect = new BoundingRect(0, 0, api.getWidth(), api.getHeight());\n    controller.setPointerChecker(function (e, x, y) {\n      return rect.contain(x, y);\n    });\n  };\n\n  TreemapView.prototype._clearController = function () {\n    var controller = this._controller;\n\n    if (controller) {\n      controller.dispose();\n      controller = null;\n    }\n  };\n\n  TreemapView.prototype._onPan = function (e) {\n    if (this._state !== 'animating' && (Math.abs(e.dx) > DRAG_THRESHOLD || Math.abs(e.dy) > DRAG_THRESHOLD)) {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      this.api.dispatchAction({\n        type: 'treemapMove',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rootLayout.x + e.dx,\n          y: rootLayout.y + e.dy,\n          width: rootLayout.width,\n          height: rootLayout.height\n        }\n      });\n    }\n  };\n\n  TreemapView.prototype._onZoom = function (e) {\n    var mouseX = e.originX;\n    var mouseY = e.originY;\n\n    if (this._state !== 'animating') {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      var rect = new BoundingRect(rootLayout.x, rootLayout.y, rootLayout.width, rootLayout.height);\n      var layoutInfo = this.seriesModel.layoutInfo; // Transform mouse coord from global to containerGroup.\n\n      mouseX -= layoutInfo.x;\n      mouseY -= layoutInfo.y; // Scale root bounding rect.\n\n      var m = matrix.create();\n      matrix.translate(m, m, [-mouseX, -mouseY]);\n      matrix.scale(m, m, [e.scale, e.scale]);\n      matrix.translate(m, m, [mouseX, mouseY]);\n      rect.applyTransform(m);\n      this.api.dispatchAction({\n        type: 'treemapRender',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rect.x,\n          y: rect.y,\n          width: rect.width,\n          height: rect.height\n        }\n      });\n    }\n  };\n\n  TreemapView.prototype._initEvents = function (containerGroup) {\n    var _this = this;\n\n    containerGroup.on('click', function (e) {\n      if (_this._state !== 'ready') {\n        return;\n      }\n\n      var nodeClick = _this.seriesModel.get('nodeClick', true);\n\n      if (!nodeClick) {\n        return;\n      }\n\n      var targetInfo = _this.findTarget(e.offsetX, e.offsetY);\n\n      if (!targetInfo) {\n        return;\n      }\n\n      var node = targetInfo.node;\n\n      if (node.getLayout().isLeafRoot) {\n        _this._rootToNode(targetInfo);\n      } else {\n        if (nodeClick === 'zoomToNode') {\n          _this._zoomToNode(targetInfo);\n        } else if (nodeClick === 'link') {\n          var itemModel = node.hostTree.data.getItemModel(node.dataIndex);\n          var link = itemModel.get('link', true);\n          var linkTarget = itemModel.get('target', true) || 'blank';\n          link && windowOpen(link, linkTarget);\n        }\n      }\n    }, this);\n  };\n\n  TreemapView.prototype._renderBreadcrumb = function (seriesModel, api, targetInfo) {\n    var _this = this;\n\n    if (!targetInfo) {\n      targetInfo = seriesModel.get('leafDepth', true) != null ? {\n        node: seriesModel.getViewRoot()\n      } // FIXME\n      // better way?\n      // Find breadcrumb tail on center of containerGroup.\n      : this.findTarget(api.getWidth() / 2, api.getHeight() / 2);\n\n      if (!targetInfo) {\n        targetInfo = {\n          node: seriesModel.getData().tree.root\n        };\n      }\n    }\n\n    (this._breadcrumb || (this._breadcrumb = new Breadcrumb(this.group))).render(seriesModel, api, targetInfo.node, function (node) {\n      if (_this._state !== 'animating') {\n        helper.aboveViewRoot(seriesModel.getViewRoot(), node) ? _this._rootToNode({\n          node: node\n        }) : _this._zoomToNode({\n          node: node\n        });\n      }\n    });\n  };\n  /**\n   * @override\n   */\n\n\n  TreemapView.prototype.remove = function () {\n    this._clearController();\n\n    this._containerGroup && this._containerGroup.removeAll();\n    this._storage = createStorage();\n    this._state = 'ready';\n    this._breadcrumb && this._breadcrumb.remove();\n  };\n\n  TreemapView.prototype.dispose = function () {\n    this._clearController();\n  };\n\n  TreemapView.prototype._zoomToNode = function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapZoomToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  };\n\n  TreemapView.prototype._rootToNode = function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapRootToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  };\n  /**\n   * @public\n   * @param {number} x Global coord x.\n   * @param {number} y Global coord y.\n   * @return {Object} info If not found, return undefined;\n   * @return {number} info.node Target node.\n   * @return {number} info.offsetX x refer to target node.\n   * @return {number} info.offsetY y refer to target node.\n   */\n\n\n  TreemapView.prototype.findTarget = function (x, y) {\n    var targetInfo;\n    var viewRoot = this.seriesModel.getViewRoot();\n    viewRoot.eachNode({\n      attr: 'viewChildren',\n      order: 'preorder'\n    }, function (node) {\n      var bgEl = this._storage.background[node.getRawIndex()]; // If invisible, there might be no element.\n\n\n      if (bgEl) {\n        var point = bgEl.transformCoordToLocal(x, y);\n        var shape = bgEl.shape; // For performance consideration, dont use 'getBoundingRect'.\n\n        if (shape.x <= point[0] && point[0] <= shape.x + shape.width && shape.y <= point[1] && point[1] <= shape.y + shape.height) {\n          targetInfo = {\n            node: node,\n            offsetX: point[0],\n            offsetY: point[1]\n          };\n        } else {\n          return false; // Suppress visit subtree.\n        }\n      }\n    }, this);\n    return targetInfo;\n  };\n\n  TreemapView.type = 'treemap';\n  return TreemapView;\n}(ChartView);\n/**\n * @inner\n */\n\n\nfunction createStorage() {\n  return {\n    nodeGroup: [],\n    background: [],\n    content: []\n  };\n}\n/**\n * @inner\n * @return Return undefined means do not travel further.\n */\n\n\nfunction renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth) {\n  // Whether under viewRoot.\n  if (!thisNode) {\n    // Deleting nodes will be performed finally. This method just find\n    // element from old storage, or create new element, set them to new\n    // storage, and set styles.\n    return;\n  } // -------------------------------------------------------------------\n  // Start of closure variables available in \"Procedures in renderNode\".\n\n\n  var thisLayout = thisNode.getLayout();\n  var data = seriesModel.getData();\n  var nodeModel = thisNode.getModel(); // Only for enabling highlight/downplay. Clear firstly.\n  // Because some node will not be rendered.\n\n  data.setItemGraphicEl(thisNode.dataIndex, null);\n\n  if (!thisLayout || !thisLayout.isInView) {\n    return;\n  }\n\n  var thisWidth = thisLayout.width;\n  var thisHeight = thisLayout.height;\n  var borderWidth = thisLayout.borderWidth;\n  var thisInvisible = thisLayout.invisible;\n  var thisRawIndex = thisNode.getRawIndex();\n  var oldRawIndex = oldNode && oldNode.getRawIndex();\n  var thisViewChildren = thisNode.viewChildren;\n  var upperHeight = thisLayout.upperHeight;\n  var isParent = thisViewChildren && thisViewChildren.length;\n  var itemStyleNormalModel = nodeModel.getModel('itemStyle');\n  var itemStyleEmphasisModel = nodeModel.getModel(['emphasis', 'itemStyle']);\n  var itemStyleBlurModel = nodeModel.getModel(['blur', 'itemStyle']);\n  var itemStyleSelectModel = nodeModel.getModel(['select', 'itemStyle']);\n  var borderRadius = itemStyleNormalModel.get('borderRadius') || 0; // End of closure ariables available in \"Procedures in renderNode\".\n  // -----------------------------------------------------------------\n  // Node group\n\n  var group = giveGraphic('nodeGroup', Group);\n\n  if (!group) {\n    return;\n  }\n\n  parentGroup.add(group); // x,y are not set when el is above view root.\n\n  group.x = thisLayout.x || 0;\n  group.y = thisLayout.y || 0;\n  group.markRedraw();\n  inner(group).nodeWidth = thisWidth;\n  inner(group).nodeHeight = thisHeight;\n\n  if (thisLayout.isAboveViewRoot) {\n    return group;\n  } // Background\n\n\n  var bg = giveGraphic('background', Rect, depth, Z_BG);\n  bg && renderBackground(group, bg, isParent && thisLayout.upperLabelHeight);\n  var focus = nodeModel.get(['emphasis', 'focus']);\n  var blurScope = nodeModel.get(['emphasis', 'blurScope']);\n  var focusDataIndices = focus === 'ancestor' ? thisNode.getAncestorsIndices() : focus === 'descendant' ? thisNode.getDescendantIndices() : null; // No children, render content.\n\n  if (isParent) {\n    // Because of the implementation about \"traverse\" in graphic hover style, we\n    // can not set hover listener on the \"group\" of non-leaf node. Otherwise the\n    // hover event from the descendents will be listenered.\n    if (isHighDownDispatcher(group)) {\n      setAsHighDownDispatcher(group, false);\n    }\n\n    if (bg) {\n      setAsHighDownDispatcher(bg, true); // Only for enabling highlight/downplay.\n\n      data.setItemGraphicEl(thisNode.dataIndex, bg);\n      enableHoverFocus(bg, focusDataIndices || focus, blurScope);\n    }\n  } else {\n    var content = giveGraphic('content', Rect, depth, Z_CONTENT);\n    content && renderContent(group, content);\n\n    if (bg && isHighDownDispatcher(bg)) {\n      setAsHighDownDispatcher(bg, false);\n    }\n\n    setAsHighDownDispatcher(group, true); // Only for enabling highlight/downplay.\n\n    data.setItemGraphicEl(thisNode.dataIndex, group);\n    enableHoverFocus(group, focusDataIndices || focus, blurScope);\n  }\n\n  return group; // ----------------------------\n  // | Procedures in renderNode |\n  // ----------------------------\n\n  function renderBackground(group, bg, useUpperLabel) {\n    var ecData = getECData(bg); // For tooltip.\n\n    ecData.dataIndex = thisNode.dataIndex;\n    ecData.seriesIndex = seriesModel.seriesIndex;\n    bg.setShape({\n      x: 0,\n      y: 0,\n      width: thisWidth,\n      height: thisHeight,\n      r: borderRadius\n    });\n\n    if (thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      processInvisible(bg);\n    } else {\n      bg.invisible = false;\n      var style = thisNode.getVisual('style');\n      var visualBorderColor = style.stroke;\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualBorderColor;\n      var emphasisStyle = getStateItemStyle(itemStyleEmphasisModel);\n      emphasisStyle.fill = itemStyleEmphasisModel.get('borderColor');\n      var blurStyle = getStateItemStyle(itemStyleBlurModel);\n      blurStyle.fill = itemStyleBlurModel.get('borderColor');\n      var selectStyle = getStateItemStyle(itemStyleSelectModel);\n      selectStyle.fill = itemStyleSelectModel.get('borderColor');\n\n      if (useUpperLabel) {\n        var upperLabelWidth = thisWidth - 2 * borderWidth;\n        prepareText(bg, visualBorderColor, upperLabelWidth, upperHeight, style.opacity, {\n          x: borderWidth,\n          y: 0,\n          width: upperLabelWidth,\n          height: upperHeight\n        });\n      } // For old bg.\n      else {\n          bg.removeTextContent();\n        }\n\n      bg.setStyle(normalStyle);\n      bg.ensureState('emphasis').style = emphasisStyle;\n      bg.ensureState('blur').style = blurStyle;\n      bg.ensureState('select').style = selectStyle;\n      setDefaultStateProxy(bg);\n    }\n\n    group.add(bg);\n  }\n\n  function renderContent(group, content) {\n    var ecData = getECData(content); // For tooltip.\n\n    ecData.dataIndex = thisNode.dataIndex;\n    ecData.seriesIndex = seriesModel.seriesIndex;\n    var contentWidth = Math.max(thisWidth - 2 * borderWidth, 0);\n    var contentHeight = Math.max(thisHeight - 2 * borderWidth, 0);\n    content.culling = true;\n    content.setShape({\n      x: borderWidth,\n      y: borderWidth,\n      width: contentWidth,\n      height: contentHeight,\n      r: borderRadius\n    });\n\n    if (thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      processInvisible(content);\n    } else {\n      content.invisible = false;\n      var nodeStyle = thisNode.getVisual('style');\n      var visualColor = nodeStyle.fill;\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualColor;\n      normalStyle.decal = nodeStyle.decal;\n      var emphasisStyle = getStateItemStyle(itemStyleEmphasisModel);\n      var blurStyle = getStateItemStyle(itemStyleBlurModel);\n      var selectStyle = getStateItemStyle(itemStyleSelectModel);\n      prepareText(content, visualColor, contentWidth, nodeStyle.opacity, contentHeight);\n      content.setStyle(normalStyle);\n      content.ensureState('emphasis').style = emphasisStyle;\n      content.ensureState('blur').style = blurStyle;\n      content.ensureState('select').style = selectStyle;\n      setDefaultStateProxy(content);\n    }\n\n    group.add(content);\n  }\n\n  function processInvisible(element) {\n    // Delay invisible setting utill animation finished,\n    // avoid element vanish suddenly before animation.\n    !element.invisible && willInvisibleEls.push(element);\n  }\n\n  function prepareText(rectEl, visualColor, visualOpacity, width, height, upperLabelRect) {\n    var normalLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL);\n    var text = retrieve(seriesModel.getFormattedLabel(thisNode.dataIndex, 'normal', null, null, normalLabelModel.get('formatter')), convertOptionIdName(nodeModel.get('name'), null));\n\n    if (!upperLabelRect && thisLayout.isLeafRoot) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      text = iconChar ? iconChar + ' ' + text : text;\n    }\n\n    var isShow = normalLabelModel.getShallow('show');\n    setLabelStyle(rectEl, getLabelStatesModels(nodeModel, upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL), {\n      defaultText: isShow ? text : null,\n      inheritColor: visualColor,\n      defaultOpacity: visualOpacity,\n      labelFetcher: seriesModel,\n      labelDataIndex: thisNode.dataIndex\n    });\n    var textEl = rectEl.getTextContent();\n    var textStyle = textEl.style;\n    var textPadding = normalizeCssArray(textStyle.padding || 0);\n\n    if (upperLabelRect) {\n      rectEl.setTextConfig({\n        layoutRect: upperLabelRect\n      });\n      textEl.disableLabelLayout = true;\n    }\n\n    textEl.beforeUpdate = function () {\n      var width = Math.max((upperLabelRect ? upperLabelRect.width : rectEl.shape.width) - textPadding[1] - textPadding[3], 0);\n      var height = Math.max((upperLabelRect ? upperLabelRect.height : rectEl.shape.height) - textPadding[0] - textPadding[2], 0);\n\n      if (textStyle.width !== width || textStyle.height !== height) {\n        textEl.setStyle({\n          width: width,\n          height: height\n        });\n      }\n    };\n\n    textStyle.truncateMinChar = 2;\n    textStyle.lineOverflow = 'truncate';\n    addDrillDownIcon(textStyle, upperLabelRect, thisLayout);\n    var textEmphasisState = textEl.getState('emphasis');\n    addDrillDownIcon(textEmphasisState ? textEmphasisState.style : null, upperLabelRect, thisLayout);\n  }\n\n  function addDrillDownIcon(style, upperLabelRect, thisLayout) {\n    var text = style ? style.text : null;\n\n    if (!upperLabelRect && thisLayout.isLeafRoot && text != null) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      style.text = iconChar ? iconChar + ' ' + text : text;\n    }\n  }\n\n  function giveGraphic(storageName, Ctor, depth, z) {\n    var element = oldRawIndex != null && oldStorage[storageName][oldRawIndex];\n    var lasts = lastsForAnimation[storageName];\n\n    if (element) {\n      // Remove from oldStorage\n      oldStorage[storageName][oldRawIndex] = null;\n      prepareAnimationWhenHasOld(lasts, element);\n    } // If invisible and no old element, do not create new element (for optimizing).\n    else if (!thisInvisible) {\n        element = new Ctor();\n\n        if (element instanceof Displayable) {\n          element.z = calculateZ(depth, z);\n        }\n\n        prepareAnimationWhenNoOld(lasts, element);\n      } // Set to thisStorage\n\n\n    return thisStorage[storageName][thisRawIndex] = element;\n  }\n\n  function prepareAnimationWhenHasOld(lasts, element) {\n    var lastCfg = lasts[thisRawIndex] = {};\n\n    if (element instanceof Group) {\n      lastCfg.oldX = element.x;\n      lastCfg.oldY = element.y;\n    } else {\n      lastCfg.oldShape = extend({}, element.shape);\n    }\n  } // If a element is new, we need to find the animation start point carefully,\n  // otherwise it will looks strange when 'zoomToNode'.\n\n\n  function prepareAnimationWhenNoOld(lasts, element) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    var parentNode = thisNode.parentNode;\n    var isGroup = element instanceof graphic.Group;\n\n    if (parentNode && (!reRoot || reRoot.direction === 'drillDown')) {\n      var parentOldX = 0;\n      var parentOldY = 0; // New nodes appear from right-bottom corner in 'zoomToNode' animation.\n      // For convenience, get old bounding rect from background.\n\n      var parentOldBg = lastsForAnimation.background[parentNode.getRawIndex()];\n\n      if (!reRoot && parentOldBg && parentOldBg.oldShape) {\n        parentOldX = parentOldBg.oldShape.width;\n        parentOldY = parentOldBg.oldShape.height;\n      } // When no parent old shape found, its parent is new too,\n      // so we can just use {x:0, y:0}.\n\n\n      if (isGroup) {\n        lastCfg.oldX = 0;\n        lastCfg.oldY = parentOldY;\n      } else {\n        lastCfg.oldShape = {\n          x: parentOldX,\n          y: parentOldY,\n          width: 0,\n          height: 0\n        };\n      }\n    } // Fade in, user can be aware that these nodes are new.\n\n\n    lastCfg.fadein = !isGroup;\n  }\n} // We can not set all backgroud with the same z, Because the behaviour of\n// drill down and roll up differ background creation sequence from tree\n// hierarchy sequence, which cause that lowser background element overlap\n// upper ones. So we calculate z based on depth.\n// Moreover, we try to shrink down z interval to [0, 1] to avoid that\n// treemap with large z overlaps other components.\n\n\nfunction calculateZ(depth, zInLevel) {\n  var zb = depth * Z_BASE + zInLevel;\n  return (zb - 1) / zb;\n}\n\nexport default TreemapView;"]},"metadata":{},"sourceType":"module"}