{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nvar _jsxFileName = \"/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Buy/index.jsx\";\nimport React, { Component } from \"react\";\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\"; //接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\n\nimport openNotification from \"../../Notification\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = _Select;\n\nclass Buy extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false\n    };\n\n    this.showDrawer = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.onClose = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.onFinishBuy = values => {\n      console.log(\"购买按钮被点击，onFinishBid 得到的数据为 : \");\n      console.dir(values); //values 中的数据示意\n      // buyNum: 2\n\n      if (this.props.dataArray.length === 0) {\n        _message.error(\"找不到被购买的商品\");\n\n        return;\n      } //计算需要支付的金额\n\n\n      let price = this.props.dataArray[0].originPrice; //单位是wei\n\n      let priceSum = price * values.buyNum;\n      let blockChainID = this.props.dataArray[0].ID;\n      console.log(\"购买商品ID : \" + blockChainID);\n      let web3 = this.props.web3; //购买信息上链\n      //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n      //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n\n      let that = this;\n      this.props.truffleContract.deployed().then(async i => {\n        console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\"); //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n        //即时获取当前地址，用该地址发交易\n\n        let currentAccount = await web3.eth.getAccounts();\n\n        _message.info(\"交易发起地址为: \" + currentAccount, 2);\n\n        console.log(\"交易发起地址为: \" + currentAccount);\n\n        try {\n          //调用合约的 buy 方法\n          await i.order(parseInt(blockChainID), values.buyNum, {\n            from: currentAccount.toString(),\n            value: priceSum\n          }).then(res => {\n            //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n            _message.success(\"购买提交成功\");\n\n            console.log(\"成功调用合约的buy方法，返回 : \");\n            console.dir(res); //关闭侧边栏\n\n            this.onClose();\n            openNotification(\"购买信息提交成功\", \"购买个数: \" + values.buyNum, 'bottomLeft');\n          });\n        } catch (err) {\n          _message.error(\"向链上提交购买信息失败\", 2);\n\n          console.log(\"调用合约的buy方法失败, err = \");\n          console.dir(err);\n          return;\n        }\n      });\n    };\n\n    this.onFinishFailedBuy = errorInfo => {\n      _message.warning(\"请正确填写购买信息\", 2);\n    };\n  }\n\n  componentDidMount() {\n    console.log(\"生成Buy模块\");\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\",\n        icon: /*#__PURE__*/_jsxDEV(RocketOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 46\n        }, this),\n        size: \"large\",\n        onClick: this.showDrawer,\n        children: \"\\u8D2D\\u4E70\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(_Drawer, {\n        title: \"\\u8F93\\u5165\\u8D2D\\u4E70\\u6570\\u91CF\",\n        width: 400,\n        onClose: this.onClose,\n        visible: this.state.visible,\n        bodyStyle: {\n          paddingBottom: 80\n        },\n        extra: /*#__PURE__*/_jsxDEV(_Space, {\n          children: /*#__PURE__*/_jsxDEV(_Button, {\n            onClick: this.onClose,\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\u552E\\u4EF7: \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: this.props.price\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 20\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\u5E93\\u5B58: \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: this.props.sumNum\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 20\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Form, {\n          layout: \"vertical\",\n          hideRequiredMark: true,\n          onFinish: this.onFinishBuy,\n          onFinishFailed: this.onFinishFailedBuy,\n          children: [/*#__PURE__*/_jsxDEV(_Form.Item, {\n            name: \"buyNum\",\n            label: \"\\u8D2D\\u4E70\\u4E2A\\u6570\",\n            rules: [{\n              required: true,\n              message: '请输入购买个数'\n            }],\n            children: /*#__PURE__*/_jsxDEV(_InputNumber, {\n              min: 0,\n              placeholder: \"\\u8D2D\\u4E70\\u4E2A\\u6570\\u4E0D\\u53EF\\u8D85\\u8FC7\\u5546\\u54C1\\u5E93\\u5B58\",\n              style: {\n                width: '100%'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              //这里不需要 onClick，不然会使函数 onFinishBid 收到参数 SyntheticBaseEvent\n              // onClick={this.onFinishBid}\n              type: \"primary\",\n              htmlType: \"submit\",\n              disabled: this.props.truffleContract === null || this.props.web3 === null,\n              children: \"\\u63D0\\u4EA4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Buy;","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/src/components/Auction/Buy/index.jsx"],"names":["React","Component","UserOutlined","LaptopOutlined","FileSearchOutlined","HomeOutlined","EyeTwoTone","EyeInvisibleOutlined","RocketOutlined","cookie","openNotification","Option","Buy","constructor","props","state","visible","showDrawer","setState","onClose","onFinishBuy","values","console","log","dir","dataArray","length","error","price","originPrice","priceSum","buyNum","blockChainID","ID","web3","that","truffleContract","deployed","then","i","currentAccount","eth","getAccounts","info","order","parseInt","from","toString","value","res","success","err","onFinishFailedBuy","errorInfo","warning","componentDidMount","render","paddingBottom","sumNum","required","message","width"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport { Menu, Layout, message, Drawer, Space, Button, Divider, Form, InputNumber, Input, Select } from 'antd';\nimport { UserOutlined, LaptopOutlined, FileSearchOutlined, HomeOutlined, EyeTwoTone, EyeInvisibleOutlined, RocketOutlined } from '@ant-design/icons';\nimport cookie from \"react-cookies\";\n//接入web3\n// import getWeb3 from \"../../../utils/getWeb3\";\n// import getEcommerceStore from \"../../../utils/getEcommerceStore\";\nimport openNotification from \"../../Notification\";\n\nconst { Option } = Select;\n\n\n\nclass Buy extends Component {\n\n    state = {\n        visible: false\n    }\n\n    constructor (props) {\n        super (props);\n    }\n\n    componentDidMount () {\n         console.log(\"生成Buy模块\");\n    }\n\n    showDrawer = () => {\n        this.setState({\n          visible: true,\n        });\n      };\n    \n    onClose = () => {\n        this.setState({\n          visible: false,\n        });\n      };\n      \n    //点击提交竞拍按钮，表单可以提交时\n    onFinishBuy = (values) => {\n        console.log(\"购买按钮被点击，onFinishBid 得到的数据为 : \");\n        console.dir(values);\n        //values 中的数据示意\n        // buyNum: 2\n\n\n        if(this.props.dataArray.length === 0){\n            message.error(\"找不到被购买的商品\");\n            return;\n        }\n\n        //计算需要支付的金额\n        let price = this.props.dataArray[0].originPrice;\n        //单位是wei\n        let priceSum = price * values.buyNum;\n        \n        let blockChainID = this.props.dataArray[0].ID;\n        console.log(\"购买商品ID : \" + blockChainID);\n\n        let web3 = this.props.web3;\n\n        //购买信息上链\n\n        //注意回调函数中的this，和外界的this不同，如果向使用外界的this，要赋值成that传过去\n        //注意要使用async，确保先拿到地址，用await关键字确保运行的先后顺序，再用这个地址调用合约方法\n        let that = this;\n        this.props.truffleContract.deployed().then(async (i) => {\n            console.log(\"进入 this.props.truffleContract.deployed() 的回调函数\");\n            //测试时要在MetaMask中选中ganache提供的10个地址之一，from自己创建的地址会失败\n            //即时获取当前地址，用该地址发交易\n            let currentAccount = await web3.eth.getAccounts();\n            message.info(\"交易发起地址为: \"+currentAccount, 2);\n            console.log(\"交易发起地址为: \"+currentAccount);\n\n            try{\n                //调用合约的 buy 方法\n                await i.order(parseInt(blockChainID), values.buyNum, { from: currentAccount.toString(), value: priceSum}).then(res => {\n                    //注意这里调用合约方法使用的地址，必须是字符串形式，要用 toString() 转化为字符串\n                    message.success(\"购买提交成功\");\n                    console.log(\"成功调用合约的buy方法，返回 : \");\n                    console.dir(res);\n                    //关闭侧边栏\n                    this.onClose();\n                    openNotification(\"购买信息提交成功\",\n                                    \"购买个数: \" + values.buyNum ,\n                                    'bottomLeft');\n                });\n            }catch(err) {\n                message.error(\"向链上提交购买信息失败\",2);\n                console.log(\"调用合约的buy方法失败, err = \");\n                console.dir(err);\n                return;\n            }  \n        });\n\n    }\n\n    //点击购买按钮，表单不能提交时\n    onFinishFailedBuy = (errorInfo) => {\n        message.warning(\"请正确填写购买信息\",2);\n    }\n    \n    render () {\n        return (\n\n\n            <div>\n\n                <Button type=\"primary\" icon={<RocketOutlined />} size={\"large\"} onClick={this.showDrawer}>\n                购买\n                </Button>\n\n            <Drawer\n          title=\"输入购买数量\"\n          width={400}\n          onClose={this.onClose}\n          visible={this.state.visible}\n          bodyStyle={{ paddingBottom: 80 }}\n          extra={\n            <Space>\n              <Button onClick={this.onClose}>取消</Button>\n            </Space>\n          }\n        >\n            <p>售价: <b>{this.props.price}</b></p>\n            <p></p>\n            <p>库存: <b>{this.props.sumNum}</b></p>\n            <Divider />\n          <Form \n            layout=\"vertical\" hideRequiredMark\n            onFinish={this.onFinishBuy}\n            onFinishFailed={this.onFinishFailedBuy}\n            \n          >\n            <Form.Item\n                name=\"buyNum\"\n                label=\"购买个数\"\n                rules={[\n                        {\n                            required: true,\n                            message: '请输入购买个数',\n                        },\n                ]}\n            >\n            <InputNumber\n                min={0}\n                placeholder=\"购买个数不可超过商品库存\"\n                style={{\n                    width: '100%',\n                }}\n            />\n            </Form.Item>\n            \n            <Form.Item>\n                <Button \n                //这里不需要 onClick，不然会使函数 onFinishBid 收到参数 SyntheticBaseEvent\n                // onClick={this.onFinishBid}\n                type=\"primary\" \n                htmlType=\"submit\"\n                disabled={ this.props.truffleContract === null || this.props.web3 === null } \n                >\n                提交\n              </Button>\n            </Form.Item>\n\n          </Form>\n        </Drawer>\n\n            </div>\n        );\n    }\n}\n\nexport default Buy;\n"]},"metadata":{},"sourceType":"module"}