{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { prepareDataCoordInfo, getStackedOnPoint } from './helper';\nimport { createFloat32Array } from '../../util/vendor';\n\nfunction diffData(oldData, newData) {\n  var diffResult = [];\n  newData.diff(oldData).add(function (idx) {\n    diffResult.push({\n      cmd: '+',\n      idx: idx\n    });\n  }).update(function (newIdx, oldIdx) {\n    diffResult.push({\n      cmd: '=',\n      idx: oldIdx,\n      idx1: newIdx\n    });\n  }).remove(function (idx) {\n    diffResult.push({\n      cmd: '-',\n      idx: idx\n    });\n  }).execute();\n  return diffResult;\n}\n\nexport default function lineAnimationDiff(oldData, newData, oldStackedOnPoints, newStackedOnPoints, oldCoordSys, newCoordSys, oldValueOrigin, newValueOrigin) {\n  var diff = diffData(oldData, newData); // let newIdList = newData.mapArray(newData.getId);\n  // let oldIdList = oldData.mapArray(oldData.getId);\n  // convertToIntId(newIdList, oldIdList);\n  // // FIXME One data ?\n  // diff = arrayDiff(oldIdList, newIdList);\n\n  var currPoints = [];\n  var nextPoints = []; // Points for stacking base line\n\n  var currStackedPoints = [];\n  var nextStackedPoints = [];\n  var status = [];\n  var sortedIndices = [];\n  var rawIndices = [];\n  var newDataOldCoordInfo = prepareDataCoordInfo(oldCoordSys, newData, oldValueOrigin);\n  var oldDataNewCoordInfo = prepareDataCoordInfo(newCoordSys, oldData, newValueOrigin);\n  var oldPoints = oldData.getLayout('points') || [];\n  var newPoints = newData.getLayout('points') || [];\n\n  for (var i = 0; i < diff.length; i++) {\n    var diffItem = diff[i];\n    var pointAdded = true;\n    var oldIdx2 = void 0;\n    var newIdx2 = void 0; // FIXME, animation is not so perfect when dataZoom window moves fast\n    // Which is in case remvoing or add more than one data in the tail or head\n\n    switch (diffItem.cmd) {\n      case '=':\n        oldIdx2 = diffItem.idx * 2;\n        newIdx2 = diffItem.idx1 * 2;\n        var currentX = oldPoints[oldIdx2];\n        var currentY = oldPoints[oldIdx2 + 1];\n        var nextX = newPoints[newIdx2];\n        var nextY = newPoints[newIdx2 + 1]; // If previous data is NaN, use next point directly\n\n        if (isNaN(currentX) || isNaN(currentY)) {\n          currentX = nextX;\n          currentY = nextY;\n        }\n\n        currPoints.push(currentX, currentY);\n        nextPoints.push(nextX, nextY);\n        currStackedPoints.push(oldStackedOnPoints[oldIdx2], oldStackedOnPoints[oldIdx2 + 1]);\n        nextStackedPoints.push(newStackedOnPoints[newIdx2], newStackedOnPoints[newIdx2 + 1]);\n        rawIndices.push(newData.getRawIndex(diffItem.idx1));\n        break;\n\n      case '+':\n        var newIdx = diffItem.idx;\n        var newDataDimsForPoint = newDataOldCoordInfo.dataDimsForPoint;\n        var oldPt = oldCoordSys.dataToPoint([newData.get(newDataDimsForPoint[0], newIdx), newData.get(newDataDimsForPoint[1], newIdx)]);\n        newIdx2 = newIdx * 2;\n        currPoints.push(oldPt[0], oldPt[1]);\n        nextPoints.push(newPoints[newIdx2], newPoints[newIdx2 + 1]);\n        var stackedOnPoint = getStackedOnPoint(newDataOldCoordInfo, oldCoordSys, newData, newIdx);\n        currStackedPoints.push(stackedOnPoint[0], stackedOnPoint[1]);\n        nextStackedPoints.push(newStackedOnPoints[newIdx2], newStackedOnPoints[newIdx2 + 1]);\n        rawIndices.push(newData.getRawIndex(newIdx));\n        break;\n\n      case '-':\n        var oldIdx = diffItem.idx;\n        var rawIndex = oldData.getRawIndex(oldIdx);\n        var oldDataDimsForPoint = oldDataNewCoordInfo.dataDimsForPoint;\n        oldIdx2 = oldIdx * 2; // Data is replaced. In the case of dynamic data queue\n        // FIXME FIXME FIXME\n\n        if (rawIndex !== oldIdx) {\n          var newPt = newCoordSys.dataToPoint([oldData.get(oldDataDimsForPoint[0], oldIdx), oldData.get(oldDataDimsForPoint[1], oldIdx)]);\n          var newStackedOnPt = getStackedOnPoint(oldDataNewCoordInfo, newCoordSys, oldData, oldIdx);\n          currPoints.push(oldPoints[oldIdx2], oldPoints[oldIdx2 + 1]);\n          nextPoints.push(newPt[0], newPt[1]);\n          currStackedPoints.push(oldStackedOnPoints[oldIdx2], oldStackedOnPoints[oldIdx2 + 1]);\n          nextStackedPoints.push(newStackedOnPt[0], newStackedOnPt[1]);\n          rawIndices.push(rawIndex);\n        } else {\n          pointAdded = false;\n        }\n\n    } // Original indices\n\n\n    if (pointAdded) {\n      status.push(diffItem);\n      sortedIndices.push(sortedIndices.length);\n    }\n  } // Diff result may be crossed if all items are changed\n  // Sort by data index\n\n\n  sortedIndices.sort(function (a, b) {\n    return rawIndices[a] - rawIndices[b];\n  });\n  var len = currPoints.length;\n  var sortedCurrPoints = createFloat32Array(len);\n  var sortedNextPoints = createFloat32Array(len);\n  var sortedCurrStackedPoints = createFloat32Array(len);\n  var sortedNextStackedPoints = createFloat32Array(len);\n  var sortedStatus = [];\n\n  for (var i = 0; i < sortedIndices.length; i++) {\n    var idx = sortedIndices[i];\n    var i2 = i * 2;\n    var idx2 = idx * 2;\n    sortedCurrPoints[i2] = currPoints[idx2];\n    sortedCurrPoints[i2 + 1] = currPoints[idx2 + 1];\n    sortedNextPoints[i2] = nextPoints[idx2];\n    sortedNextPoints[i2 + 1] = nextPoints[idx2 + 1];\n    sortedCurrStackedPoints[i2] = currStackedPoints[idx2];\n    sortedCurrStackedPoints[i2 + 1] = currStackedPoints[idx2 + 1];\n    sortedNextStackedPoints[i2] = nextStackedPoints[idx2];\n    sortedNextStackedPoints[i2 + 1] = nextStackedPoints[idx2 + 1];\n    sortedStatus[i] = status[idx];\n  }\n\n  return {\n    current: sortedCurrPoints,\n    next: sortedNextPoints,\n    stackedOnCurrent: sortedCurrStackedPoints,\n    stackedOnNext: sortedNextStackedPoints,\n    status: sortedStatus\n  };\n}","map":{"version":3,"sources":["/home/kzj/project/finalize/final/code/react_code/node_modules/echarts/lib/chart/line/lineAnimationDiff.js"],"names":["prepareDataCoordInfo","getStackedOnPoint","createFloat32Array","diffData","oldData","newData","diffResult","diff","add","idx","push","cmd","update","newIdx","oldIdx","idx1","remove","execute","lineAnimationDiff","oldStackedOnPoints","newStackedOnPoints","oldCoordSys","newCoordSys","oldValueOrigin","newValueOrigin","currPoints","nextPoints","currStackedPoints","nextStackedPoints","status","sortedIndices","rawIndices","newDataOldCoordInfo","oldDataNewCoordInfo","oldPoints","getLayout","newPoints","i","length","diffItem","pointAdded","oldIdx2","newIdx2","currentX","currentY","nextX","nextY","isNaN","getRawIndex","newDataDimsForPoint","dataDimsForPoint","oldPt","dataToPoint","get","stackedOnPoint","rawIndex","oldDataDimsForPoint","newPt","newStackedOnPt","sort","a","b","len","sortedCurrPoints","sortedNextPoints","sortedCurrStackedPoints","sortedNextStackedPoints","sortedStatus","i2","idx2","current","next","stackedOnCurrent","stackedOnNext"],"mappings":"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","sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { prepareDataCoordInfo, getStackedOnPoint } from './helper';\nimport { createFloat32Array } from '../../util/vendor';\n\nfunction diffData(oldData, newData) {\n  var diffResult = [];\n  newData.diff(oldData).add(function (idx) {\n    diffResult.push({\n      cmd: '+',\n      idx: idx\n    });\n  }).update(function (newIdx, oldIdx) {\n    diffResult.push({\n      cmd: '=',\n      idx: oldIdx,\n      idx1: newIdx\n    });\n  }).remove(function (idx) {\n    diffResult.push({\n      cmd: '-',\n      idx: idx\n    });\n  }).execute();\n  return diffResult;\n}\n\nexport default function lineAnimationDiff(oldData, newData, oldStackedOnPoints, newStackedOnPoints, oldCoordSys, newCoordSys, oldValueOrigin, newValueOrigin) {\n  var diff = diffData(oldData, newData); // let newIdList = newData.mapArray(newData.getId);\n  // let oldIdList = oldData.mapArray(oldData.getId);\n  // convertToIntId(newIdList, oldIdList);\n  // // FIXME One data ?\n  // diff = arrayDiff(oldIdList, newIdList);\n\n  var currPoints = [];\n  var nextPoints = []; // Points for stacking base line\n\n  var currStackedPoints = [];\n  var nextStackedPoints = [];\n  var status = [];\n  var sortedIndices = [];\n  var rawIndices = [];\n  var newDataOldCoordInfo = prepareDataCoordInfo(oldCoordSys, newData, oldValueOrigin);\n  var oldDataNewCoordInfo = prepareDataCoordInfo(newCoordSys, oldData, newValueOrigin);\n  var oldPoints = oldData.getLayout('points') || [];\n  var newPoints = newData.getLayout('points') || [];\n\n  for (var i = 0; i < diff.length; i++) {\n    var diffItem = diff[i];\n    var pointAdded = true;\n    var oldIdx2 = void 0;\n    var newIdx2 = void 0; // FIXME, animation is not so perfect when dataZoom window moves fast\n    // Which is in case remvoing or add more than one data in the tail or head\n\n    switch (diffItem.cmd) {\n      case '=':\n        oldIdx2 = diffItem.idx * 2;\n        newIdx2 = diffItem.idx1 * 2;\n        var currentX = oldPoints[oldIdx2];\n        var currentY = oldPoints[oldIdx2 + 1];\n        var nextX = newPoints[newIdx2];\n        var nextY = newPoints[newIdx2 + 1]; // If previous data is NaN, use next point directly\n\n        if (isNaN(currentX) || isNaN(currentY)) {\n          currentX = nextX;\n          currentY = nextY;\n        }\n\n        currPoints.push(currentX, currentY);\n        nextPoints.push(nextX, nextY);\n        currStackedPoints.push(oldStackedOnPoints[oldIdx2], oldStackedOnPoints[oldIdx2 + 1]);\n        nextStackedPoints.push(newStackedOnPoints[newIdx2], newStackedOnPoints[newIdx2 + 1]);\n        rawIndices.push(newData.getRawIndex(diffItem.idx1));\n        break;\n\n      case '+':\n        var newIdx = diffItem.idx;\n        var newDataDimsForPoint = newDataOldCoordInfo.dataDimsForPoint;\n        var oldPt = oldCoordSys.dataToPoint([newData.get(newDataDimsForPoint[0], newIdx), newData.get(newDataDimsForPoint[1], newIdx)]);\n        newIdx2 = newIdx * 2;\n        currPoints.push(oldPt[0], oldPt[1]);\n        nextPoints.push(newPoints[newIdx2], newPoints[newIdx2 + 1]);\n        var stackedOnPoint = getStackedOnPoint(newDataOldCoordInfo, oldCoordSys, newData, newIdx);\n        currStackedPoints.push(stackedOnPoint[0], stackedOnPoint[1]);\n        nextStackedPoints.push(newStackedOnPoints[newIdx2], newStackedOnPoints[newIdx2 + 1]);\n        rawIndices.push(newData.getRawIndex(newIdx));\n        break;\n\n      case '-':\n        var oldIdx = diffItem.idx;\n        var rawIndex = oldData.getRawIndex(oldIdx);\n        var oldDataDimsForPoint = oldDataNewCoordInfo.dataDimsForPoint;\n        oldIdx2 = oldIdx * 2; // Data is replaced. In the case of dynamic data queue\n        // FIXME FIXME FIXME\n\n        if (rawIndex !== oldIdx) {\n          var newPt = newCoordSys.dataToPoint([oldData.get(oldDataDimsForPoint[0], oldIdx), oldData.get(oldDataDimsForPoint[1], oldIdx)]);\n          var newStackedOnPt = getStackedOnPoint(oldDataNewCoordInfo, newCoordSys, oldData, oldIdx);\n          currPoints.push(oldPoints[oldIdx2], oldPoints[oldIdx2 + 1]);\n          nextPoints.push(newPt[0], newPt[1]);\n          currStackedPoints.push(oldStackedOnPoints[oldIdx2], oldStackedOnPoints[oldIdx2 + 1]);\n          nextStackedPoints.push(newStackedOnPt[0], newStackedOnPt[1]);\n          rawIndices.push(rawIndex);\n        } else {\n          pointAdded = false;\n        }\n\n    } // Original indices\n\n\n    if (pointAdded) {\n      status.push(diffItem);\n      sortedIndices.push(sortedIndices.length);\n    }\n  } // Diff result may be crossed if all items are changed\n  // Sort by data index\n\n\n  sortedIndices.sort(function (a, b) {\n    return rawIndices[a] - rawIndices[b];\n  });\n  var len = currPoints.length;\n  var sortedCurrPoints = createFloat32Array(len);\n  var sortedNextPoints = createFloat32Array(len);\n  var sortedCurrStackedPoints = createFloat32Array(len);\n  var sortedNextStackedPoints = createFloat32Array(len);\n  var sortedStatus = [];\n\n  for (var i = 0; i < sortedIndices.length; i++) {\n    var idx = sortedIndices[i];\n    var i2 = i * 2;\n    var idx2 = idx * 2;\n    sortedCurrPoints[i2] = currPoints[idx2];\n    sortedCurrPoints[i2 + 1] = currPoints[idx2 + 1];\n    sortedNextPoints[i2] = nextPoints[idx2];\n    sortedNextPoints[i2 + 1] = nextPoints[idx2 + 1];\n    sortedCurrStackedPoints[i2] = currStackedPoints[idx2];\n    sortedCurrStackedPoints[i2 + 1] = currStackedPoints[idx2 + 1];\n    sortedNextStackedPoints[i2] = nextStackedPoints[idx2];\n    sortedNextStackedPoints[i2 + 1] = nextStackedPoints[idx2 + 1];\n    sortedStatus[i] = status[idx];\n  }\n\n  return {\n    current: sortedCurrPoints,\n    next: sortedNextPoints,\n    stackedOnCurrent: sortedCurrStackedPoints,\n    stackedOnNext: sortedNextStackedPoints,\n    status: sortedStatus\n  };\n}"]},"metadata":{},"sourceType":"module"}